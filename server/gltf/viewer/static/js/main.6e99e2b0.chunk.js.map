{"version":3,"sources":["../external \"React\"","../external \"ReactDOM\"","../external \"PropTypes\"","config/index.js","../external \"mobx\"","theme.ts","stores/GltfStore.ts","stores/SettingsStore.ts","stores/RootStore.tsx","hooks/useAsyncWithLoadingAndErrorHandling.ts","hooks/useLoadingState.ts","hooks/utilities/readFile.ts","hooks/utilities/createGltfWithBlobAssets.ts","hooks/useGltfDrop.ts","fetchConfig.ts","utilities/mixColor.ts","icons/Orbit.svg","components/Appear.tsx","icons/PointOfView.svg","icons/DragDrop.svg","components/Camera.tsx","icons/Error.svg","icons/EmptyConfiguration.svg","icons/Check.svg","components/MessageBox.tsx","components/FpsMonitor.tsx","components/NavList.tsx","components/NavListItem.tsx","playcanvas/Animation.ts","components/Variant.tsx","components/VariantSet.tsx","components/LevelVariantSet.tsx","components/GltfContent.tsx","components/Hamburger.tsx","components/Hotspot.tsx","components/Sidebar.tsx","components/Arrow.tsx","components/SidebarContainer.tsx","components/SidebarToggle.tsx","playcanvas/scripts/OrbitCamera.ts","playcanvas/scripts/HdriBackdrop.ts","playcanvas/scripts/NodeLightmap.ts","playcanvas/scripts/AnimationHotspot.ts","playcanvas/scripts/SkySphere.ts","playcanvas/Camera.ts","variants/Variant.ts","variants/VariantSetManager.ts","utilities/deepEqual.ts","playcanvas/extensions/AnimationPlayback.ts","playcanvas/extensions/BlendMode.ts","playcanvas/extensions/ExtensionRegistry.ts","playcanvas/extensions/HdrEncoding.ts","playcanvas/utilities/cubemap.ts","playcanvas/extensions/HdriBackdrop.ts","playcanvas/extensions/AnimationHotspot.ts","playcanvas/extensions/CameraControl.ts","playcanvas/extensions/VariantSet.ts","utilities/typeGuards.ts","playcanvas/extensions/KhronosVariantSet.ts","playcanvas/extensions/LightMap.ts","playcanvas/extensions/SkySphere.ts","playcanvas/extensions/LightPunctual.ts","playcanvas/PlayCanvasGltfLoader.ts","playcanvas/PlayCanvasViewer.ts","containers/Viewer.tsx","hooks/usePreventableCameraInteractions.ts","containers/Gltf.tsx","containers/Cameras.tsx","containers/Root.tsx","containers/Bootstrapper.tsx","utilities/waitFor.ts","index.tsx"],"names":["module","exports","React","ReactDOM","PropTypes","defaultConfig","assets","topbar","sidebar","cameras","dragAndDrop","topbarTitle","topbarLogoUrl","theme","palette","primary","mobx","createTheme","config","createMuiTheme","type","text","secondary","disabled","background","default","paper","divider","action","active","common","black","white","grey","50","100","200","300","400","500","600","700","800","900","main","typography","fontFamily","fontWeightBold","fontWeightMedium","fontWeightRegular","fontWeightLight","fontSize","topbarHeight","sidebarWidth","cameraPreviewWidth","cameraPreviewHeight","listAnimationDelay","GltfStore","bound","defaultGltf","urlParams","URLSearchParams","window","location","search","this","get","sceneHierarchy","variantSetManager","hasBackdrops","gltf","camera","id","levelVariantSetId","gltfs","length","setGltf","find","m","name","undefined","observable","computed","SettingsStore","showUI","_showFpsMeter","_showTopbar","_showSidebar","_showCameras","enableDragAndDrop","RootStore","gltfStore","settingsStore","RootStoreContext","createContext","RootStoreProvider","children","Provider","value","useStores","useContext","useAsyncWithLoadingAndErrorHandling","useState","loadingCount","setLoadingCount","useCallback","c","useLoadingState","isLoading","startLoadingTask","endLoadingTask","isError","setIsError","callback","a","readFile","blob","readAs","Promise","resolve","reject","reader","FileReader","onabort","onerror","onload","result","readAsArrayBuffer","readAsDataURL","readAsText","createGltfWithBlobAssets","gltfContent","updatedGltf","reduce","asset","urlParts","URL","createObjectURL","split","assetUrlString","escapedName","replace","re","RegExp","match","g1","Blob","isGltfFile","file","path","extname","fetchConfig","fetch","res","json","overrides","deepmerge","mixColorChannel","channelA","channelB","weight","Math","round","mixColor","color1","color2","min","max","color1Object","decomposeColor","color2Object","Error","includes","newColor","values","recomposeColor","_mask","_g","_mask2","_g2","_circle","_ellipse","useStyles","makeStyles","to","opacity","transform","from","root","animationName","animationFillMode","animationTimingFunction","transitions","easing","easeOut","animationDuration","duration","enteringScreen","left","right","up","down","Appear","direction","delay","classes","className","clsx","style","animationDelay","_excluded","_extends","Object","assign","target","i","arguments","source","key","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_path","_path2","_path3","_path4","_path5","_path6","_path7","_path8","_path9","_path10","_ref","svgRef","title","props","createElement","width","height","viewBox","fill","ref","maskUnits","x","y","d","mask","fillRule","clipRule","stroke","strokeWidth","strokeDasharray","cx","cy","r","rx","ry","ForwardRef","forwardRef","dropShadow","marginBottom","spacing","marginRight","input","position","pointerEvents","button","borderRadius","shape","backgroundColor","backgroundSize","backgroundPosition","backgroundRepeat","boxShadow","cursor","overflow","transition","create","short","buttonChecked","icon","bottom","display","alignItems","justifyContent","Camera","appear","autoFocus","checkedProp","checked","image","nameProp","tabIndex","onChange","radioGroup","useRadioGroup","content","backgroundImage","e","cloneElement","_defs","strokeLinecap","x1","y1","x2","y2","gradientUnits","stopColor","offset","padding","textAlign","marginLeft","MessageBox","overline","Typography","variant","color","gutterBottom","barColors","fontWeight","internalSpacing","externalSpacing","zIndex","top","getContrastText","lineHeight","MozBoxSizing","boxSizing","graph","bar","FpsCalculator","prevTime","performance","now","frames","req","start","fps","acc","cur","currentTime","nextFrames","nextFps","slice","graphWidth","requestAnimationFrame","calc","bind","cancelAnimationFrame","FpsMonitor","observer","calculator","setCalculator","useEffect","instance","stop","lastFps","avgFps","minFps","maxFps","map","f","floor","list","margin","listStyle","NavList","borderBoxShadow","item","selected","NavListItem","onClick","AnimationState","borderColor","checkColor","hoverBackgroundColor","hoverBorderColor","hoverCheckColor","checkedBorderColor","checkedCheckColor","userSelect","borderTopColor","objectFit","label","pxToRem","checkbox","borderTop","borderRight","checkboxChecked","checkboxIcon","Variant","src","alt","component","borderBottom","textTransform","VariantSet","variantIdOffset","manager","useTheme","setLabel","variantLabels","setVariantLabels","variantImages","setVariantImages","variants","setVariants","selectedVariants","setSelectedVariants","onSelectedVariantsChange","onVariantClicked","variantID","activate","getName","getVariantIds","getVariantNames","getVariantThumbnails","getState","onStateChange","offStateChange","FormControl","fullWidth","FormLabel","FormGroup","aria-label","variantId","some","selectedVariantId","LevelVariantSet","variantSets","variantCount","setId","set","flexDirection","overflowX","levelVariantSets","flex","meta","GltfContent","appearDirection","onLevelVariantSetSelect","levelVariantSet","standard","description","creator","Divider","creatorUrl","href","rel","layerStyles","shorter","wrapper","marginTop","layer","layerHeight","layerSpacing","layerActive","Hamburger","borderWidth","borderStyle","shadows","light","drawer","flexShrink","drawerPaper","border","Sidebar","open","Drawer","anchor","onWheel","nativeEvent","stopPropagation","onMouseDown","PaperProps","angleLayerWidth","size","Arrow","header","paddingLeft","paddingRight","backButtonWrapper","backButton","body","SidebarContainer","onNavigateBack","IconButton","disableTouchRipple","SidebarToggle","toggleOpen","data-testid","OrbitCameraMode","Animation","_node","_layer","_index","_defaultState","_autoPlay","_initialStartTime","pause","playable","activeState","controller","_controller","activeStateAnimations","activeClip","_animEvaluator","findClip","time","defaultState","play","state","startTime","_getStartTime","activeStateCurrentTime","activeStateDuration","Loop","Once","LoopReverse","OnceReverse","OrbitCamera","args","inertiaFactor","orbitSensitivity","distanceSensitivity","dollyDuration","nearClipFactor","farClipFactor","allowPan","_mode","Orbital","_cameraComponent","_initialized","_distanceMin","_distanceMax","_pitchAngleMax","_pitchAngleMin","_yawAngleMax","_yawAngleMin","_distance","_pitch","_yaw","_targetDistance","_targetPitch","_targetYaw","_focusEntity","_focusOffset","pc","_focusPosition","_lastFocusDistance","_lastFocusPitch","_lastFocusYaw","_lastFocusOffset","_lookButtonDown","_panButtonDown","_lastMousePos","_lastMouseDelta","_lastStartDistance","_zoomAnimFrame","_hammer","_setupCameraMode","mode","_clampDistance","_clampPitchAngle","_clampYawAngle","off","_onEntityDestroyed","on","entity","_setUpMouseEvents","_setUpTouchEvents","_tearDownMouseEvents","_tearDownTouchEvents","dt","t","lerp","_updateFocusPosition","_updatePosition","yaw","remainder","focusEntity","options","frameModels","lookAtEntity","app","copy","ZERO","focusAabb","_buildAabb","add","center","sub","getPosition","distance","_calcDistanceForBoundingBox","lookAt","UP","cameraQuat","getRotation","_calcYaw","pitch","_calcPitch","nearClip","aabb","farClip","_removeInertia","console","warn","resetPoint","lookAtPoint","setPosition","focus","halfExtents","fov","z","tan","DEG_TO_RAD","FreeLook","setEulerAngles","setLocalPosition","forward","scale","ignoredTagsQuery","modelsAabb","tags","has","model","mi","meshInstances","clone","childAabb","quat","transformedForward","transformVector","FORWARD","atan2","RAD_TO_DEG","distanceMax","clamp","distanceMin","pitchAngleMin","pitchAngleMax","usesYawLimits","yawAngleMin","yawAngleMax","quatWithoutYaw","yawOffset","setFromEulerAngles","mul2","curValue","targetValue","Date","smoothZoom","elapsed","nextValue","dx","dy","fromWorldPoint","toWorldPoint","worldDiff","screenToWorld","sub2","event","prevent","enabled","reset","preventDefault","_orbit","_pan","_dolly","wheel","mouse","disableContextMenu","keyboard","_onKeyDown","_onMouseDown","_onMouseUp","_onMouseMove","_onMouseWheel","addEventListener","_onMouseOut","removeEventListener","deltaX","deltaY","pointers","pinch","Hammer","pan","recognizeWith","graphicsDevice","canvas","inputClass","_onTouchPinchStart","_onTouchPinch","_onTouchPanStart","_onTouchPanEnd","_onTouchPan","destroy","HdriBackdrop","_material","_worldProjectionCenter","_mapRotationMatrix","addComponent","_initializeMaterial","_updateModel","_updateCubemapUniform","_updateIntensityUniform","_updateMapRotationUniform","_updateLightingDistanceUniform","_updateTransformRelatedUniforms","_updateEntityScale","_restrictCurrentRotationToY","modelComponent","resource","forEach","meshInstance","material","uHdriMap","cubemap","setParameter","deleteParameter","uLightingDistance","lightingDistanceFactor","uIntensity","intensity","uProjectionCenter","_calculateProjectionCenterUniform","matrix","setFromAxisAngle","angle","uMapRotationMatrix","data","radius","_calculateModelSphereRadius","setLocalScale","rotation","getAxisAngle","worldProjectionCenter","useCameraProjection","systems","projectionCenter","precision","vertexCode","_getVertexShaderCode","fragmentCode","_getFragmentShaderCode","shader","attributes","aPosition","aUv0","vshader","fshader","boundingBox","positions","tmpVec1","tmpVec2","radiusSquared","vertexCount","mesh","getPositions","idx","lengthSq","sqrt","scene","chunks","programlib","shaderCode","gammaCode","gammaCorrection","tonemapCode","toneMapping","rgbmPS","assetType","NodeLightmap","applyLightmapToModel","_findOrCreateExtendedMaterial","coordinateScaleBias","lightmapAdd","lightmapScale","originalMaterial","_findOriginalMaterial","_materialMappings","nodeLightmap","_findExtendedMaterial","texture","texCoord","lightMap","lightMapUv","lightmapSinglePS","_createLightmapSinglePS","update","push","original","extended","mapping","extendedMaterial","_getCommonShaderCode","_getHighQualityShaderCode","array","hotspotStates","AnimationHotspot","_onToggleCallbacks","_active","_parentElem","_hotspotElem","_hotspotImageElems","_cachedEntityPosition","_pickerEntity","_screenPosition","_lastScreenPosition","_wasVisible","_onClick","_onMouseOver","document","hovered","toggled","elem","appendChild","hotspotStyle","transitionProperty","transitionTimingFunction","imageElem","draggable","imageStyle","_onInstanceAdded","_setStateImages","_setStateVisibility","_setCachedEntityPosition","_setParentElem","_setTransitionDuration","_addPickerEntity","_onInstanceRemoved","removeChild","_onPrerender","index","splice","_pickerModel","addChild","_getActiveCamera","screenPos","lastScreenPos","worldToScreen","_getEntityPosition","equals","String","isVisible","_isHotspotVisible","cacheEntityPosition","parentElementId","getElementById","parentElement","transitionDuration","hoveredImage","toggledImage","toggledHoveredImage","getSource","_getStateImageSource","script","_initialize","_hotspots","hotspot","pickerPosition","_updatePicker","_picker","getApplication","_pickerPixels","Uint8Array","_pickerMaterial","node","_setPickerMaterialVisible","visible","redWrite","greenWrite","blueWrite","alphaWrite","depthWrite","picker","device","scaleX","scaleY","_tempVecs","testPos","cameraPosition","cameraDistance","colliderScreenRadius","worldLayer","layers","getLayerById","prepare","prevRenderTarget","getRenderTarget","setRenderTarget","renderTarget","updateBegin","readPixels","updateEnd","pixels","drawCalls","instances","visibleOpaque","parent","SkySphere","_skyEntity","_lightComponent","_time","_defaultHorizonSunColor","_defaultZenithSunColor","_entityRotation","_lightDir","_tempColor","_tempQuat","_instanceCount","_cacheLightComponent","_updateTextures","_updateSettings","_updateColors","_updateSun","_updateSkySphereSize","skyboxLayer","_skyboxWasInitiallyEnabled","_restrictSkyRotation","entityRotation","setRotation","IDENTITY","directionalLight","findComponent","modelAsset","skySphereModel","skyEntity","_setTextureParameter","skyTexture","cloudsTexture","starsTexture","cloudSpeed","noisePower1","noisePower2","sunRadius","cloudOpacity","starsBrightness","sunBrightness","colorsDeterminedBySunPosition","sunHeight","horizonColorCurve","zenithColorCurve","cloudColorCurve","abs","_setVectorParameter","cloudColor","horizonColor","zenithColor","horizonFalloff","overallColor","lightComponent","lightDir","sunColor","tempQuat","DOWN","g","b","asin","PI","alpha","parameter","worldTrans","getWorldTransform","transformPoint","aUv1","convertToCameraEntity","clearColor","isOrbitCameraEntity","debug","Debug","thumbnailSource","_isActiveByDefault","_variantNodes","every","properties","modelAssetID","materialMapping","visibilityMatch","modelMatch","materialMappingMatch","_hasMatchingMaterials","assetID","animComponent","anim","VariantSetManager","_state","_stateCallbacks","_globalStateCallbacks","_levelVariantSets","_variantSets","levelSetWithIndices","setIndex","_","_evalGlobalState","variantSetId","globalState","newState","newVariantSetState","JSON","stringify","_onStateChange","_onGlobalStateChange","callbacks","animationPlaybackDefaults","AnimationPlaybackExtensionParser","_animDatas","container","animations","animationAsset","registry","animation","postParse","_animationPostParse","remove","animTrack","extensionData","BlendModeExtensionParser","_materialPostParse","blendMode","blendType","ExtensionParserCallbackRegistry","_extensions","removeAll","parsers","object","extensionDataByName","gltfData","extensionParsers","extensionId","extensionParser","ExtensionRegistry","_scene","_camera","_texture","_animation","_global","createPostProcessHandler","objectData","extensions","error","global","preprocess","postprocess","containerData","HdrEncodingExtensionParser","_texturePostParse","encoding","syncCubemapToCpu","tex","_colorBuffer","format","gl","setFramebuffer","_glFrameBuffer","RGBA","UNSIGNED_BYTE","_levels","face","prefilterRgbmCubemap","sourceCubemap","syncToCpu","createMipChainInFirstMip","outputSize","steps","log2","sourceType","sourceFormat","createShaderFromCode","fullscreenQuadVS","outputCubemapPS","constantTexSource","scope","constantParams","params","inputCubemap","outputCubemap","mipmaps","colorBuffer","depth","setValue","downSampleCubemap","mipSizes","mipGloss","mipCubemaps","mipSize","mip","fixCubemapSeams","addressU","addressV","prefilterCubemapPS","w","upload","_prefilteredMips","HdriBackdropExtensionParser","_nodeBackdrops","_nodePostParse","filter","nodeBackdrop","findOne","textures","_findCubemapTextures","models","createCubemapFromTextures","cubemapAsset","HdriBackdropScript","_stripUndefinedProperties","skyboxCubemaps","skyboxIntensity","backdrop","_container","rootData","EPIC_hdri_backdrops","backdrops","backdropNode","obj","AnimationHotspotExtensionParser","_hotspotDatas","animationIndex","animationIndices","_initHotspotScripts","EPIC_animation_hotspots","hotspots","onToggle","activeStateClipTime","CameraControlExtensionParser","_focusNodes","_cameraPostParse","nodeIndex","nodes","missingProperties","_getMissingProperties","cameraMode","_parseOrbitCameraMode","maxPitch","minPitch","maxYaw","minYaw","maxDistance","minDistance","dollySensitivity","rotationSensitivity","rotationInertia","cameraControlMode","modeName","_capitalizeFirstLetter","charAt","toUpperCase","VariantSetExtensionParser","nodeEntities","sets","thumbnail","_parseVariantNodeProperties","_scenePostParse","EPIC_level_variant_sets","materials","KhronosVariantSetExtensionParser","_variants","_rootData","meshes","variantNodesMap","_parseNode","variantIndex","numericVariantIndex","parseInt","_globalPostParse","primitiveIndex","primitives","_parsePrimitive","mappings","KHR_materials_variants","_parseMapping","LightMapExtensionParser","_nodeLightmapDatas","_nodeLightmaps","clearCachedMaterialMappings","lightmap","EPIC_lightmap_textures","lightmaps","SkySphereExtensionParser","_nodeSkySphereDatas","skySphereName","skySphereMesh","SkySphereScript","skySphere","EPIC_sky_spheres","skySpheres","LightPunctualExtensionParser","_nodeLights","log","nodeLight","findComponents","lights","PlayCanvasGltfLoader","_app","_extensionRegistry","url","fileName","fileUrl","join","assetName","getBasename","getByUrl","filename","containerAssetOptions","once","loadedAsset","err","load","playbackByAnimationIndex","hotspotAnimationIndices","animationIndicesByNode","animationAssets","loadStateGraph","speed","playRate","states","loop","parameters","track","findAnimationLayer","assignAnimation","playback","autoPlay","anims","register","unregister","variantSetParser","khronosVariantSetParser","hotspotParser","lightMapParser","backdropParser","animationPlaybackParser","_clearExtensions","_registerExtensions","_loadAsset","defaultScene","_postParseExtensions","_unregisterExtensions","getPlaybackByAnimationIndex","_createAnimations","cameraEntities","_addModelMaterialMappings","scenes","sceneRoot","sceneAnimations","getVariantSetsForScene","getVariantSets","getHotspotsForScene","getBackdropsForScene","cameraEntity","unload","PlayCanvasViewer","_cameraPreviewSize","_activeCamera","_defaultCamera","_loader","_gltf","_activeGltfScene","_variantSetManager","_backdrops","_cameraPreviews","_debouncedCanvasResize","debounce","_resizeCanvas","_canvasResizeObserver","ResizeObserver","_canvasSizeElem","_initiated","_gltfLoaded","_noAnimations","_createApp","_createDefaultCamera","observe","getStats","_getStats","previewSource","sizeElem","clientWidth","clientHeight","cameraComponent","aspectRatioMode","aspectRatio","sizeElemAspectRatio","resizeCanvas","existingApp","assetPrefix","graphicsDeviceOptions","preserveDrawingBuffer","antialias","preferWebGl2","use3dPhysics","stats","ib","vram","vb","gltfScene","sort","aIsOrbit","unshift","_initHotspots","_initVariantSets","_initBackdrops","visibility","previews","orbitCamera","prevEnabled","toDataURL","_destroyHotspots","_destroyVariantSets","_destroyBackdrops","originalSkyboxAsset","_skyboxLast","originalSkyboxIntensity","setSkybox","onBackdropEnabled","destroyGltf","unobserve","prefix","configure","preload","setCanvasFillMode","sceneUrl","loadScene","_destroyCameraPreviews","init","_initCameraPreviews","animationIds","cameraId","cameraIndex","_focusOrbitCamera","_setSceneHierarchy","outline","canvasWrapper","shortest","backdropTransparent","backdropBorder","messageBox","maxWidth","Viewer","isEmpty","globalIsLoading","setSceneHierarchy","canvasRef","useRef","viewer","setViewer","onDropGltf","hasDropError","setHasDropError","onDrop","acceptedFiles","gltfBlob","basename","filePath","blobFileName","useDropzone","getRootProps","isDragActive","useGltfDrop","localIsLoading","hasLoadError","runAsync","hasError","showBackdrop","initialPrevent","preventInteraction","setPreventInteraction","handler","detachHandlers","usePreventableCameraInteractions","current","initiated","loadGltf","initAnimations","setActiveCamera","initCameraPreviews","activeSceneHierarchy","Backdrop","CircularProgress","Card","Gltf","selectedGltf","selectedLevelVariantSetId","showLevelVariantSet","view","setView","previousViewRef","setLevelVariantSets","Cameras","setCamera","RadioGroup","toString","html","topbarLogo","topbarLogoImage","objectPosition","topbarToggle","mainFullheight","viewport","flexGrow","viewportWithVisibleSidebar","viewportWithHiddenSidebar","sharp","leavingScreen","Root","isSmallScreen","useMediaQuery","breakpoints","showTopbar","showSidebar","showCameras","showFpsMeter","isSidebarOpen","setIsSidebarOpen","Hidden","xsDown","defaultTheme","Bootstrapper","setGltfs","initFromConfig","setTheme","minLoadingTime","setTimeout","ThemeProvider","CssBaseline","DracoDecoderModule","createDecoderModule","render"],"mappings":"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","file":"viewer/static/js/main.6e99e2b0.chunk.js","sourcesContent":["module.exports = React;","module.exports = ReactDOM;","module.exports = PropTypes;","module.exports = {\n  defaultConfig: {\n    assets: [],\n    topbar: true,\n    sidebar: true,\n    cameras: true,\n    dragAndDrop: true,\n    topbarTitle: \"Unreal glTF Viewer\",\n    topbarLogoUrl: \"viewer/logo.svg\",\n    theme: {\n      palette: {\n        primary: \"#3393FA\",\n      },\n    },\n  },\n};\n","module.exports = mobx;","/* istanbul ignore file */\nimport { createMuiTheme, Theme } from \"@material-ui/core/styles\";\nimport { ConfigTheme, defaultConfig } from \"./config\";\n\ndeclare module \"@material-ui/core/styles\" {\n  interface Theme {\n    topbarHeight: number;\n    sidebarWidth: number;\n    cameraPreviewWidth: number;\n    cameraPreviewHeight: number;\n    listAnimationDelay: number;\n  }\n  interface ThemeOptions {\n    topbarHeight: number;\n    sidebarWidth: number;\n    cameraPreviewWidth: number;\n    cameraPreviewHeight: number;\n    listAnimationDelay: number;\n  }\n}\n\nconst white = \"#FFFFFF\";\nconst grey50 = \"#EFEFF0\";\nconst grey100 = \"#EFEFF0\";\nconst grey200 = \"#BBBBBD\";\nconst grey300 = \"#93989F\";\nconst grey400 = \"#464E59\";\nconst grey500 = \"#2B323B\";\nconst grey600 = \"#252B32\";\nconst grey700 = \"#20262C\";\nconst grey800 = \"#1D2126\";\nconst grey900 = \"#1C1E22\";\nconst black = \"#000000\";\n\nexport function createTheme(config?: ConfigTheme): Theme {\n  return createMuiTheme({\n    palette: {\n      type: \"dark\",\n      text: {\n        primary: white,\n        secondary: grey200,\n        disabled: grey300,\n      },\n      background: {\n        default: grey900,\n        paper: grey900,\n      },\n      divider: black,\n      action: {\n        active: white,\n      },\n      common: {\n        black,\n        white,\n      },\n      grey: {\n        50: grey50,\n        100: grey100,\n        200: grey200,\n        300: grey300,\n        400: grey400,\n        500: grey500,\n        600: grey600,\n        700: grey700,\n        800: grey800,\n        900: grey900,\n      },\n      primary: {\n        main: config?.palette.primary ?? defaultConfig.theme.palette.primary,\n      },\n    },\n    typography: {\n      fontFamily: \"'Open Sans', 'Helvetica', 'Arial', sans-serif\",\n      fontWeightBold: 700,\n      fontWeightMedium: 600,\n      fontWeightRegular: 400,\n      fontWeightLight: 300,\n      fontSize: 12,\n    },\n    topbarHeight: 52,\n    sidebarWidth: 340,\n    cameraPreviewWidth: 96,\n    cameraPreviewHeight: 60,\n    listAnimationDelay: 25,\n  });\n}\n","import { observable, computed, action } from \"mobx\";\nimport { GltfSource, GltfScene, GltfCamera } from \"../types\";\nimport { VariantSetManager } from \"../variants\";\n\nexport class GltfStore {\n  private defaultGltf: string | null;\n\n  public constructor() {\n    const urlParams = new URLSearchParams(window.location.search);\n    this.defaultGltf = urlParams.get(\"gltf\");\n  }\n\n  @observable\n  public gltfs: GltfSource[] = [];\n\n  @observable\n  public gltf?: GltfSource;\n\n  @observable\n  public sceneHierarchy?: GltfScene;\n\n  @observable\n  public camera?: GltfCamera;\n\n  @observable\n  public levelVariantSetId?: number;\n\n  @computed\n  public get variantSetManager(): VariantSetManager | undefined {\n    return this.sceneHierarchy?.variantSetManager;\n  }\n\n  @computed\n  public get cameras(): GltfCamera[] {\n    return this.sceneHierarchy?.cameras ?? [];\n  }\n\n  @computed\n  public get hasBackdrops(): boolean {\n    return this.sceneHierarchy?.hasBackdrops ?? false;\n  }\n\n  @action.bound\n  public setGltf(gltf?: GltfSource) {\n    this.gltf = gltf;\n  }\n\n  @action.bound\n  public setCamera(camera?: GltfCamera) {\n    this.camera = camera;\n  }\n\n  @action.bound\n  public showLevelVariantSet(id?: number) {\n    this.levelVariantSetId = id;\n  }\n\n  @action.bound\n  public setGltfs(gltfs: GltfSource[]) {\n    this.gltfs = gltfs;\n\n    if (!this.gltf && gltfs.length > 0) {\n      if (this.defaultGltf) {\n        this.setGltf(gltfs.find(m => m.name === this.defaultGltf));\n      } else if (gltfs.length === 1) {\n        this.setGltf(gltfs[0]);\n      }\n    }\n  }\n\n  @action.bound\n  public setSceneHierarchy(sceneHierarchy?: GltfScene) {\n    this.camera = sceneHierarchy?.cameras[0];\n    this.sceneHierarchy = sceneHierarchy;\n    this.levelVariantSetId = undefined;\n  }\n}\n","import { observable, action, computed } from \"mobx\";\nimport { Config } from \"../config\";\n\nexport class SettingsStore {\n  @observable\n  private _showFpsMeter: boolean;\n\n  @observable\n  private _showTopbar = false;\n\n  @observable\n  private _showSidebar = true;\n\n  @observable\n  private _showCameras = false;\n\n  public constructor() {\n    const urlParams = new URLSearchParams(window.location.search);\n    this.showUI = !urlParams.get(\"hideUI\");\n    this._showFpsMeter = !!urlParams.get(\"showFpsMeter\");\n  }\n\n  @observable\n  public enableDragAndDrop = false;\n\n  @observable\n  public topbarTitle?: string;\n\n  @observable\n  public topbarLogoUrl?: string;\n\n  @observable\n  public showUI: boolean;\n\n  @computed\n  public get showTopbar(): boolean {\n    return this.showUI && this._showTopbar;\n  }\n\n  @computed\n  public get showSidebar(): boolean {\n    return this.showUI && this._showSidebar;\n  }\n\n  @computed\n  public get showCameras(): boolean {\n    return this.showUI && this._showCameras;\n  }\n\n  @computed\n  public get showFpsMeter(): boolean {\n    return this.showUI && this._showFpsMeter;\n  }\n\n  @action.bound\n  public initFromConfig(config: Config) {\n    this.enableDragAndDrop = config.dragAndDrop;\n    this.topbarTitle = config.topbarTitle;\n    this.topbarLogoUrl = config.topbarLogoUrl;\n    this._showTopbar = config.topbar;\n    this._showSidebar = config.sidebar;\n    this._showCameras = config.cameras;\n  }\n}\n","import React, { createContext, useContext } from \"react\";\nimport { GltfStore } from \"./GltfStore\";\nimport { SettingsStore } from \"./SettingsStore\";\n\nexport class RootStore {\n  public gltfStore = new GltfStore();\n  public settingsStore = new SettingsStore();\n}\n\nexport const RootStoreContext = createContext<RootStore>({} as RootStore);\n\nexport const RootStoreProvider: React.FC = ({ children }) => (\n  <RootStoreContext.Provider value={new RootStore()}>\n    {children}\n  </RootStoreContext.Provider>\n);\n\nexport const useStores = (): RootStore =>\n  useContext<RootStore>(RootStoreContext);\n","import { useCallback, useState } from \"react\";\nimport { useLoadingState } from \"./useLoadingState\";\n\nexport const useAsyncWithLoadingAndErrorHandling = (): [\n  boolean,\n  boolean,\n  (fn: () => Promise<void>) => void,\n] => {\n  const [isLoading, startLoadingTask, endLoadingTask] = useLoadingState();\n  const [isError, setIsError] = useState(false);\n\n  const runAsync = useCallback(\n    async (callback: () => Promise<void>) => {\n      setIsError(false);\n      startLoadingTask();\n      try {\n        await callback();\n      } catch (error) {\n        setIsError(true);\n        endLoadingTask();\n        throw error;\n      }\n      endLoadingTask();\n    },\n    [startLoadingTask, endLoadingTask, setIsError],\n  );\n\n  return [isLoading, isError, runAsync];\n};\n","import { useCallback, useState } from \"react\";\n\nexport const useLoadingState = (): [boolean, () => void, () => void] => {\n  const [loadingCount, setLoadingCount] = useState(0);\n\n  const onHandleIncrement = useCallback(() => setLoadingCount(c => c + 1), []);\n  const onHandleDecrement = useCallback(() => setLoadingCount(c => c - 1), []);\n\n  return [loadingCount > 0, onHandleIncrement, onHandleDecrement];\n};\n","export function readFile<\n  T extends \"text\" | \"arrayBuffer\" | \"dataURL\",\n  RT = T extends \"text\" | \"dataURL\"\n    ? string | null\n    : T extends \"arrayBuffer\"\n    ? ArrayBuffer | null\n    : never\n>(blob: Blob, readAs: T) {\n  return new Promise<RT>((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onabort = () => reject(\"File reading was aborted\");\n    reader.onerror = () => reject(\"File reading has failed\");\n    reader.onload = () => resolve((reader.result as unknown) as RT);\n    switch (readAs) {\n      case \"arrayBuffer\": {\n        reader.readAsArrayBuffer(blob);\n        break;\n      }\n      case \"dataURL\": {\n        reader.readAsDataURL(blob);\n        break;\n      }\n      default: {\n        reader.readAsText(blob);\n        break;\n      }\n    }\n  });\n}\n","import { readFile } from \"./readFile\";\n\nexport async function createGltfWithBlobAssets(gltf: File, assets: File[]) {\n  const gltfContent = await readFile(gltf, \"text\");\n  if (!gltfContent) {\n    return undefined;\n  }\n\n  const updatedGltf = assets.reduce((gltf, asset) => {\n    // Extract the guid part from the created asset url\n    const urlParts = URL.createObjectURL(asset).split(\"/\");\n    const assetUrlString = urlParts[urlParts.length - 1];\n    // Create an expression for matching asset references in the glTF file.\n    // This expression will match full JSON strings containing the asset name.\n    // The reason for this is that we want to also replace the directory name\n    // if the asset is not placed in the same directory as the glTF file.\n    const escapedName = asset.name.replace(/\\./g, \"\\\\.\");\n    const re = new RegExp(\n      `\"(?:[^\"]+)\"\\\\s*:\\\\s*\"(([^\"]+[\\\\/\\\\\\\\])?${escapedName})\",?`,\n      \"g\",\n    );\n    // Do the replacement\n    return gltf.replace(re, (match, g1) => match.replace(g1, assetUrlString));\n  }, gltfContent);\n\n  return new Blob([updatedGltf]);\n}\n","import path from \"path\";\nimport { useCallback, useState } from \"react\";\nimport { useDropzone, DropzoneRootProps } from \"react-dropzone\";\nimport { GltfSource } from \"../types\";\nimport { createGltfWithBlobAssets } from \"./utilities\";\n\nfunction isGltfFile(file: File) {\n  return !!path.extname(file.name).match(/\\.(gltf|glb)$/);\n}\n\nexport const useGltfDrop = (\n  onDropGltf: (file: GltfSource) => void,\n  enabled = true,\n): [\n  boolean,\n  boolean,\n  React.Dispatch<React.SetStateAction<boolean>>,\n  (props?: DropzoneRootProps) => DropzoneRootProps,\n] => {\n  const [hasDropError, setHasDropError] = useState(false);\n\n  const onDrop = useCallback(\n    async (acceptedFiles: File[]) => {\n      const gltf = acceptedFiles.find(isGltfFile);\n      const assets = acceptedFiles.filter(f => !isGltfFile(f));\n\n      if (!gltf) {\n        console.error(\n          \"The dropped file type is not supported. Drop a gltf or glb file.\",\n        );\n        setHasDropError(true);\n        return;\n      }\n\n      const gltfBlob: Blob | undefined =\n        assets.length > 0 && path.extname(gltf.name) === \".gltf\"\n          ? await createGltfWithBlobAssets(gltf, assets)\n          : gltf;\n\n      if (!gltfBlob) {\n        console.error(\"The dropped file could not be opened.\");\n        setHasDropError(true);\n        return;\n      }\n\n      setHasDropError(false);\n\n      onDropGltf({\n        name: path.basename(gltf.name, path.extname(gltf.name)),\n        filePath: URL.createObjectURL(gltfBlob),\n        blobFileName: gltf.name,\n      });\n    },\n    [onDropGltf],\n  );\n\n  const { getRootProps, isDragActive } = useDropzone({ onDrop });\n\n  if (!enabled) {\n    return [false, false, setHasDropError, () => ({})];\n  }\n\n  return [isDragActive, hasDropError, setHasDropError, getRootProps];\n};\n","import deepmerge from \"deepmerge\";\nimport { Config, defaultConfig } from \"./config\";\n\nexport async function fetchConfig(): Promise<Config> {\n  try {\n    const res = await fetch(\"index.json\");\n    const overrides = (await res.json()) as Partial<Config>;\n    return deepmerge(defaultConfig, overrides);\n  } catch (e) {\n    // Ignore since it should be possible to start the application\n    // without assets\n  }\n\n  return defaultConfig;\n}\n","import {\n  ColorObject,\n  decomposeColor,\n  recomposeColor,\n} from \"@material-ui/core/styles/colorManipulator\";\n\nfunction mixColorChannel(channelA: number, channelB: number, weight: number) {\n  channelA = channelA * weight;\n  channelB = channelB * (1 - weight);\n  return Math.round(channelA + channelB);\n}\n\nexport function mixColor(\n  color1: string,\n  color2: string,\n  weight: number,\n): string {\n  weight = Math.min(Math.max(0, weight), 1);\n\n  const color1Object = decomposeColor(color1);\n  const color2Object = decomposeColor(color2);\n\n  if (color1Object.type !== color2Object.type) {\n    throw new Error(\"Cannot mix colors of different formats.\");\n  }\n\n  if (\n    [\"rgba\", \"hsla\"].includes(color1Object.type) ||\n    [\"rgba\", \"hsla\"].includes(color2Object.type)\n  ) {\n    throw new Error(\"Cannot mix colors with alpha channel.\");\n  }\n\n  const newColor: ColorObject = {\n    type: color1Object.type,\n    values: [\n      mixColorChannel(color1Object.values[0], color2Object.values[0], weight),\n      mixColorChannel(color1Object.values[1], color2Object.values[1], weight),\n      mixColorChannel(color1Object.values[2], color2Object.values[2], weight),\n    ],\n  };\n\n  return recomposeColor(newColor);\n}\n","var _mask, _g, _mask2, _g2, _circle, _ellipse;\n\nvar _excluded = [\"svgRef\", \"title\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgOrbit = function SvgOrbit(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 22,\n    height: 22,\n    viewBox: \"0 0 22 22\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _mask || (_mask = /*#__PURE__*/React.createElement(\"mask\", {\n    id: \"mask0\",\n    \"mask-type\": \"alpha\",\n    maskUnits: \"userSpaceOnUse\",\n    x: 1,\n    y: 4,\n    width: 20,\n    height: 16\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M14 18L1.5 19.5V11H11L7.5 4H15L21 7.5L19.5 11H11L14 18Z\",\n    fill: \"#C4C4C4\"\n  }))), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    mask: \"url(#mask0)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M11.8702 5.17048C12.0558 5.37492 12.0406 5.69113 11.8361 5.87677L11.4559 6.22205C13.2607 6.29197 14.9052 6.77417 16.1414 7.53978C17.4733 8.36474 18.3989 9.56969 18.3989 10.9865C18.3989 12.8147 16.8735 14.28 14.8628 15.0671C14.6056 15.1677 14.3156 15.0409 14.2149 14.7837C14.1142 14.5266 14.2411 14.2365 14.4982 14.1359C16.3555 13.4088 17.3989 12.202 17.3989 10.9865C17.3989 10.0433 16.78 9.1116 15.6148 8.38992C14.5338 7.72039 13.0403 7.27515 11.3592 7.2192L11.8441 7.67923C12.0445 7.86929 12.0528 8.18576 11.8627 8.38609C11.6727 8.58642 11.3562 8.59475 11.1559 8.40469L9.79036 7.10922L9.39955 6.73845L9.79837 6.37632L11.1639 5.13643C11.3683 4.95079 11.6845 4.96604 11.8702 5.17048ZM7.78398 7.18934C7.88464 7.44648 7.75779 7.73653 7.50064 7.83719C5.64334 8.56424 4.59998 9.77104 4.59998 10.9865C4.59998 11.9298 5.21888 12.8615 6.38406 13.5831C7.46436 14.2523 8.95665 14.6974 10.6364 14.7538L10.1653 14.3293C9.96016 14.1444 9.9437 13.8283 10.1285 13.6231C10.3134 13.418 10.6295 13.4015 10.8347 13.5864L12.2393 14.8519L12.6509 15.2228L12.2399 15.5943L10.8353 16.8641C10.6305 17.0493 10.3143 17.0333 10.1291 16.8285C9.94391 16.6236 9.95985 16.3075 10.1647 16.1223L10.5741 15.7522C8.75704 15.6866 7.10072 15.2033 5.85751 14.4333C4.52557 13.6083 3.59998 12.4034 3.59998 10.9865C3.59998 9.15836 5.12539 7.6931 7.13612 6.906C7.39327 6.80534 7.68332 6.93219 7.78398 7.18934Z\",\n    fill: \"currentColor\"\n  }))), _mask2 || (_mask2 = /*#__PURE__*/React.createElement(\"mask\", {\n    id: \"mask1\",\n    \"mask-type\": \"alpha\",\n    maskUnits: \"userSpaceOnUse\",\n    x: 2,\n    y: 6,\n    width: 18,\n    height: 12\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4 7.5L7.5 6L11 11L16 10L20 9L18 15.5L14.5 17.5L13 15.5L11 11L2 13L4 7.5Z\",\n    fill: \"#C4C4C4\"\n  }))), _g2 || (_g2 = /*#__PURE__*/React.createElement(\"g\", {\n    mask: \"url(#mask1)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M10.9994 15.2597C7.18897 15.2597 4.09998 13.3465 4.09998 10.9864C4.09998 9.46461 5.38437 8.12857 7.31838 7.3715M10.9994 6.71313C14.8099 6.71313 17.8989 8.62636 17.8989 10.9864C17.8989 12.5083 16.6145 13.8443 14.6805 14.6014\",\n    stroke: \"currentColor\",\n    strokeWidth: 1,\n    strokeDasharray: \"1.5 1\"\n  }))), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 11,\n    cy: 11,\n    r: 1.5,\n    fill: \"currentColor\"\n  })), _ellipse || (_ellipse = /*#__PURE__*/React.createElement(\"ellipse\", {\n    opacity: 0.1,\n    cx: 11,\n    cy: 11,\n    rx: 7,\n    ry: 4.5,\n    fill: \"currentColor\"\n  })));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgOrbit, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"viewer/static/media/Orbit.1b2d3825.svg\";\nexport { ForwardRef as ReactComponent };","import React, { ReactNode } from \"react\";\nimport { makeStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\n\nconst useStyles = makeStyles(theme => {\n  const offset = \"100px\";\n  const to = { opacity: 1, transform: \"translate3d(0, 0, 0)\" };\n  return {\n    \"@keyframes default\": {\n      from: { opacity: 0 },\n      to: { opacity: 1 },\n    },\n    \"@keyframes slideInLeft\": {\n      from: { opacity: 0, transform: `translate3d(${offset}, 0, 0)` },\n      to,\n    },\n    \"@keyframes slideInRight\": {\n      from: { opacity: 0, transform: `translate3d(-${offset}, 0, 0)` },\n      to,\n    },\n    \"@keyframes slideInUp\": {\n      from: { opacity: 0, transform: `translate3d(0, ${offset}, 0)` },\n      to,\n    },\n    \"@keyframes slideInDown\": {\n      from: { opacity: 0, transform: `translate3d(0, -${offset}, 0)` },\n      to,\n    },\n    root: {\n      opacity: 0,\n      animationName: \"$default\",\n      animationFillMode: \"forwards\",\n      animationTimingFunction: theme.transitions.easing.easeOut,\n      animationDuration: `${theme.transitions.duration.enteringScreen}ms`,\n    },\n    left: {\n      animationName: \"$slideInLeft\",\n    },\n    right: {\n      animationName: \"$slideInRight\",\n    },\n    up: {\n      animationName: \"$slideInUp\",\n    },\n    down: {\n      animationName: \"$slideInDown\",\n    },\n  };\n});\n\nexport type AppearProps = {\n  children?: ReactNode;\n  direction?: \"left\" | \"right\" | \"up\" | \"down\";\n  duration?: number;\n  delay?: number;\n};\n\nexport const Appear: React.FC<AppearProps> = ({\n  children,\n  direction,\n  duration,\n  delay,\n}) => {\n  const classes = useStyles();\n\n  return (\n    <div\n      className={clsx(classes.root, {\n        [classes.left]: direction === \"left\",\n        [classes.right]: direction === \"right\",\n        [classes.up]: direction === \"up\",\n        [classes.down]: direction === \"down\",\n      })}\n      style={{\n        animationDuration: duration ? `${duration}ms` : undefined,\n        animationDelay: delay ? `${delay}ms` : undefined,\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n","var _path, _path2, _path3, _path4, _path5, _path6, _ellipse, _path7, _path8, _path9, _path10;\n\nvar _excluded = [\"svgRef\", \"title\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgPointOfView = function SvgPointOfView(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 17,\n    height: 12,\n    viewBox: \"0 0 17 12\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    opacity: 0.1,\n    d: \"M8.5 1V10L2 4L4.5 2L7.5 1H8.5Z\",\n    fill: \"currentColor\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M8.49996 10L7.32239 8.91309\",\n    stroke: \"currentColor\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.33914 5.47879C4.13623 5.29149 3.8199 5.30414 3.6326 5.50705C3.4453 5.70996 3.45795 6.02629 3.66086 6.21359L4.33914 5.47879ZM3.66086 6.21359L4.03586 6.55975L4.71414 5.82494L4.33914 5.47879L3.66086 6.21359ZM4.78586 7.25205L5.53586 7.94436L6.21414 7.20956L5.46414 6.51725L4.78586 7.25205ZM6.28586 8.63667L7.03586 9.32898L7.71414 8.59417L6.96414 7.90187L6.28586 8.63667ZM7.78586 10.0213L8.16086 10.3674L8.83914 9.63264L8.46414 9.28648L7.78586 10.0213Z\",\n    fill: \"currentColor\"\n  })), _path4 || (_path4 = /*#__PURE__*/React.createElement(\"path\", {\n    opacity: 0.1,\n    d: \"M8.5 1V10L15 4L12.5 2L9.5 1H8.5Z\",\n    fill: \"currentColor\"\n  })), _path5 || (_path5 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M12.6609 5.47879C12.8638 5.29149 13.1801 5.30414 13.3674 5.50705C13.5547 5.70996 13.5421 6.02629 13.3391 6.21359L12.6609 5.47879ZM13.3391 6.21359L12.9641 6.55975L12.2859 5.82494L12.6609 5.47879L13.3391 6.21359ZM12.2141 7.25205L11.4641 7.94436L10.7859 7.20956L11.5359 6.51725L12.2141 7.25205ZM10.7141 8.63667L9.96414 9.32898L9.28586 8.59417L10.0359 7.90187L10.7141 8.63667ZM9.21414 10.0213L8.83914 10.3674L8.16086 9.63264L8.53586 9.28648L9.21414 10.0213Z\",\n    fill: \"currentColor\"\n  })), _path6 || (_path6 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M8.50004 10L9.67761 8.91309\",\n    stroke: \"currentColor\"\n  })), _ellipse || (_ellipse = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 8.50009,\n    cy: 9.78971,\n    rx: 1.40625,\n    ry: 1.38785,\n    fill: \"currentColor\"\n  })), _path7 || (_path7 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M2.53455 2.94698C2.33236 3.13506 2.32091 3.45143 2.50899 3.65363C2.69706 3.85582 3.01344 3.86726 3.21563 3.67919L2.53455 2.94698ZM3.21563 3.67919C4.57018 2.41922 6.52823 1.5 8.5001 1.5V0.5C6.23455 0.5 4.04178 1.54499 2.53455 2.94698L3.21563 3.67919Z\",\n    fill: \"currentColor\"\n  })), _path8 || (_path8 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.82086 4.41481L1.31758 4.41471L1.31758 4.95116L1.85954 4.91005L1.82086 4.41481ZM2.32411 2.6635C2.32411 2.38918 2.09878 2.16675 1.82083 2.16669C1.54287 2.16664 1.31755 2.38897 1.31755 2.66329L2.32411 2.6635ZM3.4816 4.787C3.75873 4.76598 3.96607 4.52721 3.94471 4.2537C3.92335 3.98019 3.68137 3.7755 3.40424 3.79653L3.4816 4.787ZM2.19339 4.74886C2.37737 4.54901 3.037 3.85256 3.22786 3.66738L2.52212 2.95891C2.30928 3.16541 1.63313 3.88001 1.44832 4.08076L2.19339 4.74886ZM2.32414 4.41491L2.32411 2.6635L1.31755 2.66329L1.31758 4.41471L2.32414 4.41491ZM1.85954 4.91005L3.4816 4.787L3.40424 3.79653L1.78217 3.91957L1.85954 4.91005Z\",\n    fill: \"currentColor\"\n  })), _path9 || (_path9 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M14.4655 2.94698C14.6677 3.13506 14.6792 3.45143 14.4911 3.65363C14.303 3.85582 13.9867 3.86726 13.7845 3.67919L14.4655 2.94698ZM13.7845 3.67919C12.4299 2.41922 10.4719 1.5 8.49999 1.5V0.5C10.7655 0.5 12.9583 1.54499 14.4655 2.94698L13.7845 3.67919Z\",\n    fill: \"currentColor\"\n  })), _path10 || (_path10 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M15.1791 4.41476L15.6824 4.41461L15.6825 4.95112L15.1404 4.90999L15.1791 4.41476ZM14.6757 2.66345C14.6757 2.38913 14.901 2.16669 15.179 2.16661C15.4569 2.16653 15.6823 2.38885 15.6823 2.66316L14.6757 2.66345ZM13.5182 4.78692C13.2411 4.76589 13.0338 4.52712 13.0551 4.25361C13.0765 3.9801 13.3185 3.77542 13.5956 3.79644L13.5182 4.78692ZM14.8066 4.74881C14.6226 4.54896 13.963 3.85251 13.7721 3.66733L14.4779 2.95885C14.6907 3.16536 15.3669 3.87995 15.5517 4.08071L14.8066 4.74881ZM14.6759 4.4149L14.6757 2.66345L15.6823 2.66316L15.6824 4.41461L14.6759 4.4149ZM15.1404 4.90999L13.5182 4.78692L13.5956 3.79644L15.2178 3.91952L15.1404 4.90999Z\",\n    fill: \"currentColor\"\n  })));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgPointOfView, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"viewer/static/media/PointOfView.8d5a65bd.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _path2, _path3;\n\nvar _excluded = [\"svgRef\", \"title\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgDragDrop = function SvgDragDrop(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 83,\n    height: 84,\n    viewBox: \"0 0 83 84\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M42 35H21L21 56H34.2949L34.7564 58H21C19.8954 58 19 57.1046 19 56V35C19 33.8954 19.8954 33 21 33H42C43.1046 33 44 33.8954 44 35V48.7562L42 48.2947V35Z\",\n    fill: \"currentColor\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M44.7627 54.9818L47.4149 52.3296C47.6926 52.0519 47.5564 51.5772 47.1738 51.4889L35.3628 48.7633C35.0027 48.6802 34.6801 49.0028 34.7632 49.3629L37.4888 61.1739C37.5771 61.5565 38.0518 61.6927 38.3295 61.415L41.2271 58.5174L46.7267 64.017C46.922 64.2122 47.2386 64.2122 47.4338 64.017L50.2623 61.1885C50.4575 60.9933 50.4575 60.6767 50.2623 60.4814L44.7627 54.9818Z\",\n    fill: \"currentColor\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M39 25.8062V24.392L40.392 23H41.8062L39 25.8062ZM39 28.2118L44.2118 23H45.626L39 29.626V28.2118ZM39 32.0316L48.0316 23H49.4459L39.4459 33H39V32.0316ZM44 47.545L64 27.545V26.1308L44 46.1308V47.545ZM44 43.7252L63.9698 23.7553C63.8828 23.4092 63.6153 23.1347 63.2732 23.0378L44 42.3109V43.7252ZM44 39.9053L60.9053 23H59.4911L44 38.4911V39.9053ZM44 36.0855L57.0855 23H55.6713L43.9768 34.6945C43.9921 34.7941 44 34.8961 44 35V36.0855ZM42.9988 33.2669L53.2657 23H51.8515L41.8515 33H42C42.3638 33 42.7049 33.0971 42.9988 33.2669ZM45.9506 48L64 29.9506V31.3648L47.3648 48H45.9506ZM49.7704 48L64 33.7704V35.1846L51.1846 48H49.7704ZM53.5902 48L64 37.5902V39.0045L55.0045 48H53.5902ZM57.4101 48L64 41.4101V42.8243L58.8243 48H57.4101ZM61.2299 48L64 45.2299V46.6441L62.6441 48H61.2299Z\",\n    fill: \"#3393FA\"\n  })));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgDragDrop, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"viewer/static/media/DragDrop.f52d91eb.svg\";\nexport { ForwardRef as ReactComponent };","import React, { cloneElement } from \"react\";\nimport { makeStyles, useRadioGroup } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport { ReactComponent as Orbit } from \"../icons/Orbit.svg\";\nimport { ReactComponent as PointOfView } from \"../icons/PointOfView.svg\";\nimport { AppearProps } from \"./Appear\";\n\nconst useStyles = makeStyles(theme => {\n  const dropShadow =\n    \"0px 15px 25px rgba(0, 0, 0, 0.15), 0px 5px 10px rgba(0, 0, 0, 0.05)\";\n\n  return {\n    root: {\n      marginBottom: theme.spacing(1.5),\n      marginRight: theme.spacing(1.5),\n    },\n    input: {\n      position: \"absolute\",\n      opacity: 0,\n      pointerEvents: \"none\",\n    },\n    button: {\n      position: \"relative\",\n      width: theme.cameraPreviewWidth,\n      height: theme.cameraPreviewHeight,\n      borderRadius: theme.shape.borderRadius,\n      backgroundColor: theme.palette.common.black,\n      backgroundSize: \"contain\",\n      backgroundPosition: \"center\",\n      backgroundRepeat: \"no-repeat\",\n      boxShadow: dropShadow,\n      cursor: \"pointer\",\n      overflow: \"hidden\",\n      transition: theme.transitions.create([\"box-shadow\"], {\n        duration: theme.transitions.duration.short,\n      }),\n      \"&:hover:not($buttonChecked)\": {\n        boxShadow: dropShadow + `, 0 0 0 2px ${theme.palette.grey[300]} inset`,\n      },\n    },\n    buttonChecked: {\n      boxShadow: dropShadow + `, 0 0 0 2px ${theme.palette.primary.main} inset`,\n    },\n    icon: {\n      position: \"absolute\",\n      bottom: theme.spacing(1),\n      right: theme.spacing(1),\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      width: 22,\n      height: 22,\n      borderRadius: \"50%\",\n      backgroundColor: theme.palette.grey[900],\n    },\n  };\n});\n\nexport type CameraProps = {\n  appear?: React.ReactElement<AppearProps>;\n  type?: \"Static\" | \"FreeLook\" | \"Orbital\";\n  autoFocus?: boolean;\n  checked?: boolean;\n  id?: string;\n  image: string;\n  name?: string;\n  tabIndex?: number;\n  value?: string | number | string[];\n  onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void;\n};\n\nexport const Camera: React.FC<CameraProps> = ({\n  appear,\n  type = \"Static\",\n  autoFocus,\n  checked: checkedProp,\n  id,\n  image,\n  name: nameProp,\n  tabIndex,\n  value,\n  onChange,\n}) => {\n  const classes = useStyles();\n  const radioGroup = useRadioGroup();\n\n  const checked =\n    typeof checkedProp === \"undefined\"\n      ? radioGroup?.value === value\n      : checkedProp;\n  const name = typeof nameProp === \"undefined\" ? radioGroup?.name : nameProp;\n\n  const _onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (onChange) {\n      onChange(e);\n    }\n    if (radioGroup?.onChange) {\n      radioGroup.onChange(e, e.target.value);\n    }\n  };\n\n  const content = (\n    <div\n      className={clsx(classes.button, {\n        [classes.buttonChecked]: checked,\n      })}\n      style={{ backgroundImage: `url(${image})` }}\n    >\n      {type !== \"Static\" && (\n        <div className={classes.icon}>\n          {(() => {\n            switch (type) {\n              case \"Orbital\":\n                return <Orbit />;\n              case \"FreeLook\":\n                return <PointOfView />;\n            }\n          })()}\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <label className={classes.root}>\n      <input\n        autoFocus={autoFocus}\n        checked={checked}\n        className={classes.input}\n        id={id}\n        name={name}\n        onChange={_onChange}\n        tabIndex={tabIndex}\n        type=\"radio\"\n        value={value}\n      />\n      {appear ? cloneElement(appear, { children: content }) : content}\n    </label>\n  );\n};\n","var _path, _path2, _path3, _path4, _path5, _defs;\n\nvar _excluded = [\"svgRef\", \"title\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgError = function SvgError(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 50,\n    height: 42,\n    viewBox: \"0 0 50 42\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M37.8141 10.5093V3.79999C37.8141 2.69542 36.9187 1.79999 35.8141 1.79999L17.9796 1.79999C17.4457 1.79999 16.934 2.01345 16.5584 2.39285L8.28937 10.7448C8.10399 10.9321 8 11.1849 8 11.4484V38.2C8 39.3046 8.89543 40.2 10 40.2H35.8141C36.9187 40.2 37.8141 39.3044 37.8141 38.1998C37.8141 37.6734 37.8141 37.1762 37.8141 36.901\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M8 29.0144L12.9646 24L17.9292 29.0144L22.8938 24L27.9083 29.0144L32.9227 24L37.9371 29.0144\",\n    stroke: \"currentcolor\",\n    strokeLinecap: \"round\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M9 12H18V3\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\"\n  })), _path4 || (_path4 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M36.4421 14.1476C36.9938 13.1673 38.3731 13.1673 38.9248 14.1476L48.8556 31.7923C49.4073 32.7726 48.7177 33.9979 47.6143 33.9979H27.7526C26.6492 33.9979 25.9596 32.7726 26.5113 31.7923L36.4421 14.1476Z\",\n    fill: \"url(#paint0_linear)\"\n  })), _path5 || (_path5 = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M38.8141 20.5381C38.8141 19.9858 38.3664 19.5381 37.8141 19.5381C37.2618 19.5381 36.8141 19.9858 36.8141 20.5381V25.0247C36.8141 25.577 37.2618 26.0247 37.8141 26.0247C38.3664 26.0247 38.8141 25.577 38.8141 25.0247V20.5381ZM38.8141 28.9834C38.8141 28.4312 38.3664 27.9834 37.8141 27.9834C37.2618 27.9834 36.8141 28.4312 36.8141 28.9834V29.5113C36.8141 30.0636 37.2618 30.5113 37.8141 30.5113C38.3664 30.5113 38.8141 30.0636 38.8141 29.5113V28.9834Z\",\n    fill: \"currentcolor\"\n  })), _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"linearGradient\", {\n    id: \"paint0_linear\",\n    x1: 37.7406,\n    y1: 16.3154,\n    x2: 37.7406,\n    y2: 31.0948,\n    gradientUnits: \"userSpaceOnUse\"\n  }, /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#F04C5A\"\n  }), /*#__PURE__*/React.createElement(\"stop\", {\n    offset: 1,\n    stopColor: \"#EE7B5C\"\n  })))));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgError, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"viewer/static/media/Error.b64c0fb2.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _path2, _path3, _path4, _path5, _path6, _path7;\n\nvar _excluded = [\"svgRef\", \"title\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgEmptyConfiguration = function SvgEmptyConfiguration(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 56,\n    height: 56,\n    viewBox: \"0 0 56 56\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M27.7773 42.5814L27.7773 13.5505\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M15.974 42.5814L15.974 13.5505\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M39.5806 42.5814L39.5806 13.5505\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\"\n  })), _path4 || (_path4 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M41.9905 35.1917C41.9905 36.5401 40.9057 37.6227 39.5806 37.6227C38.2555 37.6227 37.1708 36.5401 37.1708 35.1917C37.1708 33.8433 38.2555 32.7608 39.5806 32.7608C40.9057 32.7608 41.9905 33.8433 41.9905 35.1917Z\",\n    fill: \"#1C1E22\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2\n  })), _path5 || (_path5 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M18.3838 20.9402C18.3838 22.2886 17.2991 23.3711 15.974 23.3711C14.6489 23.3711 13.5641 22.2886 13.5641 20.9402C13.5641 19.5918 14.6489 18.5093 15.974 18.5093C17.2991 18.5093 18.3838 19.5918 18.3838 20.9402Z\",\n    fill: \"#1C1E22\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2\n  })), _path6 || (_path6 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M30.1872 28.0659C30.1872 29.4143 29.1025 30.4969 27.7773 30.4969C26.4522 30.4969 25.3675 29.4143 25.3675 28.0659C25.3675 26.7176 26.4522 25.635 27.7773 25.635C29.1025 25.635 30.1872 26.7176 30.1872 28.0659Z\",\n    fill: \"#1C1E22\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2\n  })), _path7 || (_path7 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M54.0561 28.0659C54.0561 42.6783 42.2849 54.5134 27.7773 54.5134C13.2697 54.5134 1.49854 42.6783 1.49854 28.0659C1.49854 13.4536 13.2697 1.61853 27.7773 1.61853C42.2849 1.61853 54.0561 13.4536 54.0561 28.0659Z\",\n    stroke: \"currentcolor\",\n    strokeWidth: 2\n  })));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgEmptyConfiguration, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"viewer/static/media/EmptyConfiguration.9e8675d6.svg\";\nexport { ForwardRef as ReactComponent };","var _path;\n\nvar _excluded = [\"svgRef\", \"title\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgCheck = function SvgCheck(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 10,\n    height: 7,\n    viewBox: \"0 0 10 7\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M3.84717 3.94151L7.57347 0.545648C7.91337 0.23589 8.43269 0.23409 8.77473 0.541484C9.16861 0.895465 9.17075 1.51214 8.77933 1.86885L3.84717 6.36363L0.731052 3.52385C0.339638 3.16715 0.341777 2.55047 0.735655 2.19649C1.07769 1.88909 1.59701 1.89089 1.93691 2.20065L3.84717 3.94151Z\",\n    fill: \"currentColor\"\n  })));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgCheck, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"viewer/static/media/Check.472dd59f.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\nimport { makeStyles, Typography } from \"@material-ui/core\";\nimport { ReactComponent as DragDropIcon } from \"../icons/DragDrop.svg\";\nimport { ReactComponent as ErrorIcon } from \"../icons/Error.svg\";\nimport { ReactComponent as EmptyConfigurationIcon } from \"../icons/EmptyConfiguration.svg\";\n\nconst useStyles = makeStyles(theme => {\n  const iconCircleSize = 88;\n  return {\n    root: {\n      padding: theme.spacing(5),\n      textAlign: \"center\",\n    },\n    icon: {\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      marginLeft: \"auto\",\n      marginRight: \"auto\",\n      marginBottom: theme.spacing(4),\n      width: iconCircleSize,\n      height: iconCircleSize,\n      borderRadius: \"50%\",\n      backgroundColor: theme.palette.grey[700],\n    },\n  };\n});\n\nexport type MessageBoxProps = {\n  icon?: \"empty\" | \"error\" | \"dragdrop\";\n  overline?: string;\n  title: string;\n};\n\nexport const MessageBox: React.FC<MessageBoxProps> = ({\n  icon: type,\n  children,\n  overline,\n  title,\n}) => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      {type && (\n        <div className={classes.icon}>\n          {(() => {\n            switch (type) {\n              case \"empty\":\n                return <EmptyConfigurationIcon />;\n              case \"error\":\n                return <ErrorIcon />;\n              case \"dragdrop\":\n                return <DragDropIcon />;\n            }\n          })()}\n        </div>\n      )}\n      {overline && (\n        <Typography variant=\"overline\" color=\"textSecondary\">\n          {overline}\n        </Typography>\n      )}\n      <Typography variant=\"h6\" gutterBottom>\n        {title}\n      </Typography>\n      <Typography variant=\"body2\" color=\"textSecondary\">\n        {children}\n      </Typography>\n    </div>\n  );\n};\n","import React, { useEffect, useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { observable, computed, action } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\n\nconst graphHeight = 40;\nconst graphWidth = 250;\nconst barColors = [\n  \"#F44336\",\n  \"#FF9800\",\n  \"#FFC107\",\n  \"#FFEB3B\",\n  \"#CDDC39\",\n  \"#8BC34A\",\n  \"#4CAF50\",\n];\n\nconst useStyles = makeStyles(theme => {\n  const { fontSize, fontWeightBold: fontWeight } = theme.typography;\n  const internalSpacing = theme.spacing(0.5);\n  const externalSpacing = theme.spacing(2);\n  const backgroundColor = theme.palette.common.black;\n  return {\n    root: {\n      zIndex: 2,\n      position: \"absolute\",\n      top: externalSpacing,\n      left: externalSpacing,\n      height: graphHeight + fontSize + internalSpacing * 3,\n      width: graphWidth + internalSpacing * 2,\n      padding: internalSpacing,\n      backgroundColor: backgroundColor,\n      color: theme.palette.getContrastText(backgroundColor),\n      fontSize: fontSize,\n      lineHeight: 1,\n      fontWeight: fontWeight,\n      MozBoxSizing: \"border-box\",\n      boxSizing: \"border-box\",\n      pointerEvents: \"none\",\n    },\n    graph: {\n      position: \"absolute\",\n      left: internalSpacing,\n      right: internalSpacing,\n      bottom: internalSpacing,\n      height: graphHeight,\n      backgroundColor: \"#282844\",\n      MozBoxSizing: \"border-box\",\n      boxSizing: \"border-box\",\n    },\n    bar: {\n      position: \"absolute\",\n      bottom: 0,\n      width: 1,\n      boxSizing: \"border-box\",\n    },\n  };\n});\n\nclass FpsCalculator {\n  @observable public fps: Array<number> = [];\n  private prevTime = performance.now();\n  private frames = 0;\n  private req = 0;\n\n  public constructor() {\n    this.start();\n  }\n\n  @computed public get lastFps() {\n    return this.fps[this.fps.length - 1] || 0;\n  }\n\n  @computed public get maxFps() {\n    return Math.min(60, Math.max.apply(Math.max, this.fps));\n  }\n\n  @computed public get minFps() {\n    return Math.max(0, Math.min.apply(Math.min, this.fps));\n  }\n\n  @computed public get avgFps() {\n    return Math.round(\n      this.fps.reduce((acc, cur) => acc + cur, 0) / this.fps.length,\n    );\n  }\n\n  @action\n  private calc(currentTime: number) {\n    const { prevTime } = this;\n    const nextFrames = this.frames + 1;\n    this.frames = nextFrames;\n    if (currentTime > prevTime + 50) {\n      let nextFps = Math.round((nextFrames * 1000) / (currentTime - prevTime));\n      if (nextFps > 60) {\n        nextFps = 60;\n      }\n      const fps = [...this.fps, nextFps];\n      this.fps = fps.length > graphWidth ? fps.slice(1, graphWidth + 1) : fps;\n      this.prevTime = currentTime;\n      this.frames = 0;\n    }\n    this.start();\n  }\n\n  public start() {\n    this.req = requestAnimationFrame(this.calc.bind(this));\n  }\n\n  public stop() {\n    cancelAnimationFrame(this.req);\n  }\n}\n\nexport const FpsMonitor: React.FC = observer(() => {\n  const classes = useStyles();\n  const [calculator, setCalculator] = useState<FpsCalculator>();\n\n  useEffect(() => {\n    const instance = new FpsCalculator();\n    setCalculator(instance);\n    return () => {\n      instance.stop();\n      setCalculator(undefined);\n    };\n  }, []);\n\n  if (!calculator) {\n    return null;\n  }\n\n  const { fps, lastFps, avgFps, minFps, maxFps } = calculator;\n\n  return (\n    <div className={classes.root}>\n      <span>\n        FPS: {lastFps} MIN: {minFps} AVG: {avgFps} MAX: {maxFps}\n      </span>\n      <div className={classes.graph}>\n        {fps.map((f, i) => {\n          const height = (graphHeight * f) / 60;\n          const backgroundColor = barColors[Math.floor(f / 10)];\n          const right = fps.length - 1 - i + \"px\";\n          return (\n            <div\n              key={`fps-${i}`}\n              className={classes.bar}\n              style={{ backgroundColor, height, right }}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core\";\n\nconst useStyles = makeStyles(() => ({\n  list: {\n    position: \"relative\",\n    margin: 0,\n    padding: 0,\n    listStyle: \"none\",\n  },\n}));\n\nexport type NavListProps = {};\n\nexport const NavList: React.FC<NavListProps> = ({ children }) => {\n  const classes = useStyles();\n  return <ul className={classes.list}>{children}</ul>;\n};\n","import React, { cloneElement } from \"react\";\nimport { makeStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport { AppearProps } from \"./Appear\";\n\nconst useStyles = makeStyles(theme => {\n  const borderBoxShadow = `1px 0 0 0 ${theme.palette.grey[500]} inset`;\n  return {\n    item: {\n      display: \"flex\",\n      alignItems: \"center\",\n      padding: theme.spacing(1.25, 0, 1.25, 2),\n      boxShadow: borderBoxShadow,\n      cursor: \"pointer\",\n      fontSize: 14,\n      \"&:hover\": {\n        boxShadow:\n          `2px 0 0 0 ${theme.palette.primary.main} inset, ` + borderBoxShadow,\n      },\n    },\n    selected: {\n      \"&::before\": {\n        display: \"inline-block\",\n        height: 6,\n        width: 6,\n        marginRight: theme.spacing(1),\n        borderRadius: \"50%\",\n        backgroundColor: theme.palette.primary.main,\n        content: \"''\",\n      },\n    },\n  };\n});\n\nexport type NavListItemProps = {\n  appear?: React.ReactElement<AppearProps>;\n  selected?: boolean;\n  onClick?: () => void;\n};\n\nexport const NavListItem: React.FC<NavListItemProps> = ({\n  children,\n  appear,\n  selected,\n  onClick,\n}) => {\n  const classes = useStyles();\n\n  const content = (\n    <li\n      onClick={onClick}\n      className={clsx(classes.item, {\n        [classes.selected]: selected,\n      })}\n    >\n      {children}\n    </li>\n  );\n\n  return appear ? cloneElement(appear, { children: content }) : content;\n};\n","export enum AnimationState {\n  Loop = \"LOOP\",\n  LoopReverse = \"LOOP_REVERSE\",\n  Once = \"ONCE\",\n  OnceReverse = \"ONCE_REVERSE\",\n}\n\n/**\n * Wrapper for pc.AnimComponentLayer assigned to a specific pc.Entity.\n */\nexport class Animation {\n  public constructor(\n    private _node: pc.Entity,\n    private _layer: pc.AnimComponentLayer,\n    private _index: number,\n    private _defaultState?: AnimationState,\n    private _autoPlay = false,\n    private _initialStartTime?: number,\n  ) {\n    this._layer.pause();\n  }\n\n  public get node() {\n    return this._node;\n  }\n\n  public get index() {\n    return this._index;\n  }\n\n  public get name() {\n    return this._layer.name;\n  }\n\n  public get playable() {\n    return this._layer.playable;\n  }\n\n  public get defaultState() {\n    return this._defaultState;\n  }\n\n  public get activeState() {\n    return this._layer.activeState;\n  }\n\n  public get activeStateClipTime() {\n    // TODO: This is a hack to get the current clip time,\n    // which we need to use as start-time when switching between\n    // states with different directions, a.k.a ping-ponging.\n    // Using activeStateCurrentTime from the layer leads to\n    // incorrect results in this case, since it calculates time differently.\n    // We should fix or extend the engine to remove the need for this hack.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const controller = (this._layer as any)._controller;\n    if (controller.activeStateAnimations.length < 1) {\n      return 0;\n    }\n\n    const activeClip = controller._animEvaluator.findClip(\n      controller.activeStateAnimations[0].name,\n    );\n\n    return activeClip ? activeClip.time : 0;\n  }\n\n  public init() {\n    // Only animations with a default state and start time have to\n    // be initialized\n    if (!this.defaultState || (!this._autoPlay && !this._initialStartTime)) {\n      return;\n    }\n\n    this.play(this.defaultState, this._initialStartTime);\n\n    // Non-auto played animations have to play for one frame\n    // to get to their start time frame\n    if (!this._autoPlay) {\n      requestAnimationFrame(() => this.pause());\n    }\n  }\n\n  public play(state: AnimationState, startTime?: number) {\n    const currentTime = startTime ?? this._getStartTime(state);\n    this._layer.play(state);\n    this._layer.activeStateCurrentTime = Math.min(\n      currentTime,\n      this._layer.activeStateDuration,\n    );\n  }\n\n  public pause() {\n    this._layer.pause();\n  }\n\n  private _getStartTime(state: AnimationState) {\n    return (() => {\n      switch (state) {\n        case AnimationState.Loop:\n        case AnimationState.Once:\n          return this._layer.activeStateCurrentTime >=\n            this._layer.activeStateDuration\n            ? 0\n            : this._layer.activeStateCurrentTime;\n        case AnimationState.LoopReverse:\n          return (\n            this._layer.activeStateCurrentTime % this._layer.activeStateDuration\n          );\n        case AnimationState.OnceReverse:\n          return this._layer.activeStateCurrentTime;\n      }\n    })();\n  }\n}\n","import React, { cloneElement } from \"react\";\nimport { makeStyles, useRadioGroup, Typography } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport { ReactComponent as Check } from \"../icons/Check.svg\";\nimport { mixColor } from \"../utilities\";\nimport { AppearProps } from \"./Appear\";\n\nconst useStyles = makeStyles(theme => {\n  const backgroundColor = theme.palette.grey[700];\n  const borderColor = theme.palette.grey[500];\n  const checkColor = mixColor(theme.palette.common.white, borderColor, 0.2);\n\n  const hoverBackgroundColor = mixColor(\n    theme.palette.primary.main,\n    backgroundColor,\n    0.2,\n  );\n  const hoverBorderColor = mixColor(\n    theme.palette.primary.main,\n    backgroundColor,\n    0.4,\n  );\n  const hoverCheckColor = mixColor(\n    theme.palette.common.white,\n    hoverBorderColor,\n    0.2,\n  );\n\n  const checkedBorderColor = theme.palette.primary.main;\n  const checkedCheckColor = theme.palette.common.white;\n\n  return {\n    root: {\n      userSelect: \"none\",\n      \"&:not(:last-child)\": {\n        marginBottom: theme.spacing(1),\n      },\n    },\n    input: {\n      position: \"absolute\",\n      opacity: 0,\n      pointerEvents: \"none\",\n    },\n    button: {\n      position: \"relative\",\n      display: \"flex\",\n      alignItems: \"center\",\n      padding: theme.spacing(1.5),\n      borderRadius: theme.shape.borderRadius,\n      backgroundColor: backgroundColor,\n      color: theme.palette.common.white,\n      boxShadow: `0 0 0 1px ${borderColor} inset`,\n      cursor: \"pointer\",\n      overflow: \"hidden\",\n      transition: theme.transitions.create([\"background-color\", \"box-shadow\"], {\n        duration: theme.transitions.duration.short,\n      }),\n      \"&:hover\": {\n        backgroundColor: hoverBackgroundColor,\n        \"&:not($buttonChecked)\": {\n          boxShadow: `0 0 0 1px ${hoverBorderColor} inset`,\n          \"& $checkbox\": {\n            borderTopColor: hoverBorderColor,\n            color: hoverCheckColor,\n          },\n        },\n      },\n    },\n    buttonChecked: {\n      boxShadow: `0 0 0 2px ${checkedBorderColor} inset`,\n    },\n    image: {\n      marginRight: theme.spacing(2),\n      height: 46,\n      width: 46,\n      borderRadius: theme.shape.borderRadius,\n      objectFit: \"cover\",\n    },\n    label: {\n      fontSize: theme.typography.pxToRem(14),\n    },\n    checkbox: {\n      position: \"absolute\",\n      top: 0,\n      left: 0,\n      width: 0,\n      height: 0,\n      borderTop: `28px solid ${borderColor}`,\n      borderRight: \"28px solid transparent\",\n      color: checkColor,\n      transition: theme.transitions.create([\"color\", \"border-color\"], {\n        duration: theme.transitions.duration.short,\n      }),\n      content: \"''\",\n    },\n    checkboxChecked: {\n      color: checkedCheckColor,\n      borderTopColor: checkedBorderColor,\n    },\n    checkboxIcon: {\n      position: \"absolute\",\n      top: -23,\n      left: 5,\n    },\n  };\n});\n\nexport type VariantProps = {\n  appear?: React.ReactElement<AppearProps>;\n  autoFocus?: boolean;\n  checked?: boolean;\n  id?: string;\n  image?: string;\n  label: string;\n  name?: string;\n  tabIndex?: number;\n  value?: string | number | string[];\n  onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void;\n  onClick?: (event: React.MouseEvent<HTMLInputElement>) => void;\n};\n\nexport const Variant: React.FC<VariantProps> = ({\n  appear,\n  autoFocus,\n  checked: checkedProp,\n  id,\n  image,\n  label,\n  name: nameProp,\n  tabIndex,\n  value,\n  onChange,\n  onClick,\n}) => {\n  const classes = useStyles();\n  const radioGroup = useRadioGroup();\n\n  const checked =\n    typeof checkedProp === \"undefined\"\n      ? radioGroup?.value === value\n      : checkedProp;\n  const name = typeof nameProp === \"undefined\" ? radioGroup?.name : nameProp;\n\n  const _onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (onChange) {\n      onChange(e);\n    }\n    if (radioGroup?.onChange) {\n      radioGroup.onChange(e, e.target.value);\n    }\n  };\n\n  const _onClick = (e: React.MouseEvent<HTMLInputElement>) => {\n    if (onClick) {\n      onClick(e);\n    }\n  };\n\n  const content = (\n    <div\n      className={clsx(classes.button, {\n        [classes.buttonChecked]: checked,\n      })}\n    >\n      {image && <img className={classes.image} src={image} alt=\"Variant\" />}\n      <Typography className={classes.label} component=\"div\">\n        {label}\n      </Typography>\n      <div\n        className={clsx(classes.checkbox, {\n          [classes.checkboxChecked]: checked,\n        })}\n      >\n        <Check className={classes.checkboxIcon} />\n      </div>\n    </div>\n  );\n\n  return (\n    <label className={classes.root}>\n      <input\n        autoFocus={autoFocus}\n        checked={checked}\n        className={classes.input}\n        id={id}\n        name={name}\n        onChange={_onChange}\n        onClick={_onClick}\n        tabIndex={tabIndex}\n        type=\"radio\"\n        value={value}\n      />\n      {appear ? cloneElement(appear, { children: content }) : content}\n    </label>\n  );\n};\n","import React, { useState, useEffect, useCallback } from \"react\";\nimport {\n  FormGroup,\n  makeStyles,\n  useTheme,\n  FormControl,\n  FormLabel,\n} from \"@material-ui/core\";\nimport { VariantSetManager, VariantSetState, VariantId } from \"../variants\";\nimport { Variant } from \"./Variant\";\nimport { Appear } from \"./Appear\";\n\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      padding: theme.spacing(3),\n      \"&:not(:last-child)\": {\n        borderBottom: `1px solid ${theme.palette.divider}`,\n      },\n    },\n    label: {\n      marginBottom: theme.spacing(1.5),\n      fontSize: theme.typography.pxToRem(14),\n      fontWeight: theme.typography.fontWeightMedium,\n      textTransform: \"uppercase\",\n    },\n  };\n});\n\nexport type VariantSetProps = {\n  id: number;\n  variantIdOffset?: number;\n  manager: VariantSetManager;\n};\n\nexport const VariantSet: React.FC<VariantSetProps> = ({\n  id,\n  variantIdOffset = 0,\n  manager,\n}) => {\n  const classes = useStyles();\n  const theme = useTheme();\n  const [label, setLabel] = useState<string>();\n  const [variantLabels, setVariantLabels] = useState<string[]>();\n  const [variantImages, setVariantImages] = useState<(string | undefined)[]>();\n  const [variants, setVariants] = useState<VariantId[]>();\n  const [selectedVariants, setSelectedVariants] = useState<VariantSetState>();\n\n  const onSelectedVariantsChange = useCallback(setSelectedVariants, [\n    setSelectedVariants,\n  ]);\n  const onVariantClicked = useCallback(\n    (variantID: number) => {\n      manager.activate(id, variantID);\n    },\n    [manager, id],\n  );\n\n  useEffect(() => {\n    setLabel(manager.getName(id));\n    setVariants(manager.getVariantIds(id));\n    setVariantLabels(manager.getVariantNames(id));\n    setVariantImages(manager.getVariantThumbnails(id));\n    setSelectedVariants(manager.getState(id));\n\n    return () => {\n      setLabel(undefined);\n      setVariants(undefined);\n      setVariantLabels(undefined);\n      setVariantImages(undefined);\n      setSelectedVariants(undefined);\n    };\n  }, [manager, id]);\n\n  useEffect(() => {\n    manager.onStateChange(id, onSelectedVariantsChange);\n\n    return () => {\n      manager.offStateChange(id, onSelectedVariantsChange);\n    };\n  }, [manager, id, onSelectedVariantsChange]);\n\n  return (\n    <FormControl fullWidth className={classes.root}>\n      <Appear\n        direction=\"left\"\n        delay={variantIdOffset * theme.listAnimationDelay}\n      >\n        <FormLabel component=\"legend\" className={classes.label}>\n          {label}\n        </FormLabel>\n      </Appear>\n      <FormGroup aria-label=\"variant-set\" id={`variant-set-${id}`}>\n        {variants &&\n          variants.map(variantId => (\n            <Variant\n              key={variantId}\n              appear={\n                <Appear\n                  direction=\"left\"\n                  delay={\n                    (variantIdOffset + variantId) * theme.listAnimationDelay\n                  }\n                />\n              }\n              checked={selectedVariants?.some(\n                selectedVariantId => selectedVariantId === variantId,\n              )}\n              value={variantId}\n              label={variantLabels?.[variantId] ?? \"\"}\n              image={variantImages?.[variantId]}\n              onClick={() => onVariantClicked(variantId)}\n            />\n          ))}\n      </FormGroup>\n    </FormControl>\n  );\n};\n","import React from \"react\";\nimport { VariantSetManager } from \"../variants\";\nimport { VariantSet } from \"./VariantSet\";\n\nexport type LevelVariantProps = {\n  variantSets: number[];\n  manager: VariantSetManager;\n};\n\nexport const LevelVariantSet: React.FC<LevelVariantProps> = ({\n  variantSets,\n  manager,\n}) => {\n  let variantCount = 0;\n  return (\n    <>\n      {variantSets.map(setId => {\n        const set = (\n          <VariantSet\n            key={setId}\n            id={setId}\n            variantIdOffset={variantCount}\n            manager={manager}\n          />\n        );\n        variantCount += manager.getVariantIds(setId).length;\n        return set;\n      })}\n    </>\n  );\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Typography, Divider, useTheme } from \"@material-ui/core\";\nimport { VariantSetManager } from \"../variants\";\nimport { GltfSource } from \"../types\";\nimport { NavList } from \"./NavList\";\nimport { NavListItem } from \"./NavListItem\";\nimport { MessageBox } from \"./MessageBox\";\nimport { Appear } from \"./Appear\";\nimport { LevelVariantSet } from \"./LevelVariantSet\";\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    height: \"100%\",\n    overflow: \"hidden\",\n  },\n  variantSets: {\n    overflowX: \"hidden\",\n  },\n  levelVariantSets: {\n    flex: \"1 1 auto\",\n    padding: theme.spacing(2, 3),\n    overflow: \"auto\",\n  },\n  meta: {\n    flex: \"0 0 auto\",\n    padding: theme.spacing(3),\n    \"& a\": {\n      color: theme.palette.common.white,\n    },\n    \"& p:not(:last-of-type)\": {\n      marginBottom: theme.spacing(2),\n    },\n  },\n}));\n\nexport type GltfContentProps = {\n  gltf: GltfSource;\n  appearDirection: \"left\" | \"right\";\n  variantSetManager?: VariantSetManager;\n  onLevelVariantSetSelect: (id: number) => void;\n};\n\nexport const GltfContent: React.FC<GltfContentProps> = ({\n  gltf,\n  variantSetManager,\n  appearDirection,\n  onLevelVariantSetSelect,\n}) => {\n  const classes = useStyles();\n  const theme = useTheme();\n  const levelVariantSets = variantSetManager?.levelVariantSets ?? [];\n\n  return (\n    <div className={classes.root}>\n      {variantSetManager && levelVariantSets.length === 1 ? (\n        <div className={classes.variantSets}>\n          <LevelVariantSet\n            variantSets={levelVariantSets[0].variantSets}\n            manager={variantSetManager}\n          />\n        </div>\n      ) : (\n        <>\n          <div className={classes.levelVariantSets}>\n            {variantSetManager && levelVariantSets.length > 0 ? (\n              <NavList>\n                {levelVariantSets.map((levelVariantSet, levelVariantSetId) => (\n                  <NavListItem\n                    key={levelVariantSetId}\n                    onClick={() => onLevelVariantSetSelect(levelVariantSetId)}\n                    appear={\n                      <Appear\n                        direction={appearDirection}\n                        delay={\n                          appearDirection === \"left\"\n                            ? levelVariantSetId * theme.listAnimationDelay\n                            : (levelVariantSets.length -\n                                1 -\n                                levelVariantSetId) *\n                              theme.listAnimationDelay\n                        }\n                      />\n                    }\n                  >\n                    {levelVariantSet.name}\n                  </NavListItem>\n                ))}\n              </NavList>\n            ) : (\n              <Appear duration={theme.transitions.duration.standard}>\n                <MessageBox icon=\"empty\" overline=\"Empty\" title=\"No options\">\n                  This scene does not contain any configurable objects.\n                </MessageBox>\n              </Appear>\n            )}\n          </div>\n          {(gltf.description || gltf.creator) && (\n            <Appear direction=\"up\">\n              <Divider />\n              <div className={classes.meta}>\n                {gltf.description && (\n                  <>\n                    <Typography variant=\"overline\" color=\"textSecondary\">\n                      Description\n                    </Typography>\n                    <Typography variant=\"body2\">{gltf.description}</Typography>\n                  </>\n                )}\n                {gltf.creator && (\n                  <>\n                    <Typography variant=\"overline\" color=\"textSecondary\">\n                      Creator\n                    </Typography>\n                    <Typography variant=\"body2\">\n                      {gltf.creatorUrl ? (\n                        <a\n                          href={gltf.creatorUrl}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                        >\n                          {gltf.creator}\n                        </a>\n                      ) : (\n                        gltf.creator\n                      )}\n                    </Typography>\n                  </>\n                )}\n              </div>\n            </Appear>\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport { CSSProperties } from \"@material-ui/core/styles/withStyles\";\n\nconst useStyles = makeStyles(theme => {\n  const layerWidth = 18;\n  const layerHeight = 2;\n  const layerSpacing = 4;\n  const borderRadius = 1;\n\n  const layerStyles: CSSProperties = {\n    display: \"block\",\n    position: \"absolute\",\n    width: layerWidth,\n    height: layerHeight,\n    backgroundColor: \"currentColor\",\n    borderRadius: borderRadius,\n    transition: theme.transitions.create([\"transform\", \"opacity\"], {\n      duration: theme.transitions.duration.shorter,\n    }),\n  };\n\n  return {\n    root: {\n      width: layerWidth,\n      height: layerWidth,\n    },\n    wrapper: {\n      position: \"relative\",\n      width: layerWidth,\n      marginTop: (layerWidth - (layerHeight * 3 + layerSpacing * 2)) / 2,\n    },\n    layer: {\n      ...layerStyles,\n      top: layerHeight / 2,\n      marginTop: layerHeight / -2,\n      \"&::before\": {\n        ...layerStyles,\n        top: layerSpacing + layerHeight,\n        content: \"''\",\n      },\n      \"&::after\": {\n        ...layerStyles,\n        top: layerHeight * 2 + layerSpacing * 2,\n        content: \"''\",\n      },\n    },\n    layerActive: {\n      transform: `translate3d(0, ${layerSpacing +\n        layerHeight}px, 0) rotate(45deg)`,\n      \"&::before\": {\n        transform: `rotate(-45deg) translate3d(${layerWidth /\n          -7}px, ${layerSpacing * -1}px, 0)`,\n        opacity: 0,\n      },\n      \"&::after\": {\n        transform: `translate3d(0, ${(layerSpacing + layerHeight) *\n          -2}px, 0) rotate(-90deg)`,\n      },\n    },\n  };\n});\n\nexport type HamburgerProps = {\n  active?: boolean;\n};\n\nexport const Hamburger: React.FC<HamburgerProps> = ({ active }) => {\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n      <div className={classes.wrapper}>\n        <div\n          className={clsx(classes.layer, {\n            [classes.layerActive]: active,\n          })}\n        />\n      </div>\n    </div>\n  );\n};\n","import React, { useState } from \"react\";\nimport clsx from \"clsx\";\nimport { makeStyles, ButtonBase } from \"@material-ui/core\";\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 42,\n    height: 42,\n    transform: \"translateX(-50%) translateY(-50%)\",\n    padding: theme.spacing(0.5),\n    borderRadius: \"50%\",\n    borderWidth: 1,\n    borderStyle: \"solid\",\n    borderColor: theme.palette.common.white,\n    backgroundColor: theme.palette.common.white,\n    boxShadow: theme.shadows[6],\n    opacity: 0.8,\n    transition: theme.transitions.create([\"background-color\", \"opacity\"], {\n      duration: theme.transitions.duration.standard,\n    }),\n    \"&:hover\": {\n      opacity: 1,\n    },\n  },\n  active: {\n    backgroundColor: theme.palette.primary.light,\n    opacity: 1,\n  },\n  image: {\n    width: \"100%\",\n    height: \"100%\",\n    borderWidth: 1,\n    borderStyle: \"solid\",\n    borderColor: theme.palette.common.white,\n    borderRadius: \"50%\",\n    backgroundSize: \"cover\",\n    transition: theme.transitions.create([\"background\"], {\n      duration: theme.transitions.duration.standard,\n    }),\n  },\n}));\n\nexport type HotspotProps = {\n  imageSource: string;\n  toggledImageSource?: string;\n  toggled?: boolean;\n  onToggle: (active: boolean) => void;\n};\n\nexport const Hotspot: React.FC<HotspotProps> = ({\n  imageSource,\n  toggledImageSource,\n  toggled: toggledProp,\n  onToggle,\n}) => {\n  const classes = useStyles();\n  const [toggled, setToggled] = useState(toggledProp ?? false);\n  const image =\n    toggled && toggledImageSource ? toggledImageSource : imageSource;\n\n  return (\n    <ButtonBase\n      className={clsx(classes.root, {\n        [classes.active]: toggled,\n      })}\n      aria-label=\"hotspot\"\n      disableRipple\n      onClick={() => {\n        setToggled(!toggled);\n        onToggle(!toggled);\n      }}\n    >\n      <div\n        className={classes.image}\n        style={{ backgroundImage: `url(${image})` }}\n      />\n    </ButtonBase>\n  );\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Drawer } from \"@material-ui/core\";\n\nconst useStyles = makeStyles(theme => ({\n  drawer: {\n    width: theme.sidebarWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    position: \"relative\",\n    width: \"100%\",\n    border: \"none\",\n  },\n}));\n\nexport type SidebarProps = {\n  open: boolean;\n};\n\nexport const Sidebar: React.FC<SidebarProps> = ({ children, open }) => {\n  const classes = useStyles();\n\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"persistent\"\n      anchor=\"right\"\n      open={open}\n      onWheel={e => e.nativeEvent.stopPropagation()}\n      onMouseDown={e => {\n        e.stopPropagation();\n      }}\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n      PaperProps={\n        {\n          \"data-testid\": \"sidebar\",\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        } as any\n      }\n    >\n      {children}\n    </Drawer>\n  );\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core\";\nimport { CSSProperties } from \"@material-ui/core/styles/withStyles\";\n\nconst useStyles = makeStyles(theme => {\n  const size = 18;\n  const baseLayerWidth = 16;\n  const angleLayerWidth = 10;\n  const layerHeight = 2;\n  const borderRadius = 1;\n\n  const layerStyles: CSSProperties = {\n    display: \"block\",\n    position: \"absolute\",\n    width: baseLayerWidth,\n    height: layerHeight,\n    backgroundColor: \"currentColor\",\n    borderRadius: borderRadius,\n    animationFillMode: \"forwards\",\n    animationTimingFunction: theme.transitions.easing.easeOut,\n    animationDuration: `${theme.transitions.duration.shorter}ms`,\n  };\n\n  return {\n    \"@keyframes beforeLayerEnter\": {\n      from: {\n        transform: `translate3d(0, 0, 0) rotate(0deg)`,\n      },\n      to: {\n        transform: `translate3d(${angleLayerWidth * -0.2}px, ${angleLayerWidth *\n          -0.28}px, 0) rotate(-45deg)`,\n      },\n    },\n    \"@keyframes afterLayerEnter\": {\n      from: {\n        transform: `translate3d(0, 0, 0) rotate(0deg)`,\n      },\n      to: {\n        transform: `translate3d(${angleLayerWidth * -0.2}px, ${angleLayerWidth *\n          0.28}px, 0) rotate(45deg)`,\n      },\n    },\n    root: {\n      width: size,\n      height: size,\n    },\n    wrapper: {\n      position: \"relative\",\n      width: size,\n      marginTop: size / 2 - layerHeight / 2,\n      marginLeft: layerHeight,\n    },\n    layer: {\n      ...layerStyles,\n      top: \"50%\",\n      marginTop: layerHeight / -2,\n      \"&::before\": {\n        ...layerStyles,\n        top: 0,\n        width: angleLayerWidth,\n        animationName: \"$beforeLayerEnter\",\n        content: \"''\",\n      },\n      \"&::after\": {\n        ...layerStyles,\n        bottom: 0,\n        width: angleLayerWidth,\n        animationName: \"$afterLayerEnter\",\n        content: \"''\",\n      },\n    },\n  };\n});\n\nexport const Arrow: React.FC = () => {\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n      <div className={classes.wrapper}>\n        <div className={classes.layer} />\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Typography, IconButton } from \"@material-ui/core\";\nimport { Appear } from \"./Appear\";\nimport { Arrow } from \"./Arrow\";\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    height: \"100%\",\n    overflow: \"hidden\",\n  },\n  header: {\n    display: \"flex\",\n    alignItems: \"center\",\n    flex: `0 0 ${theme.topbarHeight}px`,\n    paddingLeft: theme.spacing(3),\n    paddingRight: theme.spacing(3),\n    backgroundColor: theme.palette.grey[700],\n  },\n  backButtonWrapper: {\n    display: \"flex\",\n    alignItems: \"center\",\n    marginLeft: -theme.spacing(3),\n    marginRight: theme.spacing(1),\n    paddingLeft: theme.spacing(2),\n    height: \"100%\",\n    backgroundColor: theme.palette.grey[700],\n    zIndex: 1,\n  },\n  backButton: {\n    padding: theme.spacing(1),\n  },\n  title: {},\n  body: {\n    flex: \"1 1 auto\",\n    height: \"100%\",\n    \"overflow-x\": \"hidden\",\n    \"overflow-y\": \"auto\",\n  },\n}));\n\nexport type SidebarContainerProps = {\n  title?: string;\n  appearDirection?: \"left\" | \"right\";\n  onNavigateBack?: () => void;\n};\n\nexport const SidebarContainer: React.FC<SidebarContainerProps> = ({\n  children,\n  title,\n  appearDirection = \"left\",\n  onNavigateBack,\n}) => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.header}>\n        {onNavigateBack && (\n          <div className={classes.backButtonWrapper}>\n            <IconButton\n              className={classes.backButton}\n              size=\"small\"\n              disableTouchRipple\n              onClick={onNavigateBack}\n            >\n              <Arrow />\n            </IconButton>\n          </div>\n        )}\n        <Typography className={classes.title} variant=\"button\">\n          <Appear key={title} direction={appearDirection}>\n            {title}\n          </Appear>\n        </Typography>\n      </div>\n      <div className={classes.body}>{children}</div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { IconButton } from \"@material-ui/core\";\nimport { Hamburger } from \"./Hamburger\";\n\nconst useStyles = makeStyles(theme => ({\n  button: {\n    marginLeft: theme.spacing(1),\n    padding: theme.spacing(1),\n  },\n}));\n\nexport type SidebarToggleProps = {\n  open: boolean;\n  toggleOpen: (open: boolean) => void;\n};\n\nexport const SidebarToggle: React.FC<SidebarToggleProps> = ({\n  open,\n  toggleOpen,\n}) => {\n  const classes = useStyles();\n\n  return (\n    <IconButton\n      className={classes.button}\n      aria-label=\"open sidebar\"\n      data-testid=\"sidebar-toggle\"\n      disableTouchRipple\n      onClick={() => toggleOpen(!open)}\n    >\n      <Hamburger active={open} />\n    </IconButton>\n  );\n};\n","import * as Hammer from \"hammerjs\";\nimport * as pc from \"@animech-public/playcanvas\";\nimport { PreventableEvent } from \"../PreventableEvent\";\n\nfunction easeInQuad(t: number, b: number, c: number, d: number) {\n  return c * (t /= d) * t + b;\n}\n\ntype KeyDownEvent = { event: PreventableEvent; key: number };\ntype MouseWheelEvent = { event: PreventableEvent; wheel: number };\ntype MouseDownEvent = { event: PreventableEvent; button: number };\ntype MouseUpEvent = { event: PreventableEvent; button: number };\ntype MouseMoveEvent = {\n  dy: number;\n  dx: number;\n  x: number;\n  y: number;\n};\n\ntype TagQuery = (string | TagQuery)[];\n\nexport enum OrbitCameraMode {\n  FreeLook,\n  Orbital,\n}\n\nexport type OrbitCameraModeName = keyof typeof OrbitCameraMode;\n\nexport const orbitCameraScriptName = \"OrbitCamera\";\n\nexport class OrbitCamera extends pc.ScriptType {\n  /**\n   * Inertia Factor. Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive.\n   */\n  public inertiaFactor = 0.07;\n  /**\n   * How fast the camera moves around the orbit. Higher is faster.\n   */\n  public orbitSensitivity = 0.3;\n  /**\n   * How fast the camera moves in and out. Higher is faster.\n   */\n  public distanceSensitivity = 0.5;\n  /**\n   * How long time (in seconds) to use for dolly-transitions. Lower is faster.\n   */\n  public dollyDuration = 0.2;\n  /**\n   * Factor to use when calculating near clip based on the camera distance from a focused object.\n   */\n  public nearClipFactor?: number;\n  /**\n   * Factor to use when calculating far clip based on the camera distance from a focused object.\n   */\n  public farClipFactor?: number;\n  /**\n   * Wether or not to allow panning.\n   */\n  public allowPan?: boolean;\n\n  private _mode = OrbitCameraMode.Orbital;\n  private _cameraComponent!: pc.CameraComponent;\n  private _initialized = false;\n  private _distanceMin = 0;\n  private _distanceMax = 0;\n  private _pitchAngleMax = 90;\n  private _pitchAngleMin = -90;\n  private _yawAngleMax = 360;\n  private _yawAngleMin = 0;\n  private _distance = 0;\n  private _pitch = 0;\n  private _yaw = 0;\n  private _targetDistance = 0;\n  private _targetPitch = 0;\n  private _targetYaw = 0;\n  private _focusEntity: pc.Entity | null = null;\n  private _focusOffset = new pc.Vec3();\n  private _focusPosition = new pc.Vec3();\n  private _lastFocusDistance = this._distance;\n  private _lastFocusPitch = this._pitch;\n  private _lastFocusYaw = this._yaw;\n  private _lastFocusOffset = new pc.Vec3();\n  private _lookButtonDown = false;\n  private _panButtonDown = false;\n  private _lastMousePos = new pc.Vec2();\n  private _lastMouseDelta = new pc.Vec2();\n  private _lastStartDistance = 0;\n  private _zoomAnimFrame = 0;\n  private _hammer?: HammerManager;\n\n  public constructor(args: { app: pc.Application; entity: pc.Entity }) {\n    super(args);\n  }\n\n  /**\n   * Camera mode:\n   * - FreeLook allows the user to look around without moving the camera\n   * - Orbital allows the user to orbit the focused entity and zoom / dolly\n   */\n  public get mode() {\n    return this._mode;\n  }\n\n  public set mode(value: OrbitCameraMode) {\n    if (OrbitCameraMode[value] === undefined) {\n      throw new Error(`Invalid camera mode '${value}'`);\n    }\n\n    if (this._mode !== value) {\n      this._mode = value;\n      this._setupCameraMode();\n    }\n  }\n\n  /**\n   * Human readable name of the current camera mode.\n   */\n  public get modeName(): OrbitCameraModeName {\n    return OrbitCameraMode[this.mode] as OrbitCameraModeName;\n  }\n\n  /**\n   * Max distance. Setting this at 0 will give an infinite distance limit.\n   */\n  public get distanceMax() {\n    return this._distanceMax;\n  }\n  public set distanceMax(value: number) {\n    this._distanceMax = value;\n    this._targetDistance = this._clampDistance(this._distance);\n  }\n\n  /**\n   * Min distance.\n   */\n  public get distanceMin() {\n    return this._distanceMin;\n  }\n  public set distanceMin(value: number) {\n    this._distanceMin = value;\n    this._targetDistance = this._clampDistance(this._distance);\n  }\n\n  /**\n   * Max pitch angle (degrees).\n   */\n  public get pitchAngleMax() {\n    return this._pitchAngleMax;\n  }\n  public set pitchAngleMax(value: number) {\n    this._pitchAngleMax = value;\n    this._targetPitch = this._clampPitchAngle(this._pitch);\n  }\n\n  /**\n   * Min pitch angle (degrees).\n   */\n  public get pitchAngleMin() {\n    return this._pitchAngleMin;\n  }\n  public set pitchAngleMin(value: number) {\n    this._pitchAngleMin = value;\n    this._targetPitch = this._clampPitchAngle(this._pitch);\n  }\n\n  /**\n   * Max yaw angle (degrees).\n   */\n  public get yawAngleMax() {\n    return this._yawAngleMax;\n  }\n  public set yawAngleMax(value: number) {\n    this._yawAngleMax = value;\n    this._targetYaw = this._clampYawAngle(this._yaw);\n  }\n\n  /**\n   * Min yaw angle (degrees).\n   */\n  public get yawAngleMin() {\n    return this._yawAngleMin;\n  }\n  public set yawAngleMin(value: number) {\n    this._yawAngleMin = value;\n    this._targetYaw = this._clampYawAngle(this._yaw);\n  }\n\n  /**\n   * Returns true if the current limits for yaw are less than 360 degrees apart.\n   * If they are further apart, no limits will be enforced for yaw.\n   */\n  public get usesYawLimits() {\n    return this._yawAngleMax - this._yawAngleMin < 360;\n  }\n\n  /**\n   * Property to get and set the distance between the pivot point and camera.\n   * Clamped between this.distanceMin and this.distanceMax.\n   */\n  public get distance() {\n    return this._targetDistance;\n  }\n  public set distance(value: number) {\n    this._targetDistance = this._clampDistance(value);\n  }\n\n  /**\n   * Property to get and set the pitch of the camera around the pivot point (degrees).\n   * Clamped between this.pitchAngleMin and this.pitchAngleMax.\n   * When set at 0, the camera angle is flat, looking along the horizon.\n   */\n  public get pitch() {\n    return this._targetPitch;\n  }\n  public set pitch(value: number) {\n    this._targetPitch = this._clampPitchAngle(value);\n  }\n\n  /**\n   * Property to get and set the yaw of the camera around the pivot point (degrees).\n   */\n  public get yaw() {\n    return this._targetYaw;\n  }\n  public set yaw(value: number) {\n    this._targetYaw = this._clampYawAngle(value);\n  }\n\n  /**\n   * Property to get and set the entity that the camera orbits around.\n   */\n  public get focusEntity(): pc.Entity | null {\n    return this._focusEntity;\n  }\n  public set focusEntity(value: pc.Entity | null) {\n    // Sanitize in case an undefined value is passed somehow\n    value = value ?? null;\n\n    if (value !== this._focusEntity) {\n      this._focusEntity?.off(\"destroy\", this._onEntityDestroyed, this);\n      this._focusEntity = value;\n      this._focusEntity?.on(\"destroy\", this._onEntityDestroyed, this);\n    }\n  }\n\n  public initialize() {\n    const { camera } = this.entity;\n    if (!camera) {\n      throw new Error(\"Entity is missing camera component\");\n    }\n\n    this._cameraComponent = camera;\n\n    this._setUpMouseEvents();\n    this._setUpTouchEvents();\n\n    this.on(\"destroy\", () => {\n      this._tearDownMouseEvents();\n      this._tearDownTouchEvents();\n    });\n\n    this._initialized = true;\n    this._setupCameraMode();\n  }\n\n  public postUpdate(dt: number) {\n    // Add inertia, if any\n    const t =\n      this.inertiaFactor === 0 ? 1 : Math.min(dt / this.inertiaFactor, 1);\n    this._distance = pc.math.lerp(this._distance, this._targetDistance, t);\n    this._yaw = pc.math.lerp(this._yaw, this._targetYaw, t);\n    this._pitch = pc.math.lerp(this._pitch, this._targetPitch, t);\n\n    if (this.mode === OrbitCameraMode.Orbital) {\n      this._updateFocusPosition();\n    }\n\n    this._updatePosition();\n  }\n\n  /**\n   * Updates yaw angle while ensuring the shortest route is taken from\n   * the current yaw angle to the requested angle.\n   *\n   * Note that the passed value may therefore not be used as-is, instead\n   * an equivalent angle that is closer to the current angle may be substituted.\n   * @param yaw Yaw angle\n   */\n  public setYawUsingShortestRoute(yaw: number) {\n    // Ensure that the yaw takes the shortest route by making sure that\n    // the difference between the targetYaw and the actual is 180 degrees\n    // in either direction\n    const diff = yaw - this._yaw;\n    const remainder = diff % 360;\n    if (remainder > 180) {\n      this.yaw = this._yaw - (360 - remainder);\n    } else if (remainder < -180) {\n      this.yaw = this._yaw + (360 + remainder);\n    } else {\n      this.yaw = this._yaw + remainder;\n    }\n  }\n\n  /**\n   * Focuses on an entity.\n   * @param focusEntity         Entity to focus. If no entity is passed in, the scene-root will be used.\n   * @param options.frameModels Uses the center of the bounding-box as focus-point, and moves the camera to a suitable distance.\n   */\n  public focus(\n    focusEntity: pc.Entity | null,\n    options: {\n      frameModels?: boolean;\n      lookAtEntity?: boolean;\n      offset?: pc.Vec3;\n    } = {},\n  ) {\n    if (this.mode !== OrbitCameraMode.Orbital) {\n      console.warn(\"focus() can only be used when the Orbital mode is active\");\n      return;\n    }\n\n    const { frameModels, lookAtEntity, offset } = options;\n\n    if (!focusEntity) {\n      focusEntity = this.app.root;\n    }\n\n    this.focusEntity = focusEntity;\n    this._focusOffset.copy(offset ?? pc.Vec3.ZERO);\n\n    const focusAabb = frameModels\n      ? this._buildAabb(focusEntity, [\"ignoreBoundingBox\"])\n      : null;\n    if (focusAabb) {\n      // Add offset to keep center of bounding-box focused\n      this._focusOffset.add(focusAabb.center).sub(focusEntity.getPosition());\n    }\n\n    this._updateFocusPosition();\n\n    this.distance = focusAabb\n      ? this._calcDistanceForBoundingBox(focusAabb)\n      : this.entity.getPosition().distance(this._focusPosition);\n\n    if (lookAtEntity) {\n      this.entity.lookAt(this._focusPosition, pc.Vec3.UP);\n\n      const cameraQuat = this.entity.getRotation();\n      this.yaw = this._calcYaw(cameraQuat);\n      this.pitch = this._calcPitch(cameraQuat, this.yaw);\n    }\n\n    if (this.nearClipFactor) {\n      this._cameraComponent.nearClip = this.distance * this.nearClipFactor;\n    }\n    if (this.farClipFactor) {\n      // Include all models within the focused entity's hierarchy when\n      // calculating farClip, regardless of their tags.\n      const aabb = this._buildAabb(focusEntity);\n      const distance = aabb\n        ? this._calcDistanceForBoundingBox(aabb)\n        : this.distance;\n\n      this._cameraComponent.farClip = distance * this.farClipFactor;\n    }\n\n    this._lastFocusDistance = this.distance;\n    this._lastFocusPitch = this.pitch;\n    this._lastFocusYaw = this.yaw;\n    this._lastFocusOffset.copy(this._focusOffset);\n\n    this._removeInertia();\n    this._updatePosition();\n  }\n\n  /**\n   * Set the camera position to a world position and look at a world position.\n   * Useful if you have multiple viewing angles to swap between in a scene.`\n   * Note that the scene-root will become the focused entity.\n   * @param resetPoint\n   * @param lookAtPoint\n   */\n  public resetAndLookAtPoint(resetPoint: pc.Vec3, lookAtPoint: pc.Vec3) {\n    if (this.mode !== OrbitCameraMode.Orbital) {\n      console.warn(\n        \"resetAndLookAtPoint() can only be used when the Orbital mode is active\",\n      );\n      return;\n    }\n\n    this.entity.setPosition(resetPoint);\n\n    this.focus(null, {\n      lookAtEntity: true,\n      offset: lookAtPoint,\n    });\n  }\n\n  /**\n   * Set camera position to a world position and look at an entity in the scene.\n   * Useful if you have multiple models to swap between in a scene.\n   * @param resetPoint\n   * @param entity\n   */\n  public resetAndLookAtEntity(resetPoint: pc.Vec3, entity: pc.Entity) {\n    if (this.mode !== OrbitCameraMode.Orbital) {\n      console.warn(\n        \"resetAndLookAtEntity() can only be used when the Orbital mode is active\",\n      );\n      return;\n    }\n\n    this.entity.setPosition(resetPoint);\n\n    this.focus(entity, {\n      frameModels: true,\n      lookAtEntity: true,\n    });\n  }\n\n  /**\n   * Set the camera at a specific, yaw, pitch and distance without inertia (instant cut).\n   * @param yaw\n   * @param pitch\n   * @param distance\n   */\n  public reset(yaw?: number, pitch?: number, distance?: number) {\n    if (yaw !== undefined) {\n      this.yaw = yaw;\n    }\n    if (pitch !== undefined) {\n      this.pitch = pitch;\n    }\n    if (distance !== undefined) {\n      this.distance = distance;\n    }\n\n    this._removeInertia();\n  }\n\n  private _onEntityDestroyed(entity: pc.Entity) {\n    if (this._focusEntity === entity) {\n      this._focusEntity = null;\n    }\n  }\n\n  private _calcDistanceForBoundingBox(aabb: pc.BoundingBox): number {\n    const halfExtents = aabb.halfExtents;\n    const fov = this._cameraComponent.fov;\n\n    // Determine the distance needed to frame the bounding-box in the camera view\n    let distance = Math.max(\n      halfExtents.x,\n      Math.max(halfExtents.y, halfExtents.z),\n    );\n    distance = distance / Math.tan(0.5 * fov * pc.math.DEG_TO_RAD);\n    distance = distance * 2;\n\n    return distance;\n  }\n\n  private _updatePosition() {\n    if (this.mode === OrbitCameraMode.FreeLook) {\n      this.entity.setEulerAngles(this._pitch, this._yaw, 0);\n    } else if (this.mode === OrbitCameraMode.Orbital) {\n      // Work out the camera position based on the pivot point, pitch, yaw and distance\n      this.entity.setLocalPosition(0, 0, 0);\n      this.entity.setEulerAngles(this._pitch, this._yaw, 0);\n\n      const position = this.entity.getPosition();\n      position.copy(this.entity.forward);\n      position.scale(-this._distance);\n      position.add(this._focusPosition);\n      this.entity.setPosition(position);\n    }\n  }\n\n  private _updateFocusPosition() {\n    if (!this._focusEntity) {\n      return;\n    }\n\n    this._focusPosition\n      .copy(this._focusEntity.getPosition())\n      .add(this._focusOffset);\n  }\n\n  private _removeInertia() {\n    this._yaw = this._targetYaw;\n    this._pitch = this._targetPitch;\n    this._distance = this._targetDistance;\n  }\n\n  private _buildAabb(\n    entity: pc.Entity,\n    ignoredTagsQuery?: TagQuery,\n  ): pc.BoundingBox | null {\n    let modelsAabb: pc.BoundingBox | null = null;\n\n    if (ignoredTagsQuery && entity.tags.has(...ignoredTagsQuery)) {\n      return modelsAabb;\n    }\n\n    if (entity.model) {\n      const mi = entity.model.meshInstances;\n      for (let i = 0; i < mi.length; i += 1) {\n        if (!modelsAabb) {\n          modelsAabb = mi[i].aabb.clone();\n        } else {\n          modelsAabb.add(mi[i].aabb);\n        }\n      }\n    }\n\n    for (let i = 0; i < entity.children.length; i += 1) {\n      const childAabb = this._buildAabb(\n        entity.children[i] as pc.Entity,\n        ignoredTagsQuery,\n      );\n      if (!childAabb) {\n        continue;\n      }\n\n      if (!modelsAabb) {\n        modelsAabb = childAabb.clone();\n      } else {\n        modelsAabb.add(childAabb);\n      }\n    }\n\n    return modelsAabb;\n  }\n\n  private _calcYaw(quat: pc.Quat) {\n    const transformedForward = new pc.Vec3();\n    quat.transformVector(pc.Vec3.FORWARD, transformedForward);\n\n    return (\n      Math.atan2(-transformedForward.x, -transformedForward.z) *\n      pc.math.RAD_TO_DEG\n    );\n  }\n\n  private _clampDistance(distance: number) {\n    if (this.distanceMax > 0) {\n      return pc.math.clamp(distance, this.distanceMin, this.distanceMax);\n    } else {\n      return Math.max(distance, this.distanceMin);\n    }\n  }\n\n  private _clampPitchAngle(pitch: number) {\n    return pc.math.clamp(pitch, this.pitchAngleMin, this.pitchAngleMax);\n  }\n\n  private _clampYawAngle(yaw: number) {\n    return this.usesYawLimits\n      ? pc.math.clamp(yaw, this.yawAngleMin, this.yawAngleMax)\n      : yaw;\n  }\n\n  private _calcPitch(quat: pc.Quat, yaw: number) {\n    const quatWithoutYaw = new pc.Quat();\n    const yawOffset = new pc.Quat();\n\n    yawOffset.setFromEulerAngles(0, -yaw, 0);\n    quatWithoutYaw.mul2(yawOffset, quat);\n\n    const transformedForward = new pc.Vec3();\n\n    quatWithoutYaw.transformVector(pc.Vec3.FORWARD, transformedForward);\n\n    return (\n      Math.atan2(transformedForward.y, -transformedForward.z) *\n      pc.math.RAD_TO_DEG\n    );\n  }\n\n  private _dolly(value: number) {\n    if (this._zoomAnimFrame) {\n      cancelAnimationFrame(this._zoomAnimFrame);\n      this._zoomAnimFrame = 0;\n    }\n\n    if (this.mode !== OrbitCameraMode.Orbital) {\n      return;\n    }\n\n    const curValue = this.distance;\n    const targetValue = this.distanceSensitivity * (this.distance * 0.1);\n\n    const start = Date.now();\n    const duration = this.dollyDuration * 1000;\n    const smoothZoom = () => {\n      const elapsed = Date.now() - start;\n      const nextValue =\n        easeInQuad(\n          elapsed,\n          curValue,\n          targetValue > curValue\n            ? targetValue - curValue\n            : curValue - targetValue,\n          duration,\n        ) * 0.01;\n      this.distance -= value * nextValue;\n      if (elapsed >= duration) {\n        return;\n      }\n      this._zoomAnimFrame = requestAnimationFrame(smoothZoom);\n    };\n    this._zoomAnimFrame = requestAnimationFrame(smoothZoom);\n  }\n\n  private _orbit(dx: number, dy: number) {\n    this.pitch -= dy * this.orbitSensitivity;\n    this.yaw -= dx * this.orbitSensitivity;\n  }\n\n  private _pan(x: number, y: number) {\n    if (this.mode !== OrbitCameraMode.Orbital) {\n      return;\n    }\n\n    const fromWorldPoint = new pc.Vec3();\n    const toWorldPoint = new pc.Vec3();\n    const worldDiff = new pc.Vec3();\n\n    // For panning to work at any zoom level, we use screen point to world projection\n    // to work out how far we need to pan the pivotEntity in world space\n    const distance = this.distance;\n\n    this._cameraComponent.screenToWorld(x, y, distance, fromWorldPoint);\n    this._cameraComponent.screenToWorld(\n      this._lastMousePos.x,\n      this._lastMousePos.y,\n      distance,\n      toWorldPoint,\n    );\n\n    worldDiff.sub2(toWorldPoint, fromWorldPoint);\n\n    this._focusOffset.add(worldDiff);\n  }\n\n  private _setupCameraMode() {\n    if (!this._initialized) {\n      return;\n    }\n\n    if (this.mode === OrbitCameraMode.FreeLook) {\n      const cameraQuat = this.entity.getRotation();\n      this.yaw = this._calcYaw(cameraQuat);\n      this.pitch = this._calcPitch(cameraQuat, this.yaw);\n\n      this._lastFocusDistance = this.distance;\n      this._lastFocusPitch = this.pitch;\n      this._lastFocusYaw = this.yaw;\n      this._lastFocusOffset.copy(pc.Vec3.ZERO);\n\n      this._removeInertia();\n      this._updatePosition();\n    } else if (this.mode === OrbitCameraMode.Orbital) {\n      this.focus(this._focusEntity, {\n        lookAtEntity: true,\n      });\n    }\n  }\n\n  private _onKeyDown(event: KeyDownEvent) {\n    if (event.event.prevent || !this.enabled) {\n      return;\n    }\n\n    if (\n      event.key === pc.KEY_SPACE &&\n      (this._focusEntity || this.mode === OrbitCameraMode.FreeLook)\n    ) {\n      this._focusOffset.copy(this._lastFocusOffset);\n      this.reset(\n        this._lastFocusYaw,\n        this._lastFocusPitch,\n        this._lastFocusDistance,\n      );\n    }\n  }\n\n  private _onMouseOut() {\n    if (!this.enabled) {\n      return;\n    }\n    this._lookButtonDown = false;\n    this._panButtonDown = false;\n  }\n\n  private _onMouseDown(event: MouseDownEvent) {\n    if (event.event.prevent || !this.enabled) {\n      return;\n    }\n    switch (event.button) {\n      case pc.MOUSEBUTTON_LEFT:\n        this._lookButtonDown = true;\n        break;\n\n      case pc.MOUSEBUTTON_RIGHT:\n      case pc.MOUSEBUTTON_MIDDLE:\n        this._panButtonDown = true;\n        event.event.preventDefault();\n        break;\n    }\n  }\n\n  private _onMouseUp(event: MouseUpEvent) {\n    if (!this.enabled) {\n      return;\n    }\n    switch (event.button) {\n      case pc.MOUSEBUTTON_LEFT:\n        this._lookButtonDown = false;\n        break;\n\n      case pc.MOUSEBUTTON_MIDDLE:\n      case pc.MOUSEBUTTON_RIGHT:\n        this._panButtonDown = false;\n        break;\n    }\n  }\n\n  private _onMouseMove(event: MouseMoveEvent) {\n    if (!this.enabled) {\n      return;\n    }\n    if (this._lookButtonDown) {\n      this._orbit(event.dx, event.dy);\n    } else if (this._panButtonDown && this.allowPan) {\n      this._pan(event.x, event.y);\n    }\n\n    this._lastMousePos.set(event.x, event.y);\n  }\n\n  private _onMouseWheel(event: MouseWheelEvent) {\n    if (event.event.prevent || !this.enabled) {\n      return;\n    }\n\n    this._dolly(event.wheel);\n\n    event.event.preventDefault();\n  }\n\n  private _setUpMouseEvents() {\n    // Disabling the context menu stops the browser displaying a menu when\n    // you right-click the page\n    this.app.mouse.disableContextMenu();\n\n    this.app.keyboard.on(pc.EVENT_KEYDOWN, this._onKeyDown, this);\n    this.app.mouse.on(pc.EVENT_MOUSEDOWN, this._onMouseDown, this);\n    this.app.mouse.on(pc.EVENT_MOUSEUP, this._onMouseUp, this);\n    this.app.mouse.on(pc.EVENT_MOUSEMOVE, this._onMouseMove, this);\n    this.app.mouse.on(pc.EVENT_MOUSEWHEEL, this._onMouseWheel, this);\n    window.addEventListener(\"mouseout\", this._onMouseOut, false);\n  }\n\n  private _tearDownMouseEvents() {\n    this.app.mouse.off(pc.EVENT_MOUSEDOWN, this._onMouseDown, this);\n    this.app.mouse.off(pc.EVENT_MOUSEUP, this._onMouseUp, this);\n    this.app.mouse.off(pc.EVENT_MOUSEMOVE, this._onMouseMove, this);\n    this.app.mouse.off(pc.EVENT_MOUSEWHEEL, this._onMouseWheel, this);\n    window.removeEventListener(\"mouseout\", this._onMouseOut, false);\n  }\n\n  private _onTouchPinchStart(event: HammerInput) {\n    if (!this.enabled) {\n      return;\n    }\n    this._lastStartDistance = this.distance;\n    event.preventDefault();\n  }\n\n  private _onTouchPinch(event: HammerInput) {\n    if (!this.enabled || this.mode !== OrbitCameraMode.Orbital) {\n      return;\n    }\n    this.distance = this._lastStartDistance / event.scale;\n  }\n\n  private _onTouchPanStart(event: HammerInput) {\n    if (!this.enabled) {\n      return;\n    }\n\n    const { x, y } = event.center;\n    const { deltaX, deltaY } = event;\n    this._lastMousePos.set(x, y);\n    this._lastMouseDelta.set(deltaX, deltaY);\n\n    // Drag 1 pointer to orbit\n    // Drag 2 pointers to pan\n    this._lookButtonDown = event.pointers.length === 1;\n    this._panButtonDown = event.pointers.length > 1;\n  }\n\n  private _onTouchPanEnd() {\n    if (!this.enabled) {\n      return;\n    }\n    this._lookButtonDown = false;\n    this._panButtonDown = false;\n  }\n\n  private _onTouchPan(event: HammerInput) {\n    if (!this.enabled) {\n      return;\n    }\n\n    const { x, y } = event.center;\n    const { deltaX, deltaY } = event;\n\n    if (this._lookButtonDown) {\n      const dx = deltaX - this._lastMouseDelta.x;\n      const dy = deltaY - this._lastMouseDelta.y;\n      this._orbit(dx, dy);\n    } else if (this._panButtonDown && this.allowPan) {\n      this._pan(x, y);\n    }\n\n    this._lastMouseDelta.set(deltaX, deltaY);\n    this._lastMousePos.set(x, y);\n  }\n\n  private _setUpTouchEvents() {\n    const pinch = new Hammer.Pinch();\n    const pan = new Hammer.Pan({\n      direction: Hammer.DIRECTION_ALL,\n      pointers: 0,\n    });\n    pan.recognizeWith(pinch);\n\n    this._hammer = new Hammer.Manager(this.app.graphicsDevice.canvas, {\n      inputClass: Hammer.TouchInput,\n    });\n    this._hammer.add([pan, pinch]);\n\n    this._hammer.on(\"pinchstart\", this._onTouchPinchStart.bind(this));\n    this._hammer.on(\"pinch\", this._onTouchPinch.bind(this));\n    this._hammer.on(\"panstart\", this._onTouchPanStart.bind(this));\n    this._hammer.on(\"panend\", this._onTouchPanEnd.bind(this));\n    this._hammer.on(\"pan\", this._onTouchPan.bind(this));\n  }\n\n  private _tearDownTouchEvents() {\n    if (this._hammer) {\n      this._hammer.destroy();\n      this._hammer = undefined;\n    }\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\n\ntype CubemapAsset = Omit<pc.Asset, \"resource\"> & { resource: pc.Texture };\ntype ModelAsset = Omit<pc.Asset, \"resource\"> & { resource: pc.Model };\n\n/**\n * Typings for PlayCanvas script-attributes attached to the class.\n */\ninterface HdriBackdrop {\n  cubemap?: CubemapAsset | null;\n  model?: ModelAsset | null;\n  size: number;\n  angle: number;\n  intensity: number;\n  projectionCenter: pc.Vec3;\n  lightingDistanceFactor: number;\n  useCameraProjection: boolean;\n\n  entity: pc.Entity & {\n    model: pc.ModelComponent;\n  };\n}\n\nconst hdriBackdropScriptName = \"HdriBackdrop\";\n\nclass HdriBackdrop extends pc.ScriptType {\n  private _material = new pc.Material();\n  private _worldProjectionCenter = new pc.Vec3();\n  private _mapRotationMatrix = new pc.Mat4();\n\n  public initialize() {\n    this.entity.tags.add(\"ignoreBoundingBox\");\n    this.entity.addComponent(\"model\");\n\n    this._initializeMaterial();\n    this._updateModel();\n    this._updateCubemapUniform();\n    this._updateIntensityUniform();\n    this._updateMapRotationUniform();\n    this._updateLightingDistanceUniform();\n    this._updateTransformRelatedUniforms();\n\n    // TODO: Recapture sky(?)\n\n    this.on(\"attr:cubemap\", this._updateCubemapUniform, this);\n    this.on(\"attr:model\", this._updateModel, this);\n    this.on(\"attr:size\", this._updateLightingDistanceUniform, this);\n    this.on(\"attr:size\", this._updateEntityScale, this);\n    this.on(\"attr:angle\", this._updateMapRotationUniform, this);\n    this.on(\"attr:intensity\", this._updateIntensityUniform, this);\n    this.on(\n      \"attr:lightingDistanceFactor\",\n      this._updateLightingDistanceUniform,\n      this,\n    );\n  }\n\n  public postUpdate() {\n    this._restrictCurrentRotationToY();\n    this._updateTransformRelatedUniforms();\n  }\n\n  private _updateModel() {\n    const model = this.model;\n    const entity = this.entity;\n    const modelComponent = entity.model;\n\n    if (model) {\n      modelComponent.model = model.resource.clone();\n      modelComponent.meshInstances.forEach(\n        meshInstance => (meshInstance.material = this._material),\n      );\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      modelComponent.model = null as any;\n    }\n\n    this._updateEntityScale();\n  }\n\n  private _updateCubemapUniform() {\n    const material = this._material;\n    const uHdriMap = this.cubemap?.resource;\n\n    if (uHdriMap) {\n      material.setParameter(\"uHdriMap\", uHdriMap);\n    } else {\n      material.deleteParameter(\"uHdriMap\");\n    }\n  }\n\n  private _updateLightingDistanceUniform() {\n    const material = this._material;\n    const uLightingDistance = this.size * this.lightingDistanceFactor;\n\n    material.setParameter(\"uLightingDistance\", uLightingDistance);\n  }\n\n  private _updateIntensityUniform() {\n    const material = this._material;\n    const uIntensity = this.intensity;\n\n    material.setParameter(\"uIntensity\", uIntensity);\n  }\n\n  private _updateTransformRelatedUniforms() {\n    const material = this._material;\n\n    const uProjectionCenter = this._calculateProjectionCenterUniform();\n\n    material.setParameter(\"uProjectionCenter\", uProjectionCenter);\n  }\n\n  private _updateMapRotationUniform() {\n    const material = this._material;\n    const matrix = this._mapRotationMatrix;\n\n    matrix.setFromAxisAngle(pc.Vec3.UP.clone(), -this.angle);\n    const uMapRotationMatrix = (matrix.data as unknown) as number[];\n\n    material.setParameter(\"uMapRotationMatrix\", uMapRotationMatrix);\n  }\n\n  private _updateEntityScale() {\n    const radius = this._calculateModelSphereRadius(this.model?.resource);\n\n    if (radius > 0) {\n      const scale = this.size / (radius * 2);\n      this.entity.setLocalScale(scale, scale, scale);\n    } else {\n      this.entity.setLocalScale(1, 1, 1);\n    }\n  }\n\n  private _restrictCurrentRotationToY() {\n    // TODO: Should we optimize or cache this since it's performed per frame?\n\n    const rotation = this.entity.getRotation();\n    const yaw = rotation.getAxisAngle(pc.Vec3.UP.clone());\n\n    rotation.setFromAxisAngle(pc.Vec3.UP.clone(), yaw);\n  }\n\n  private _calculateProjectionCenterUniform(): number[] {\n    const app = this.app;\n    const worldProjectionCenter = this._worldProjectionCenter;\n\n    if (this.useCameraProjection) {\n      const cameras = app.systems.camera.cameras;\n      const camera = cameras[cameras.length - 1];\n\n      if (!camera) {\n        throw new Error(\"No active camera found\");\n      }\n\n      worldProjectionCenter.copy(camera.entity.getPosition());\n    } else {\n      const rotation = this.entity.getRotation();\n\n      rotation.transformVector(this.projectionCenter, worldProjectionCenter);\n      worldProjectionCenter.add(this.entity.getPosition());\n    }\n\n    return [\n      worldProjectionCenter.x,\n      worldProjectionCenter.y,\n      worldProjectionCenter.z,\n    ];\n  }\n\n  private _initializeMaterial() {\n    const graphicsDevice = this.app.graphicsDevice;\n    const precision = graphicsDevice.precision;\n    const vertexCode = this._getVertexShaderCode();\n    const fragmentCode = this._getFragmentShaderCode();\n\n    const shader = new pc.Shader(graphicsDevice, {\n      attributes: {\n        aPosition: pc.SEMANTIC_POSITION,\n        aUv0: pc.SEMANTIC_TEXCOORD0,\n      },\n      vshader: vertexCode,\n      fshader: `precision ${precision} float;\\n ${fragmentCode}`,\n    });\n\n    this._material.shader = shader;\n  }\n\n  private _calculateModelSphereRadius(model?: pc.Model): number {\n    const meshInstances = model?.meshInstances;\n\n    if (!meshInstances || meshInstances.length < 1) {\n      return 0;\n    }\n\n    const boundingBox = new pc.BoundingBox();\n\n    // Find center of the meshes using a normal bounding-box\n    boundingBox.copy(meshInstances[0].aabb);\n    meshInstances\n      .slice(1)\n      .forEach(meshInstance => boundingBox.add(meshInstance.aabb));\n\n    const positions: number[] = [];\n    const tmpVec1 = new pc.Vec3();\n    const tmpVec2 = new pc.Vec3();\n    let radiusSquared = 0;\n\n    // Calculate the sphere radius using the distance of each vertex from the center\n    meshInstances.forEach(meshInstance => {\n      const vertexCount = meshInstance.mesh.getPositions(positions);\n\n      for (let idx = 0; idx < vertexCount; idx += 3) {\n        tmpVec1.set(\n          positions[idx * 3 + 0],\n          positions[idx * 3 + 1],\n          positions[idx * 3 + 2],\n        );\n\n        tmpVec2.sub2(tmpVec1, boundingBox.center);\n        radiusSquared = Math.max(radiusSquared, tmpVec2.lengthSq());\n      }\n    });\n\n    return Math.sqrt(radiusSquared);\n  }\n\n  private _getVertexShaderCode(): string {\n    return `\n      attribute vec4 aPosition;\n\n      uniform mat4 matrix_model;\n      uniform mat4 matrix_viewProjection;\n\n      varying vec3 vWorldVertexPosition;\n\n      void main(void)\n      {\n        vec4 worldVertexPosition = matrix_model * aPosition;\n        vWorldVertexPosition = worldVertexPosition.xyz;\n        gl_Position = matrix_viewProjection * worldVertexPosition;\n      }\n    `;\n  }\n\n  private _getFragmentShaderCode(): string {\n    // TODO: Support HDR / LDR cubemaps in addition to RGBM?\n\n    const scene = this.app.scene;\n    const chunks = pc.shaderChunks;\n    const programlib = pc.programlib;\n\n    let shaderCode = \"\";\n\n    shaderCode += programlib.gammaCode(scene.gammaCorrection);\n    shaderCode += programlib.tonemapCode(scene.toneMapping);\n    shaderCode += chunks.rgbmPS;\n\n    shaderCode += `\n      uniform samplerCube uHdriMap;\n      uniform mat4        uMapRotationMatrix;\n      uniform float       uIntensity;\n      uniform vec3        uProjectionCenter;\n      uniform float       uLightingDistance;\n      uniform vec3        view_position;\n\n      varying vec3 vWorldVertexPosition;\n\n      struct HdriAttributes\n      {\n        vec3 baseColor;\n        float specular;\n        vec3 emissiveColor;\n      };\n\n      float saturate(float source)\n      {\n        return clamp(source, 0.0, 1.0);\n      }\n\n      HdriAttributes createHdriAttributes(vec3 in_)\n      {\n        vec3 projectionDirection = normalize(vWorldVertexPosition - uProjectionCenter);\n        vec3 sampleDirection =  (vec4(projectionDirection, 1.0) * uMapRotationMatrix).xyz;\n\n        sampleDirection.x *= -1.0;  // Same flip in x is used by skybox.vert in the Playcanvas engine\n\n        vec3 hdriMapRgb = textureCubeRGBM(uHdriMap, sampleDirection).xyz;\n        vec3 poweredIn = pow(in_, vec3(4.0));\n\n        HdriAttributes result;\n\n        result.baseColor = hdriMapRgb * poweredIn * saturate(uIntensity);\n        result.specular = 0.0;\n        result.emissiveColor = hdriMapRgb * uIntensity * (vec3(1.0) - poweredIn);\n\n        return result;\n      }\n\n      void main(void)\n      {\n        vec3 in_ = vec3(saturate((uLightingDistance - length(vWorldVertexPosition - view_position)) / uLightingDistance));\n\n        HdriAttributes hdriAttributes = createHdriAttributes(in_);\n\n        vec3 color = hdriAttributes.baseColor + vec3(hdriAttributes.specular) + hdriAttributes.emissiveColor;\n\n        color = toneMap(color);\n        color = gammaCorrectOutput(color);\n\n        gl_FragColor = vec4(color, 1.0);\n      }\n    `;\n\n    return shaderCode;\n  }\n}\n\nHdriBackdrop.attributes.add(\"cubemap\", {\n  type: \"asset\",\n  assetType: \"cubemap\",\n  title: \"Cubemap\",\n  description:\n    \"Assign an imported HDR cubemap that will be projected on the ground & backdrop.\",\n});\n\nHdriBackdrop.attributes.add(\"model\", {\n  type: \"asset\",\n  assetType: \"model\",\n  title: \"Model\",\n  description: \"Specify a model to use as a backdrop.\",\n});\n\nHdriBackdrop.attributes.add(\"size\", {\n  type: \"number\",\n  default: 150.0,\n  title: \"Size\",\n  description:\n    \"The size of the model used to project the HDR cubemap (Meters). The supplied model will be scaled to match the size as closely as possible.\",\n});\n\nHdriBackdrop.attributes.add(\"angle\", {\n  type: \"number\",\n  default: 0,\n  title: \"Angle\",\n  description:\n    \"Absolute clockwise rotation (yaw) of the projected HDR cubemap in degrees. Note that the rotation is independent of the entity's rotation.\",\n});\n\nHdriBackdrop.attributes.add(\"intensity\", {\n  type: \"number\",\n  default: 1.0,\n  title: \"Intensity\",\n  description:\n    \"Emissivity of the backdrop. Higher values will results brighter ambient lighting sampled from the HDR cubemap (cd/m2).\",\n});\n\nHdriBackdrop.attributes.add(\"projectionCenter\", {\n  type: \"vec3\",\n  default: [0.0, 1.7, 0.0],\n  title: \"Projection Center\",\n  description:\n    \"Defines the projection point of the HDR cubemap. Note that the position is relative to the position of the entity this script belongs to.\",\n});\n\nHdriBackdrop.attributes.add(\"lightingDistanceFactor\", {\n  type: \"number\",\n  default: 0.5,\n  title: \"Lighting Distance Factor\",\n  description:\n    \"Specify the ground area that will be affected by lighting and shadows. Lit area will have slightly different shading depending on the Intensity and other lighting parameters in the scene.\",\n});\n\nHdriBackdrop.attributes.add(\"useCameraProjection\", {\n  type: \"boolean\",\n  default: false,\n  title: \"Use Camera Projection\",\n  description:\n    \"Disables ground tracking, making the HDR cubemap follow the camera.\",\n});\n\nexport { hdriBackdropScriptName, HdriBackdrop };\n","import * as pc from \"@animech-public/playcanvas\";\n\ndeclare module \"@animech-public/playcanvas\" {\n  interface ScriptComponent {\n    NodeLightmap?: NodeLightmap;\n  }\n}\n\n/**\n * Typings for PlayCanvas script-attributes attached to the class.\n */\ninterface NodeLightmap {\n  texture: pc.Asset;\n  texCoord: number;\n\n  lightmapAdd: number[];\n  lightmapScale: number[];\n  coordinateScaleBias: number[];\n\n  entity: pc.Entity & {\n    model: pc.ModelComponent;\n  };\n}\n\ntype MaterialMapping = {\n  original: pc.StandardMaterial;\n  extended: pc.StandardMaterial;\n};\n\nconst nodeLightmapScriptName = \"NodeLightmap\";\n\nclass NodeLightmap extends pc.ScriptType {\n  private static _materialMappings: MaterialMapping[] = [];\n\n  public static clearCachedMaterialMappings() {\n    this._materialMappings = [];\n  }\n\n  public initialize() {\n    if (!this.entity.model) {\n      throw new Error(\"The entity must have a model-component!\");\n    }\n\n    this.applyLightmapToModel();\n  }\n\n  public applyLightmapToModel(): void {\n    if (!this.entity.model.model) {\n      return;\n    }\n\n    this.entity.model.meshInstances.forEach(instance => {\n      instance.material = NodeLightmap._findOrCreateExtendedMaterial(\n        this,\n        instance.material as pc.StandardMaterial,\n      );\n\n      instance.setParameter(\"lm_coordinateScaleBias\", this.coordinateScaleBias);\n      instance.setParameter(\"lm_lightmapAdd\", this.lightmapAdd);\n      instance.setParameter(\"lm_lightmapScale\", this.lightmapScale);\n    });\n  }\n\n  public removeLightmapFromModel(): void {\n    if (!this.entity.model.model) {\n      return;\n    }\n\n    this.entity.model.meshInstances.forEach(instance => {\n      const originalMaterial = NodeLightmap._findOriginalMaterial(\n        instance.material as pc.StandardMaterial,\n      );\n\n      if (originalMaterial !== null) {\n        instance.material = originalMaterial;\n      }\n\n      instance.deleteParameter(\"lm_coordinateScaleBias\");\n      instance.deleteParameter(\"lm_lightmapAdd\");\n      instance.deleteParameter(\"lm_lightmapScale\");\n    });\n  }\n\n  private static _findOrCreateExtendedMaterial(\n    nodeLightmap: NodeLightmap,\n    originalMaterial: pc.StandardMaterial,\n  ): pc.StandardMaterial {\n    let material = this._findExtendedMaterial(nodeLightmap, originalMaterial);\n\n    if (!material) {\n      const { texture, texCoord } = nodeLightmap;\n      material = originalMaterial.clone();\n\n      material.lightMap = texture.resource;\n      material.lightMapUv = texCoord;\n      material.chunks.lightmapSinglePS = this._createLightmapSinglePS();\n      material.update();\n\n      this._materialMappings.push({\n        original: originalMaterial,\n        extended: material,\n      });\n    }\n\n    return material;\n  }\n\n  private static _findExtendedMaterial(\n    nodeLightmap: NodeLightmap,\n    originalMaterial: pc.StandardMaterial,\n  ): pc.StandardMaterial | null {\n    return (\n      this._materialMappings.find(\n        mapping =>\n          mapping.extended === originalMaterial ||\n          (mapping.original === originalMaterial &&\n            mapping.extended.lightMap === nodeLightmap.texture.resource &&\n            mapping.extended.lightMapUv === nodeLightmap.texCoord),\n      )?.extended ?? null\n    );\n  }\n\n  private static _findOriginalMaterial(\n    extendedMaterial: pc.StandardMaterial,\n  ): pc.StandardMaterial | null {\n    return (\n      this._materialMappings.find(\n        mapping => mapping.extended === extendedMaterial,\n      )?.original ?? null\n    );\n  }\n\n  private static _createLightmapSinglePS(): string {\n    return this._getCommonShaderCode() + this._getHighQualityShaderCode();\n  }\n\n  private static _getCommonShaderCode(): string {\n    return `\n      #ifdef MAPTEXTURE\n      uniform sampler2D texture_lightMap;\n      #endif\n\n      uniform vec4 lm_coordinateScaleBias;\n      uniform vec4 lm_lightmapAdd;\n      uniform vec4 lm_lightmapScale;\n\n      vec2 getLightmapUV0(vec2 uv)\n      {\n        return (uv * lm_coordinateScaleBias.xy + lm_coordinateScaleBias.zw) * vec2(1.0, 0.5);\n      }\n\n      vec2 getLightmapUV1(vec2 uv)\n      {\n        return getLightmapUV0(uv) + vec2(0.0, 0.5);\n      }\n    `;\n  }\n\n  private static _getHighQualityShaderCode(): string {\n    return `\n      vec2 flipY(vec2 uv)\n      {\n        return vec2(uv.x, 1.0 - uv.y);\n      }\n\n      vec3 getLightMapColorHQ()\n      {\n        // NOTE: Mesh Uv's are flipped in Y(V) compared to UE4, and\n        // we therefore need to temporarily flip them (again) while\n        // performing scale- and bias-calculations.\n        vec2 flippedUv = flipY($UV);\n        vec2 lightmapUv0 = flipY(getLightmapUV0(flippedUv));\n        vec2 lightmapUv1 = flipY(getLightmapUV1(flippedUv));\n\n        vec4 lightmap0 = texture2D(texture_lightMap, lightmapUv0).rgba;\n        vec4 lightmap1 = texture2D(texture_lightMap, lightmapUv1).rgba;\n\n        float logL = lightmap0.w;\n\n        // Add residual\n        logL += lightmap1.w * (1.0 / 255.0) - (0.5 / 255.0);\n\n        // Range scale logL\n        logL = logL * lm_lightmapScale.w + lm_lightmapAdd.w;\n\n        // Range scale uvw\n        vec3 uvw = lightmap0.rgb * lightmap0.rgb * lm_lightmapScale.rgb + lm_lightmapAdd.rgb;\n\n        // logL -> L\n        const float logBlackPoint = 0.01858136;\n        float l = exp2( logL ) - logBlackPoint;\n\n        float directionality = 0.6;\n\n        float luma = l * directionality;\n        vec3 color = luma * uvw;\n\n        return color;\n      }\n\n      void addLightMap() {\n        dDiffuseLight += getLightMapColorHQ();\n      }\n    `;\n  }\n}\n\nNodeLightmap.attributes.add(\"texture\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  title: \"Texture\",\n});\n\nNodeLightmap.attributes.add(\"texCoord\", {\n  type: \"number\",\n  title: \"TexCoord\",\n});\n\nNodeLightmap.attributes.add(\"lightmapAdd\", {\n  type: \"number\",\n  array: true,\n  title: \"Lightmap add coefficients\",\n});\n\nNodeLightmap.attributes.add(\"lightmapScale\", {\n  type: \"number\",\n  array: true,\n  title: \"Lightmap scale coefficients\",\n});\n\nNodeLightmap.attributes.add(\"coordinateScaleBias\", {\n  type: \"number\",\n  array: true,\n  title: \"Coordinate scale & bias\",\n});\n\nexport { nodeLightmapScriptName, NodeLightmap };\n","import * as pc from \"@animech-public/playcanvas\";\n\nconst hotspotStates = [\n  \"default\",\n  \"hovered\",\n  \"toggled\",\n  \"toggled-hovered\",\n] as const;\ntype HotspotState = typeof hotspotStates[number];\ntype TextureAsset = Omit<pc.Asset, \"resource\"> & { resource: pc.Texture };\ntype OnToggleCallback = (active: boolean) => void;\n\n/**\n * Typings for PlayCanvas script-attributes attached to the class.\n */\ninterface AnimationHotspot {\n  image: TextureAsset;\n  hoveredImage: TextureAsset | null;\n  toggledImage: TextureAsset | null;\n  toggledHoveredImage: TextureAsset | null;\n  transitionDuration: number;\n  parentElementId: string;\n  cacheEntityPosition: boolean;\n  colliderScreenRadius: number;\n}\n\nconst animationHotspotScriptName = \"AnimationHotspot\";\n\n// NOTE: We keep a constant resolution for the picker regardless of\n// current canvas-resolution in order to prevent expensive resizing.\nconst pickerWidth = 256;\nconst pickerHeight = 256;\n\ntype PickerHotspot = {\n  script: AnimationHotspot;\n  pickerPosition: pc.Vec3;\n};\n\nclass AnimationHotspot extends pc.ScriptType {\n  private static _picker: pc.Picker;\n  private static _pickerPixels: Uint8Array;\n  private static _pickerModel: pc.Model;\n  private static _pickerMaterial: pc.Material;\n  private static _hotspots: PickerHotspot[] = [];\n  private static _tempVecs = [new pc.Vec3(), new pc.Vec3(), new pc.Vec3()];\n\n  private _onToggleCallbacks: OnToggleCallback[] = [];\n  private _active = false;\n  private _parentElem: HTMLElement | null = null;\n  private _hotspotElem: HTMLElement;\n  private _hotspotImageElems: {\n    [state in HotspotState]: HTMLImageElement;\n  };\n  private _cachedEntityPosition?: pc.Vec3;\n  private _pickerEntity!: pc.Entity;\n\n  private _screenPosition = new pc.Vec3();\n  private _lastScreenPosition = new pc.Vec3();\n\n  private _wasVisible?: boolean;\n\n  public constructor(args: { app: pc.Application; entity: pc.Entity }) {\n    super(args);\n\n    this._onClick = this._onClick.bind(this);\n    this._onMouseOver = this._onMouseOver.bind(this);\n    this._onMouseOut = this._onMouseOut.bind(this);\n\n    this._hotspotElem = document.createElement(\"div\");\n    this._hotspotImageElems = {\n      default: document.createElement(\"img\"),\n      hovered: document.createElement(\"img\"),\n      toggled: document.createElement(\"img\"),\n      \"toggled-hovered\": document.createElement(\"img\"),\n    };\n\n    Object.values(this._hotspotImageElems).forEach(elem =>\n      this._hotspotElem.appendChild(elem),\n    );\n\n    const { style: hotspotStyle } = this._hotspotElem;\n    hotspotStyle.position = \"absolute\";\n    hotspotStyle.top = \"0px\";\n    hotspotStyle.left = \"0px\";\n    hotspotStyle.transitionProperty = \"opacity\";\n    hotspotStyle.transitionTimingFunction = \"cubic-bezier(0.4, 0, 0.2, 1)\";\n\n    Object.values(this._hotspotImageElems).forEach(imageElem => {\n      imageElem.draggable = false;\n\n      const { style: imageStyle } = imageElem;\n      imageStyle.position = \"absolute\";\n      imageStyle.top = \"0\";\n      imageStyle.left = \"0\";\n      imageStyle.transform = \"translateX(-50%) translateY(-50%)\";\n      imageStyle.opacity = \"0\";\n      imageStyle.cursor = \"pointer\";\n    });\n  }\n\n  public get active() {\n    return this._active;\n  }\n\n  public get elem() {\n    return this._hotspotElem;\n  }\n\n  public initialize() {\n    AnimationHotspot._onInstanceAdded(this);\n\n    this._setStateImages();\n    this._setStateVisibility(\"default\");\n    this._setCachedEntityPosition();\n    this._setParentElem();\n    this._setTransitionDuration();\n    this._addPickerEntity();\n\n    this.on(\"attr:cacheEntityPosition\", this._setCachedEntityPosition, this);\n    this.on(\"attr:parentElementId\", this._setParentElem, this);\n    this.on(\"attr:transitionDuration\", this._setTransitionDuration, this);\n\n    this._hotspotElem.addEventListener(\"click\", this._onClick);\n    this._hotspotElem.addEventListener(\"mouseover\", this._onMouseOver);\n    this._hotspotElem.addEventListener(\"mouseout\", this._onMouseOut);\n\n    this.on(\"destroy\", () => {\n      AnimationHotspot._onInstanceRemoved(this);\n      this._parentElem?.removeChild(this._hotspotElem);\n      this._hotspotElem.removeEventListener(\"click\", this._onClick);\n      this._hotspotElem.removeEventListener(\"mouseover\", this._onMouseOver);\n      this._hotspotElem.removeEventListener(\"mouseout\", this._onMouseOut);\n    });\n\n    this.app.on(\"prerender\", this._onPrerender, this);\n  }\n\n  public onToggle(callback: OnToggleCallback) {\n    if (this._onToggleCallbacks.indexOf(callback) > -1) {\n      return;\n    }\n    this._onToggleCallbacks.push(callback);\n  }\n\n  public offToggle(callback: OnToggleCallback) {\n    const index = this._onToggleCallbacks.indexOf(callback);\n    if (index === -1) {\n      return;\n    }\n    this._onToggleCallbacks.splice(index, 1);\n  }\n\n  private static _onInstanceAdded(script: AnimationHotspot) {\n    this._initialize();\n\n    if (!this._hotspots.find(hotspot => hotspot.script === script)) {\n      this._hotspots.push({\n        script: script,\n        pickerPosition: pc.Vec3.ZERO.clone(),\n      });\n\n      // Start updating the picker when the first instance is added\n      if (this._hotspots.length === 1) {\n        this._updatePicker();\n        this._picker.app.on(\"postrender\", this._updatePicker, this);\n      }\n    }\n  }\n\n  private static _onInstanceRemoved(script: AnimationHotspot) {\n    this._initialize();\n\n    const hotspot = this._hotspots.find(hotspot => hotspot.script === script);\n    if (hotspot) {\n      this._hotspots.splice(this._hotspots.indexOf(hotspot), 1);\n\n      // Stop updating the picker when all instances have been removed\n      if (this._hotspots.length === 0) {\n        this._picker.app.off(\"postrender\", this._updatePicker, this);\n      }\n    }\n  }\n\n  private static _initialize() {\n    if (this._picker) {\n      return;\n    }\n\n    const app = pc.Application.getApplication();\n    if (!app) {\n      throw new Error(\"No Playcanvas application running!\");\n    }\n\n    this._picker = new pc.Picker(app, pickerWidth, pickerHeight);\n    this._pickerPixels = new Uint8Array(4 * pickerWidth * pickerHeight);\n    this._pickerMaterial = new pc.BasicMaterial();\n\n    const mesh = pc.createSphere(app.graphicsDevice, {\n      radius: 1,\n    });\n\n    const node = new pc.GraphNode();\n    const meshInstance = new pc.MeshInstance(\n      node,\n      mesh,\n      AnimationHotspot._pickerMaterial,\n    );\n\n    const model = new pc.Model();\n    model.graph = node;\n    model.meshInstances = [meshInstance];\n\n    this._pickerModel = model;\n\n    this._setPickerMaterialVisible(false);\n  }\n\n  private static _setPickerMaterialVisible(visible: boolean) {\n    this._pickerMaterial.redWrite = visible;\n    this._pickerMaterial.greenWrite = visible;\n    this._pickerMaterial.blueWrite = visible;\n    this._pickerMaterial.alphaWrite = visible;\n    this._pickerMaterial.depthWrite = visible;\n  }\n\n  private static _getActiveCamera(): pc.CameraComponent | undefined {\n    this._initialize();\n\n    const { cameras } = this._picker.app.systems.camera;\n    return cameras[cameras.length - 1];\n  }\n\n  private static _updatePicker() {\n    this._initialize();\n\n    const picker = this._picker;\n    const camera = this._getActiveCamera();\n    if (!camera) {\n      return;\n    }\n\n    const device = picker.app.graphicsDevice;\n    const scaleX = pickerWidth / device.width;\n    const scaleY = pickerHeight / device.height;\n\n    const [screenPos, testPos] = this._tempVecs;\n    const cameraPosition = camera.entity.getPosition();\n\n    // Update scale and calculated picker-position of all active hotspots\n    this._hotspots.forEach(hotspot => {\n      const { script, pickerPosition } = hotspot;\n      if (!script._pickerEntity) {\n        return;\n      }\n\n      const position = script._pickerEntity.getPosition();\n      const cameraDistance = position.distance(cameraPosition); // TODO: Should this be projected along the camera's forward-vector?\n\n      camera.worldToScreen(position, screenPos);\n      camera.screenToWorld(\n        screenPos.x + script.colliderScreenRadius,\n        screenPos.y,\n        cameraDistance,\n        testPos,\n      );\n\n      const scale = testPos.distance(position);\n      script._pickerEntity.setLocalScale(scale, scale, scale);\n\n      pickerPosition.x = Math.floor(screenPos.x * scaleX);\n      pickerPosition.y = Math.floor(screenPos.y * scaleY);\n\n      // Flip Y to match the way textures are stored\n      pickerPosition.y = Math.floor(picker.height - 1 - pickerPosition.y);\n    });\n\n    const worldLayer = picker.app.scene.layers.getLayerById(pc.LAYERID_WORLD);\n\n    // Render to the picker's render-target\n    this._setPickerMaterialVisible(true);\n    picker.prepare(camera, picker.app.scene, worldLayer);\n    this._setPickerMaterialVisible(false);\n\n    // Read all pixels from the render-target into our pixel-array\n    const prevRenderTarget = device.getRenderTarget();\n    device.setRenderTarget(picker.layer.renderTarget);\n    device.updateBegin();\n    device.readPixels(0, 0, pickerWidth, pickerHeight, this._pickerPixels);\n    device.updateEnd();\n    device.setRenderTarget(prevRenderTarget);\n  }\n\n  private static _isHotspotVisible(script: AnimationHotspot) {\n    const hotspot = this._hotspots.find(hotspot => hotspot.script === script);\n    if (!hotspot) {\n      return false;\n    }\n\n    const picker = this._picker;\n    const pixels = this._pickerPixels;\n    const drawCalls = picker.layer.instances.visibleOpaque[0].list;\n\n    const { x, y } = hotspot.pickerPosition;\n\n    // To avoid issues with precision, we sample 3x3 pixels instead of just 1\n    const idx = y * picker.width + x;\n    const r = pixels[4 * idx + 0];\n    const g = pixels[4 * idx + 1];\n    const b = pixels[4 * idx + 2];\n    const index = (r << 16) | (g << 8) | b;\n\n    // White is 'no selection'\n    if (index === 0xffffff) {\n      return false;\n    }\n\n    return drawCalls[index]?.node?.parent === script._pickerEntity;\n  }\n\n  private _addPickerEntity() {\n    this._pickerEntity = new pc.Entity();\n\n    const model = this._pickerEntity.addComponent(\"model\");\n    model.model = AnimationHotspot._pickerModel.clone();\n\n    this.entity.addChild(this._pickerEntity);\n  }\n\n  private _onPrerender(this: AnimationHotspot) {\n    const camera = AnimationHotspot._getActiveCamera();\n    if (!camera) {\n      return;\n    }\n\n    const screenPos = this._screenPosition;\n    const lastScreenPos = this._lastScreenPosition;\n\n    lastScreenPos.copy(screenPos);\n    camera.worldToScreen(this._getEntityPosition(), screenPos);\n\n    // Only update position of HTML element if it has changed\n    if (!lastScreenPos.equals(screenPos)) {\n      const zIndex = Math.max(\n        Math.floor(((camera.farClip - screenPos.z) / camera.farClip) * 10000),\n        1,\n      );\n\n      this._hotspotElem.style.transform = `translateX(${screenPos.x}px) translateY(${screenPos.y}px)`;\n      this._hotspotElem.style.zIndex = String(zIndex);\n    }\n\n    const isVisible = AnimationHotspot._isHotspotVisible(this);\n\n    // Only update visibility of HTML element if it has changed\n    if (this._wasVisible !== isVisible) {\n      this._hotspotElem.style.opacity = isVisible ? \"1\" : \"0\";\n      this._hotspotElem.style.pointerEvents = isVisible ? \"auto\" : \"none\";\n    }\n\n    this._wasVisible = isVisible;\n  }\n\n  private _onClick() {\n    this._active = !this._active;\n    this._onToggleCallbacks.forEach(callback => callback(this._active));\n    this._setStateVisibility(this._active ? \"toggled-hovered\" : \"hovered\");\n  }\n\n  private _onMouseOver() {\n    this._setStateVisibility(this._active ? \"toggled-hovered\" : \"hovered\");\n  }\n\n  private _onMouseOut() {\n    this._setStateVisibility(this._active ? \"toggled\" : \"default\");\n  }\n\n  private _setCachedEntityPosition() {\n    this._cachedEntityPosition = this.cacheEntityPosition\n      ? this.entity.getPosition().clone()\n      : undefined;\n  }\n\n  private _getEntityPosition(): pc.Vec3 {\n    return this._cachedEntityPosition ?? this.entity.getPosition();\n  }\n\n  private _setParentElem() {\n    const elem = this.parentElementId\n      ? document.getElementById(this.parentElementId)\n      : this.app.graphicsDevice.canvas.parentElement;\n\n    if (elem !== this._parentElem) {\n      this._parentElem?.removeChild(this._hotspotElem);\n      elem?.appendChild(this._hotspotElem);\n    }\n\n    this._parentElem = elem;\n  }\n\n  private _setTransitionDuration() {\n    this._hotspotElem.style.transitionDuration = `${this.transitionDuration}ms`;\n  }\n\n  private _getStateImageSource(state: HotspotState) {\n    const texture = (() => {\n      switch (state) {\n        case \"default\":\n          return this.image;\n        case \"hovered\":\n          return this.hoveredImage ?? this.image;\n        case \"toggled\":\n          return this.toggledImage ?? this.image;\n        case \"toggled-hovered\":\n          return (\n            this.toggledHoveredImage ??\n            this.toggledImage ??\n            this.hoveredImage ??\n            this.image\n          );\n      }\n    })();\n    return texture.resource.getSource().src;\n  }\n\n  private _setStateImages() {\n    // By assigning all sources immediately we prevent asset load times from\n    // affecting the transition between states\n    hotspotStates.forEach(\n      state =>\n        (this._hotspotImageElems[state].src = this._getStateImageSource(state)),\n    );\n  }\n\n  private _setStateVisibility(state: HotspotState) {\n    Object.values(this._hotspotImageElems).forEach(\n      elem => (elem.style.opacity = \"0\"),\n    );\n    this._hotspotImageElems[state].style.opacity = \"1\";\n  }\n}\n\nAnimationHotspot.attributes.add(\"image\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  title: \"Image\",\n  description: \"\",\n});\n\nAnimationHotspot.attributes.add(\"hoveredImage\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  default: null,\n  title: \"Hovered image\",\n  description: \"\",\n});\n\nAnimationHotspot.attributes.add(\"toggledImage\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  default: null,\n  title: \"Toggled image\",\n  description: \"\",\n});\n\nAnimationHotspot.attributes.add(\"toggledHoveredImage\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  default: null,\n  title: \"Toggled hovered image\",\n  description: \"\",\n});\n\nAnimationHotspot.attributes.add(\"transitionDuration\", {\n  type: \"number\",\n  default: 0,\n  title: \"Transition duration (ms)\",\n  description:\n    \"Duration of transition when toggling between images for states.\",\n});\n\nAnimationHotspot.attributes.add(\"parentElementId\", {\n  type: \"string\",\n  default: \"\",\n  title: \"Element ID\",\n  description: \"The ID of the element that should parent the hotspot.\",\n});\n\nAnimationHotspot.attributes.add(\"cacheEntityPosition\", {\n  type: \"boolean\",\n  default: false,\n  title: \"Cache entity position\",\n  description:\n    \"Cache entity world position on initialize instead of reading from entity on every frame.\",\n});\n\nAnimationHotspot.attributes.add(\"colliderScreenRadius\", {\n  type: \"number\",\n  default: 10,\n  title: \"Radius of collider in pixels\",\n  description:\n    \"Used for determining if a hotspot is visible or hidden behind other geometry.\",\n});\n\nexport { AnimationHotspot, animationHotspotScriptName };\n","import * as pc from \"@animech-public/playcanvas\";\n\ndeclare module \"@animech-public/playcanvas\" {\n  interface ScriptComponent {\n    SkySphere?: SkySphere;\n  }\n}\n\ntype TextureAsset = Omit<pc.Asset, \"resource\"> & { resource: pc.Texture };\ntype ModelAsset = Omit<pc.Asset, \"resource\"> & { resource: pc.Model };\ntype EntityWithModel = pc.Entity & { model: pc.ModelComponent };\n\n/**\n * Typings for PlayCanvas script-attributes attached to the class.\n */\ninterface SkySphere {\n  skySphereModel?: ModelAsset | null;\n  skyTexture?: TextureAsset | null;\n  cloudsTexture?: TextureAsset | null;\n  starsTexture?: TextureAsset | null;\n\n  directionalLight?: pc.Entity | null;\n\n  sunHeight: number;\n  sunBrightness: number;\n  starsBrightness: number;\n  cloudSpeed: number;\n  cloudOpacity: number;\n  horizonFalloff: number;\n\n  sunRadius: number;\n  noisePower1: number;\n  noisePower2: number;\n\n  colorsDeterminedBySunPosition: boolean;\n\n  zenithColor: pc.Color;\n  horizonColor: pc.Color;\n  cloudColor: pc.Color;\n  overallColor: pc.Color;\n\n  zenithColorCurve: pc.CurveSet;\n  horizonColorCurve: pc.CurveSet;\n  cloudColorCurve: pc.CurveSet;\n\n  scale: pc.Vec3;\n}\n\nconst skySphereScriptName = \"SkySphere\";\n\nclass SkySphere extends pc.ScriptType {\n  private static _skyboxWasInitiallyEnabled = false;\n  private static _instanceCount = 0;\n\n  private _skyEntity!: EntityWithModel;\n  private _material = new pc.Material();\n  private _lightComponent?: pc.LightComponent | null;\n\n  private _time = 0;\n\n  private _defaultHorizonSunColor = new pc.Color(1, 0.221, 0.04);\n  private _defaultZenithSunColor = new pc.Color(0.954, 0.901, 0.74412);\n\n  private _entityRotation = new pc.Quat();\n  private _lightDir = new pc.Vec3();\n\n  private _tempColor = new pc.Color();\n  private _tempQuat = new pc.Quat();\n\n  public initialize() {\n    SkySphere._instanceCount += 1;\n\n    this._skyEntity = new pc.Entity(\"Sky\") as EntityWithModel;\n    this._skyEntity.tags.add(\"ignoreBoundingBox\");\n    this._skyEntity.addComponent(\"model\");\n    this.entity.addChild(this._skyEntity);\n\n    this._initializeMaterial();\n    this._cacheLightComponent();\n    this._updateModel();\n    this._updateTextures();\n    this._updateSettings();\n    this._updateColors();\n    this._updateSun();\n\n    this.on(\"attr:skySphereModel\", this._updateModel, this);\n    this.on(\"attr:scale\", this._updateSkySphereSize, this);\n    this.on(\"attr:skyTexture\", this._updateTextures, this);\n    this.on(\"attr:cloudsTexture\", this._updateTextures, this);\n    this.on(\"attr:starsTexture\", this._updateTextures, this);\n    this.on(\"attr:directionalLight\", this._cacheLightComponent, this);\n    this.on(\"attr:sunBrightness\", this._updateSettings, this);\n    this.on(\"attr:starsBrightness\", this._updateSettings, this);\n    this.on(\"attr:cloudSpeed\", this._updateSettings, this);\n    this.on(\"attr:cloudOpacity\", this._updateSettings, this);\n    this.on(\"attr:horizonFalloff\", this._updateColors, this);\n    this.on(\"attr:sunRadius\", this._updateSettings, this);\n    this.on(\"attr:noisePower1\", this._updateSettings, this);\n    this.on(\"attr:noisePower2\", this._updateSettings, this);\n    this.on(\"attr:zenithColor\", this._updateColors, this);\n    this.on(\"attr:horizonColor\", this._updateColors, this);\n    this.on(\"attr:cloudColor\", this._updateColors, this);\n    this.on(\"attr:overallColor\", this._updateColors, this);\n    this.on(\"attr:zenithColorCurve\", this._updateColors, this);\n    this.on(\"attr:horizonColorCurve\", this._updateColors, this);\n    this.on(\"attr:cloudColorCurve\", this._updateColors, this);\n    this.on(\"attr:colorsDeterminedBySunPosition\", this._updateColors, this);\n\n    // Ensure that the skybox is disabled while a SkySphere instance exists in the scene\n    const layers = this.app.scene.layers;\n    const skyboxLayer = layers.getLayerById(pc.LAYERID_SKYBOX);\n\n    if (SkySphere._instanceCount === 1 && skyboxLayer) {\n      SkySphere._skyboxWasInitiallyEnabled = skyboxLayer.enabled;\n      skyboxLayer.enabled = false;\n    }\n\n    this.on(\"destroy\", () => {\n      SkySphere._instanceCount -= 1;\n\n      if (SkySphere._instanceCount === 0 && skyboxLayer) {\n        skyboxLayer.enabled = SkySphere._skyboxWasInitiallyEnabled;\n      }\n    });\n  }\n\n  public postUpdate(dt: number) {\n    this._time += dt;\n    this._material.setParameter(\"uTime\", this._time);\n\n    this._restrictSkyRotation();\n    this._updateSun();\n  }\n\n  private _restrictSkyRotation() {\n    // Keep the sky oriented in the same direction regardless of entity rotation\n    const entityRotation = this.entity.getRotation();\n\n    if (!entityRotation.equals(this._entityRotation)) {\n      this._entityRotation.copy(entityRotation);\n      this._skyEntity.setRotation(pc.Quat.IDENTITY);\n    }\n  }\n\n  private _cacheLightComponent() {\n    this._lightComponent = this.directionalLight?.findComponent(\n      \"light\",\n    ) as pc.LightComponent | null;\n  }\n\n  private _updateModel() {\n    const modelAsset = this.skySphereModel;\n    const modelComponent = this._skyEntity.model;\n    const material = this._material;\n\n    if (modelAsset) {\n      const model = modelAsset.resource.clone();\n\n      modelComponent.model = model;\n      model.meshInstances.forEach(instance => (instance.material = material));\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      modelComponent.model = null as any;\n    }\n\n    this._updateSkySphereSize();\n  }\n\n  private _updateSkySphereSize() {\n    const skyEntity = this._skyEntity;\n    skyEntity.setLocalScale(this.scale);\n\n    const radius = this._calculateModelSphereRadius(skyEntity.model?.model);\n    this._material.setParameter(\"uObjectRadius\", radius);\n  }\n\n  private _updateTextures() {\n    this._setTextureParameter(\"uSkyMap\", this.skyTexture);\n    this._setTextureParameter(\"uCloudsMap\", this.cloudsTexture);\n    this._setTextureParameter(\"uStarsMap\", this.starsTexture);\n  }\n\n  private _updateSettings() {\n    const material = this._material;\n    material.setParameter(\"uCloudSpeed\", this.cloudSpeed);\n    material.setParameter(\"uNoisePower1\", this.noisePower1);\n    material.setParameter(\"uNoisePower2\", this.noisePower2);\n    material.setParameter(\"uSunRadius\", this.sunRadius);\n    material.setParameter(\"uCloudOpacity\", this.cloudOpacity);\n    material.setParameter(\"uStarsBrightness\", this.starsBrightness);\n    material.setParameter(\"uSunBrightness\", this.sunBrightness);\n  }\n\n  private _updateColors() {\n    const material = this._material;\n\n    if (this.colorsDeterminedBySunPosition) {\n      const sunHeight = pc.math.clamp(this.sunHeight, -1, 1);\n\n      material.setParameter(\n        \"uHorizonColor\",\n        this.horizonColorCurve.value(sunHeight),\n      );\n\n      material.setParameter(\n        \"uZenithColor\",\n        this.zenithColorCurve.value(sunHeight),\n      );\n\n      material.setParameter(\n        \"uCloudColor\",\n        this.cloudColorCurve.value(sunHeight),\n      );\n\n      material.setParameter(\n        \"uHorizonFalloff\",\n        pc.math.lerp(3, 7, Math.abs(sunHeight)),\n      );\n    } else {\n      this._setVectorParameter(\"uCloudColor\", this.cloudColor);\n      this._setVectorParameter(\"uHorizonColor\", this.horizonColor);\n      this._setVectorParameter(\"uZenithColor\", this.zenithColor);\n      material.setParameter(\"uHorizonFalloff\", this.horizonFalloff);\n    }\n\n    this._setVectorParameter(\"uOverallColor\", this.overallColor);\n  }\n\n  private _updateSun() {\n    const lightComponent = this._lightComponent;\n    const lightDir = this._lightDir;\n    const sunColor = this._tempColor;\n    const tempQuat = this._tempQuat;\n\n    if (lightComponent) {\n      const { color, entity } = lightComponent;\n\n      entity.getRotation().transformVector(pc.Vec3.DOWN, lightDir);\n      sunColor.set(color.r, color.g, color.b);\n\n      this.sunHeight = (Math.asin(-lightDir.y) * 180) / Math.PI / 90;\n    } else {\n      this.entity.getRotation().transformVector(pc.Vec3.FORWARD, lightDir);\n\n      const pitch = -pc.math.clamp(this.sunHeight, -1, 1) * 90;\n      const yaw = Math.atan2(-lightDir.x, -lightDir.z) * pc.math.RAD_TO_DEG;\n\n      tempQuat.setFromEulerAngles(pitch, yaw, 0);\n      tempQuat.transformVector(pc.Vec3.FORWARD, lightDir);\n\n      const horizonColor = this._defaultHorizonSunColor;\n      const zenithColor = this._defaultZenithSunColor;\n      const alpha = pc.math.clamp(this.sunHeight + 0.2, 0, 1);\n\n      sunColor.lerp(horizonColor, zenithColor, alpha);\n    }\n\n    this._setVectorParameter(\"uLightDirection\", lightDir);\n    this._setVectorParameter(\"uSunColor\", sunColor);\n    this._material.setParameter(\n      \"uSunHeight\",\n      Math.abs(Math.min(this.sunHeight, 0)),\n    );\n\n    if (this.colorsDeterminedBySunPosition) {\n      this._updateColors();\n    }\n  }\n\n  private _setTextureParameter(\n    parameter: string,\n    value: TextureAsset | null | undefined,\n  ) {\n    const material = this._material;\n    const texture = value?.resource;\n\n    if (texture) {\n      material.setParameter(parameter, texture);\n    } else {\n      material.deleteParameter(parameter);\n    }\n  }\n\n  private _setVectorParameter(\n    parameter: string,\n    value: pc.Vec3 | pc.Color | number[],\n  ) {\n    const material = this._material;\n\n    if (value instanceof pc.Vec3) {\n      material.setParameter(parameter, [value.x, value.y, value.z]);\n    } else if (value instanceof pc.Color) {\n      material.setParameter(parameter, [value.r, value.g, value.b]);\n    } else {\n      material.setParameter(parameter, value);\n    }\n  }\n\n  private _calculateModelSphereRadius(\n    model: pc.Model | null | undefined,\n  ): number {\n    if (!model) {\n      return 0;\n    }\n\n    const meshInstances = model.meshInstances;\n    if (!meshInstances || meshInstances.length < 1) {\n      return 0;\n    }\n\n    const boundingBox = new pc.BoundingBox();\n\n    // Find center of the meshes using a normal bounding-box\n    boundingBox.copy(meshInstances[0].aabb);\n    meshInstances\n      .slice(1)\n      .forEach(meshInstance => boundingBox.add(meshInstance.aabb));\n\n    const positions: number[] = [];\n    const tmpVec1 = new pc.Vec3();\n    const tmpVec2 = new pc.Vec3();\n    let radiusSquared = 0;\n\n    const worldTrans = model.graph.getWorldTransform();\n\n    // Calculate the sphere radius using the distance of each vertex from the center\n    meshInstances.forEach(meshInstance => {\n      const vertexCount = meshInstance.mesh.getPositions(positions);\n\n      for (let idx = 0; idx < vertexCount; idx += 3) {\n        tmpVec1.set(\n          positions[idx * 3 + 0],\n          positions[idx * 3 + 1],\n          positions[idx * 3 + 2],\n        );\n\n        worldTrans.transformPoint(tmpVec1, tmpVec1);\n\n        tmpVec2.sub2(tmpVec1, boundingBox.center);\n        radiusSquared = Math.max(radiusSquared, tmpVec2.lengthSq());\n      }\n    });\n\n    return Math.sqrt(radiusSquared);\n  }\n\n  private _initializeMaterial() {\n    const graphicsDevice = this.app.graphicsDevice;\n    const precision = graphicsDevice.precision;\n    const vertexCode = this._getVertexShaderCode();\n    const fragmentCode = this._getFragmentShaderCode();\n\n    const shader = new pc.Shader(graphicsDevice, {\n      attributes: {\n        aPosition: pc.SEMANTIC_POSITION,\n        aUv0: pc.SEMANTIC_TEXCOORD0,\n        aUv1: pc.SEMANTIC_TEXCOORD1,\n      },\n      vshader: vertexCode,\n      fshader: `precision ${precision} float;\\n ${fragmentCode}`,\n    });\n\n    this._material.shader = shader;\n  }\n\n  private _getVertexShaderCode(): string {\n    return `\n      attribute vec4 aPosition;\n      attribute vec2 aUv0;\n      attribute vec2 aUv1;\n      \n      uniform mat4 matrix_model;\n      uniform mat4 matrix_viewProjection;\n\n      varying vec3 vWorldObjectPosition;\n      varying vec3 vWorldPosition;\n      varying vec2 vUv0;\n      varying vec2 vUv1;\n      \n      void main(void)\n      {\n        vec4 worldObjectPosition = matrix_model * vec4(0.0, 0.0, 0.0, 1.0);\n        vec4 worldPosition = matrix_model * aPosition;\n\n        vWorldObjectPosition = worldObjectPosition.xyz;\n        vWorldPosition = worldPosition.xyz;\n        vUv0 = aUv0;\n        vUv1 = aUv1;\n\n        gl_Position = matrix_viewProjection * worldPosition;\n      }\n    `;\n  }\n\n  private _getFragmentShaderCode(): string {\n    // TODO: Do we need support for HDR / RGBM for the different textures?\n\n    // TODO: Do we need to tonemap the output color?\n\n    const scene = this.app.scene;\n    const programlib = pc.programlib;\n\n    let shaderCode = \"\";\n\n    shaderCode += programlib.gammaCode(scene.gammaCorrection);\n    shaderCode += programlib.tonemapCode(scene.toneMapping);\n\n    shaderCode += `\n      uniform vec3 view_position;\n      uniform vec3 uLightDirection;\n      uniform float uObjectRadius;\n\n      uniform sampler2D uSkyMap;\n      uniform sampler2D uCloudsMap;\n      uniform sampler2D uStarsMap;\n\n      uniform float uCloudSpeed;\n      uniform float uNoisePower1;\n      uniform float uNoisePower2;\n      uniform float uHorizonFalloff;\n      uniform float uSunRadius;\n      uniform float uCloudOpacity;\n      uniform float uStarsBrightness;\n      uniform float uSunBrightness;\n      uniform float uSunHeight;\n      uniform float uTime;\n\n      uniform vec3 uCloudColor;\n      uniform vec3 uOverallColor;\n      uniform vec3 uHorizonColor;\n      uniform vec3 uZenithColor;\n      uniform vec3 uSunColor;\n\n      varying vec3 vWorldObjectPosition;\n      varying vec3 vWorldPosition;\n      varying vec2 vUv0;\n      varying vec2 vUv1;\n\n      struct HorizonDistribution\n      {\n        float cloudAlpha;\n        float horizonAlpha;\n      };\n\n      struct CloudTextures\n      {\n        float base;\n        float exp;\n      };\n\n      struct SkyColors\n      {\n        vec3 color;\n      };\n\n      struct SunVector\n      {\n        float sunDotProduct;\n      };\n\n      struct Sun\n      {\n        vec3 color;\n      };\n\n      struct RimLight\n      {\n        vec3 color;\n        float rimLightAlpha;\n      };\n\n      float saturate(float source)\n      {\n        return clamp(source, 0.0, 1.0);\n      }\n\n      float sphereMask(float a, float b, float radius, float hardness)\n      {\n        float invRadius = 1.0 / max(radius, 0.00001);\n        float invHardness = 1.0 / max(1.0 - hardness, 0.00001);\n\n        float normalizeDistance = abs(a - b) * invRadius;\n        float negNormalizedDistance = 1.0 - normalizeDistance;\n        float maskUnclamped = negNormalizedDistance * invHardness;\n\n        return saturate(maskUnclamped);\n      }\n\n      void evalHorizonDistribution(vec3 cameraVector, out HorizonDistribution results)\n      {\n        results.cloudAlpha = saturate(dot(cameraVector, vec3(0.0, -1.0, 0.0)));\n        results.horizonAlpha = saturate(pow((1.0 - results.cloudAlpha), uHorizonFalloff * 2.0));  // TODO: Find out we need a higher falloff in the viewer to match Unreal\n      }\n\n      void evalCloudTextures(in HorizonDistribution horizonDistribution, out CloudTextures results)\n      {\n        float time = uTime * uCloudSpeed;\n        vec3 position = (vWorldPosition - vWorldObjectPosition) / (uObjectRadius * -0.1);\n\n        vec2 skyUv = vUv0 + vec2(time * 0.0002, 0.0);\n        vec2 cloudUv = vUv0 + vec2(time * 0.001, 0.0);\n\n        float skySample = gammaCorrectInput(texture2D(uSkyMap, skyUv)).r;\n        float cloudSample = gammaCorrectInput(texture2D(uCloudsMap, cloudUv)).r;\n        float mixedSample = mix(skySample, cloudSample, horizonDistribution.cloudAlpha);\n        \n        float heightAlpha = (1.0 - saturate(position.y)) * uCloudOpacity;\n        vec2 noiseUv = vec2(1.0) - ((vec2(1.0) - vUv0) * 0.5); // TODO: Find out why we need this inversion when scaling to match Unreal\n        float noiseAlpha = gammaCorrectInput(texture2D(uCloudsMap, noiseUv)).r;\n\n        results.base = mix(0.0, mixedSample, heightAlpha);\n        results.exp = mix(uNoisePower1, uNoisePower2, noiseAlpha);\n      }\n\n      void evalSkyColors(in HorizonDistribution horizonDistribution, out SkyColors results)\n      {\n        vec3 starsSample = gammaCorrectInput(texture2D(uStarsMap, vUv1 * 12.0)).rgb;\n        vec3 starsColor = starsSample * uStarsBrightness * uSunHeight + uZenithColor;\n\n        results.color = mix(starsColor, uHorizonColor, horizonDistribution.horizonAlpha);\n      }\n\n      void evalSunVector(vec3 cameraVector, vec3 lightDirection, out SunVector results)\n      {\n        results.sunDotProduct = dot(lightDirection, cameraVector);\n      }\n\n      void evalSun(in SunVector sunVector, out Sun results)\n      {\n        float sunSphereMask = sphereMask(sunVector.sunDotProduct, 1.0, uSunRadius, 0.0);\n        \n        results.color = uSunColor * uSunBrightness * sunSphereMask;\n      }\n\n      void evalRimLight(in CloudTextures cloudTextures, in SunVector sunVector, out RimLight results)\n      {\n        float cloudStrength = pow(cloudTextures.base, cloudTextures.exp);\n        float cloudStrengthSq = cloudStrength * cloudStrength;\n\n        float sphereMask = sphereMask(sunVector.sunDotProduct, 1.0, 1.3, 0.0);\n\n        vec3 cloudColor = uCloudColor * cloudStrength;\n        vec3 rimColor = uSunColor * saturate(pow(sphereMask, 10.0)) * cloudStrengthSq * 0.4;\n\n        results.color = cloudColor + rimColor;\n        results.rimLightAlpha = saturate(cloudStrengthSq);\n      }\n\n      void main(void)\n      {\n        Sun sun;\n        RimLight rimLight;\n        SunVector sunVector;\n        SkyColors skyColors;\n        CloudTextures cloudTextures;\n        HorizonDistribution horizonDistribution;\n\n        vec3 lightDir = normalize(uLightDirection);\n        vec3 viewDir = normalize(vWorldPosition - view_position);\n        vec3 cameraVector = -viewDir;\n        \n        evalHorizonDistribution(cameraVector, horizonDistribution);\n        evalSkyColors(horizonDistribution, skyColors);\n        evalCloudTextures(horizonDistribution, cloudTextures);\n        evalSunVector(cameraVector, lightDir, sunVector);\n        evalSun(sunVector, sun);\n        evalRimLight(cloudTextures, sunVector, rimLight);\n\n        vec3 outputColor = mix(sun.color + skyColors.color, rimLight.color, rimLight.rimLightAlpha);\n        outputColor *= uOverallColor;\n        outputColor *= 1.5;\n\n        outputColor = toneMap(outputColor);\n        outputColor = gammaCorrectOutput(outputColor);\n\n        gl_FragColor = vec4(outputColor, 1.0);\n      }\n    `;\n\n    return shaderCode;\n  }\n}\n\nSkySphere.attributes.add(\"skySphereModel\", {\n  type: \"asset\",\n  assetType: \"model\",\n  title: \"Sky-sphere model\",\n});\n\nSkySphere.attributes.add(\"skyTexture\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  title: \"Sky texture\",\n});\n\nSkySphere.attributes.add(\"cloudsTexture\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  title: \"Clouds texture\",\n});\n\nSkySphere.attributes.add(\"starsTexture\", {\n  type: \"asset\",\n  assetType: \"texture\",\n  title: \"Stars texture\",\n});\n\nSkySphere.attributes.add(\"directionalLight\", {\n  type: \"entity\",\n  title:\n    \"Assign your scenes's directional light entity to this variable to  match the sky's sun position and color\",\n});\n\nSkySphere.attributes.add(\"sunHeight\", {\n  type: \"number\",\n  default: 0,\n  title:\n    \"If no directional light is assigned, this value determines the height of the sun\",\n});\n\nSkySphere.attributes.add(\"sunBrightness\", {\n  type: \"number\",\n  default: 50,\n  title: \"Brightness multiplier for the sun disk\",\n});\n\nSkySphere.attributes.add(\"starsBrightness\", {\n  type: \"number\",\n  default: 0.1,\n  title:\n    \"Multiplier for the brightness of the stars when the sun is below the horizon\",\n});\n\nSkySphere.attributes.add(\"cloudSpeed\", {\n  type: \"number\",\n  default: 1,\n  title: \"Panning speed for the clouds\",\n});\n\nSkySphere.attributes.add(\"cloudOpacity\", {\n  type: \"number\",\n  default: 0.7,\n  title: \"Opacity of the panning clouds\",\n});\n\nSkySphere.attributes.add(\"horizonFalloff\", {\n  type: \"number\",\n  default: 3,\n  title: \"Affects the size of the gradient from zenith color to horizon color\",\n});\n\nSkySphere.attributes.add(\"sunRadius\", {\n  type: \"number\",\n  default: 0.0003,\n  title: \"Size of the sun disc\",\n});\n\nSkySphere.attributes.add(\"noisePower1\", {\n  type: \"number\",\n  default: 1,\n  title: \"Cloud noise 1\",\n});\n\nSkySphere.attributes.add(\"noisePower2\", {\n  type: \"number\",\n  default: 4,\n  title: \"Cloud noise 2\",\n});\n\nSkySphere.attributes.add(\"colorsDeterminedBySunPosition\", {\n  type: \"boolean\",\n  default: true,\n  title: \"If enabled, sky colors will change according to the sun's position\",\n});\n\nSkySphere.attributes.add(\"zenithColor\", {\n  type: \"vec3\",\n  default: [0.034046, 0.109247, 0.295],\n  title: \"Zenith color (HDR)\",\n});\n\nSkySphere.attributes.add(\"horizonColor\", {\n  type: \"rgb\",\n  default: [1.979559, 2.586644, 3],\n  title: \"Horizon color (HDR)\",\n});\n\nSkySphere.attributes.add(\"cloudColor\", {\n  type: \"rgb\",\n  default: [0.855778, 0.91902, 1],\n  title: \"Cloud color (HDR)\",\n});\n\nSkySphere.attributes.add(\"overallColor\", {\n  type: \"rgb\",\n  default: [1, 1, 1],\n  title: \"Overall color (HDR)\",\n});\n\nSkySphere.attributes.add(\"zenithColorCurve\", {\n  type: \"curve\",\n  color: \"rgb\",\n  default: {\n    keys: [\n      [-1, 0, -0.4, 0.08, 0, 0.23, 0.1, 0.27, 0.2, 0.08, 0.3, 0.05, 0.5, 0.02],\n      [-1, 0, -0.4, 0.07, 0, 0.1, 0.1, 0.15, 0.2, 0.13, 0.3, 0.09, 0.5, 0.05],\n      [-1, 0, -0.4, 0.08, 0, 0.09, 0.1, 0.13, 0.2, 0.19, 0.3, 0.21, 0.5, 0.12],\n    ],\n  },\n  title: \"Zenith color curve. The keys (time) correspond to sunHeight values\",\n});\n\nSkySphere.attributes.add(\"horizonColorCurve\", {\n  type: \"curve\",\n  color: \"rgb\",\n  default: {\n    keys: [\n      [-1, 0.048, -0.6, 0.386, 0, 2, 0.2, 1.943, 0.4, 0.703, 0.5, 0.92],\n      [-1, 0.052, -0.6, 0.131, 0, 0.6, 0.2, 0.613, 0.4, 1.048, 0.5, 1.322],\n      [-1, 0.075, -0.6, 0.111, 0, 0.2, 0.2, 0.283, 0.4, 1.669, 0.5, 2],\n    ],\n  },\n  title: \"Horizon color curve. The keys (time) correspond to sunHeight values\",\n});\n\nSkySphere.attributes.add(\"cloudColorCurve\", {\n  type: \"curve\",\n  color: \"rgb\",\n  default: {\n    keys: [\n      [-0.8, 0.054, -0.5, 0.198, -0.2, 0.684, 0.2, 0.81, 0.4, 0.857, 0.8, 0.93],\n      [-0.8, 0.059, -0.5, 0.139, -0.2, 0.415, 0.2, 0.514, 0.4, 0.81, 0.8, 0.95],\n      [-0.8, 0.065, -0.5, 0.129, -0.2, 0.304, 0.2, 0.407, 0.4, 0.806, 0.8, 1],\n    ],\n  },\n  title: \"Cloud color curve. The keys (time) correspond to sunHeight values\",\n});\n\nSkySphere.attributes.add(\"scale\", {\n  type: \"vec3\",\n  default: [1, 1, 1],\n  title: \"Sky Sphere scale\",\n});\n\nexport { skySphereScriptName, SkySphere };\n","import * as pc from \"@animech-public/playcanvas\";\nimport { orbitCameraScriptName, OrbitCamera } from \"./scripts\";\n\nexport type CameraEntity = pc.Entity & {\n  camera: pc.CameraComponent;\n  script: pc.ScriptComponent;\n};\n\nexport type OrbitCameraEntity = CameraEntity & {\n  script: CameraEntity[\"script\"] & {\n    [orbitCameraScriptName]: OrbitCamera;\n  };\n};\n\nexport function convertToCameraEntity(entity: pc.Entity): CameraEntity {\n  const cameraComponent = entity.camera ?? entity.addComponent(\"camera\");\n  cameraComponent.clearColor = new pc.Color(0, 0, 0);\n\n  if (!entity.script) {\n    entity.addComponent(\"script\");\n  }\n\n  return entity as CameraEntity;\n}\n\nexport function isOrbitCameraEntity(\n  camera: CameraEntity,\n): camera is OrbitCameraEntity {\n  return camera.script?.has(orbitCameraScriptName) ?? false;\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\n\nconst debug = Debug(\"Variant\");\n\ntype MaterialMapping = Record<number, number>;\n\nexport type VariantNode = {\n  node: pc.Entity;\n  properties: VariantNodeProperties;\n};\n\nexport type VariantNodeProperties = {\n  visible?: boolean;\n  materialMapping?: MaterialMapping;\n  modelAssetID?: number | null;\n};\n\nexport class Variant {\n  public constructor(\n    public name: string,\n    public thumbnailSource: string | undefined,\n    private _isActiveByDefault: boolean,\n    private _variantNodes: VariantNode[],\n  ) {\n    if (_isActiveByDefault) {\n      this.activate();\n    }\n  }\n\n  public get active() {\n    return this._variantNodes.every(({ node, properties }) => {\n      const { visible, modelAssetID, materialMapping } = properties;\n\n      const visibilityMatch = visible === undefined || visible === node.enabled;\n      const modelMatch =\n        modelAssetID === undefined || modelAssetID === node.model?.asset;\n      const materialMappingMatch =\n        materialMapping === undefined ||\n        this._hasMatchingMaterials(materialMapping, node.model);\n\n      return visibilityMatch && modelMatch && materialMappingMatch;\n    });\n  }\n\n  public activate(): void {\n    this._variantNodes.forEach(({ node, properties }) => {\n      if (properties.modelAssetID !== undefined && node.model !== undefined) {\n        debug(\"Set node mesh\", node.name, properties.modelAssetID);\n\n        // TODO: Improve typings for ModelComponent.asset to include null as possible value\n        const assetID = properties.modelAssetID as number;\n\n        if (node.model.asset !== assetID) {\n          // HACK: prevent the anim-component from being reset when changing model by\n          // temporarily removing it from the entity. When resetting the anim-component,\n          // its state-graph is restored from an asset. But we've constructed the graph\n          // dynamically, and that graph would be lost.\n          const animComponent = node.anim;\n          delete node.anim;\n\n          node.model.asset = assetID;\n          node.anim = animComponent;\n        }\n      }\n      if (properties.visible !== undefined) {\n        debug(\"Set node visibility\", node.name, properties.visible);\n        node.enabled = properties.visible;\n      }\n      if (\n        properties.materialMapping !== undefined &&\n        node.model !== undefined\n      ) {\n        debug(\"Set node materials\", node.name, properties.materialMapping);\n\n        // TODO: Applying materials even when the variant-node is already\n        // active may cause different behavior than in UE. For example,\n        // if a mesh-component in UE lacks override-materials and its mesh\n        // is replaced via a mesh variant, the new mesh will use its own materials.\n        // But if the materials of the mesh-component are changed via a material variant\n        // before changing the mesh, the new mesh will use the changed (overridden) materials.\n        // In our case, since materials are applied after all other variants, and every time\n        // something changes, meshes that are switched via mesh variants will always get\n        // the overridden materials. Do we want to change this to match UE?\n\n        if (Object.keys(properties.materialMapping).length < 1) {\n          // NOTE: Mappings without keys serve as \"reset\" mappings, that\n          // restores the original mappings of the source model-asset.\n          node.model.mapping = properties.materialMapping;\n        } else {\n          node.model.mapping = {\n            ...node.model.mapping,\n            ...properties.materialMapping,\n          };\n        }\n      }\n    });\n\n    // Update lightmaps for all affected nodes, in case materials or models have changed.\n    this._variantNodes.forEach(({ node }) => {\n      const nodeLightmap = node.script?.NodeLightmap;\n      if (!nodeLightmap) {\n        return;\n      }\n\n      // TODO: If the mesh has been replaced by a variant, the lightmap sometimes look\n      // different than in Unreal (for the same configuration).\n      // It's expected that the result should look \"wrong\" since the displayed lightmap\n      // belongs to another mesh, but it should still look the same as in Unreal.\n      // Some configurations look correct, others have subtle differences and other still\n      // are completely different. We may wish to investigate this issue later if this is\n      // an important use-case.\n      nodeLightmap.applyLightmapToModel();\n    });\n  }\n\n  private _hasMatchingMaterials(\n    mapping: MaterialMapping,\n    model?: pc.ModelComponent,\n  ): boolean {\n    if (!model?.meshInstances) {\n      return false;\n    }\n\n    if (Object.keys(mapping).length < 1) {\n      // NOTE: Mappings without keys serve as \"reset\" mappings, that\n      // restores the original mappings of the source model-asset.\n      // They are not highlighted as active in Unreal when pressed, so\n      // we replicate the same behavior by returning false.\n      return false;\n    }\n\n    const app = pc.Application.getApplication();\n\n    return model.meshInstances.every((meshInstance, idx) => {\n      const assetID = mapping[idx];\n      if (assetID === undefined) {\n        return true;\n      }\n      const material = app?.assets.get(assetID)?.resource;\n      return !!material && material === meshInstance.material;\n    });\n  }\n}\n","import Debug from \"debug\";\nimport { deepEqual } from \"../utilities\";\nimport { VariantSet, LevelVariantSet } from \"./VariantSet\";\n\nconst debug = Debug(\"VariantSetManager\");\n\nexport type VariantId = number;\nexport type VariantSetState = VariantId[];\nexport type GlobalVariantSetState = ReadonlyArray<VariantSetState>;\n\nexport type OnStateChangeCallback = (value: VariantSetState) => void;\nexport type OnGlobalStateChangeCallback = (\n  state: GlobalVariantSetState,\n) => void;\n\nexport type LevelVariantSetWithIndices = Omit<\n  LevelVariantSet,\n  \"variantSets\"\n> & {\n  variantSets: number[];\n};\n\nexport class VariantSetManager {\n  private _state: GlobalVariantSetState;\n  private _stateCallbacks: OnStateChangeCallback[][];\n  private _globalStateCallbacks: OnGlobalStateChangeCallback[] = [];\n  private _levelVariantSets: LevelVariantSetWithIndices[];\n  private _variantSets: VariantSet[];\n\n  public constructor(levelVariantSets: LevelVariantSet[]) {\n    this._levelVariantSets = [];\n    this._variantSets = [];\n\n    levelVariantSets.forEach(({ name, variantSets }) => {\n      const levelSetWithIndices: LevelVariantSetWithIndices = {\n        name,\n        variantSets: [],\n      };\n      variantSets.forEach(set => {\n        const setIndex = this._variantSets.push(set) - 1;\n        levelSetWithIndices.variantSets.push(setIndex);\n      });\n      this._levelVariantSets.push(levelSetWithIndices);\n    });\n\n    this._stateCallbacks = this._variantSets.map(_ => []);\n    this._state = this._evalGlobalState();\n  }\n\n  public get globalState(): GlobalVariantSetState {\n    return this._state;\n  }\n\n  public get levelVariantSets(): LevelVariantSetWithIndices[] {\n    return this._levelVariantSets;\n  }\n\n  public getName(variantSetId: number): string | undefined {\n    return this._variantSets[variantSetId]?.name;\n  }\n\n  public getVariantIds(variantSetId: number): VariantId[] {\n    return this._variantSets[variantSetId]?.variants.map((_, i) => i) ?? [];\n  }\n\n  public getVariantNames(variantSetId: number): string[] {\n    return (\n      this._variantSets[variantSetId]?.variants.map(variant => variant.name) ??\n      []\n    );\n  }\n\n  public getVariantThumbnails(variantSetId: number): (string | undefined)[] {\n    return (\n      this._variantSets[variantSetId]?.variants.map(\n        variant => variant.thumbnailSource,\n      ) ?? []\n    );\n  }\n\n  public getState(variantSetId: number): VariantSetState | undefined {\n    return this.globalState[variantSetId];\n  }\n\n  public activate(variantSetId: number, variantId: VariantId) {\n    debug(\"Activate variant\", variantId, \"for variant set\", variantSetId);\n\n    if (this._state[variantSetId] === undefined) {\n      throw new Error(`Invalid variant set ${variantSetId}`);\n    }\n\n    const variant = this._variantSets[variantSetId]?.variants[variantId];\n    if (variant === undefined) {\n      throw new Error(\n        `Invalid variant ${variantId} for variant set ${variantSetId}`,\n      );\n    }\n\n    // Activate the variant\n    variant.activate();\n\n    // Evaluate new global state after activation since the triggered variant\n    // might affect other variants\n    const newState = this._evalGlobalState();\n\n    // Trigger callbacks for all updated variant sets\n    newState.forEach((newVariantSetState, variantSetId) => {\n      if (!deepEqual(this._state[variantSetId], newVariantSetState)) {\n        debug(\n          \"State for variant set\",\n          variantSetId,\n          \"changed from\",\n          this._state[variantSetId],\n          \"to\",\n          newVariantSetState,\n        );\n        this._onStateChange(variantSetId, newVariantSetState);\n      }\n    });\n\n    // Update global state\n    this._state = newState;\n\n    // Trigger global state callbacks\n    this._onGlobalStateChange();\n  }\n\n  public onStateChange(variantSetId: number, callback: OnStateChangeCallback) {\n    const callbacks = this._stateCallbacks[variantSetId];\n    if (callbacks === undefined) {\n      throw new Error(`Invalid variant set ${variantSetId}`);\n    }\n\n    if (callbacks.indexOf(callback) > -1) {\n      return;\n    }\n\n    callbacks.push(callback);\n  }\n\n  public offStateChange(variantSetId: number, callback: OnStateChangeCallback) {\n    const callbacks = this._stateCallbacks[variantSetId];\n    if (callbacks === undefined) {\n      throw new Error(`Invalid variant set ${variantSetId}`);\n    }\n\n    const index = callbacks.indexOf(callback);\n    if (index === -1) {\n      return;\n    }\n\n    callbacks.splice(index, 1);\n  }\n\n  public onGlobalStateChange(callback: OnGlobalStateChangeCallback) {\n    const callbacks = this._globalStateCallbacks;\n    if (callbacks.indexOf(callback) > -1) {\n      return;\n    }\n\n    callbacks.push(callback);\n  }\n\n  public offGlobalStateChange(callback: OnGlobalStateChangeCallback) {\n    const callbacks = this._globalStateCallbacks;\n    const index = callbacks.indexOf(callback);\n    if (index === -1) {\n      return;\n    }\n\n    callbacks.splice(index, 1);\n  }\n\n  private _onStateChange(variantSetId: number, state: VariantSetState) {\n    const callbacks = this._stateCallbacks[variantSetId];\n    callbacks.forEach(callback => callback(state));\n  }\n\n  private _onGlobalStateChange() {\n    const callbacks = this._globalStateCallbacks;\n    callbacks.forEach(callback => callback(this.globalState));\n  }\n\n  private _evalGlobalState(): GlobalVariantSetState {\n    return this._variantSets.map(set =>\n      set.variants.reduce<VariantSetState>((acc, variant, variantId) => {\n        if (variant.active) {\n          acc.push(variantId);\n        }\n        return acc;\n      }, []),\n    );\n  }\n}\n","export function deepEqual(a: unknown, b: unknown) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"AnimationPlayback\");\n\ntype AnimHotspotDataMap = {\n  anim: pc.AnimTrack;\n  data: AnimationPlayback;\n};\n\nexport type AnimationPlayback = {\n  loop?: boolean;\n  autoPlay?: boolean;\n  playRate?: number;\n  startTime?: number;\n};\n\nexport const animationPlaybackDefaults = {\n  loop: true,\n  autoPlay: true,\n  playRate: 1,\n  startTime: 0,\n};\n\nexport class AnimationPlaybackExtensionParser implements ExtensionParser {\n  private _animDatas: AnimHotspotDataMap[] = [];\n\n  public get name() {\n    return \"EPIC_animation_playback\";\n  }\n\n  public getPlaybackByAnimationIndex(\n    container: pc.ContainerResource,\n  ): (AnimationPlayback | undefined)[] {\n    const { animations } = container;\n    return animations.map(\n      animationAsset =>\n        this._animDatas.find(({ anim }) => animationAsset.resource === anim)\n          ?.data,\n    );\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.animation.add(this.name, {\n      postParse: this._animationPostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.texture.remove(this.name);\n  }\n\n  public postParse() {\n    // Ignore\n  }\n\n  private _animationPostParse(\n    animTrack: pc.AnimTrack,\n    extensionData: AnimationPlayback,\n  ) {\n    debug(\"Parse animation play data\", animTrack, extensionData);\n\n    this._animDatas.push({\n      anim: animTrack,\n      data: extensionData,\n    });\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"BlendMode\");\n\ntype BlendMode = \"ADDITIVE\" | \"MODULATE\" | \"ALPHACOMPOSITE\";\n\ntype BlendModeData = {\n  blendMode: BlendMode;\n};\n\nexport class BlendModeExtensionParser implements ExtensionParser {\n  public get name() {\n    return \"EPIC_blend_modes\";\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.material.add(this.name, {\n      postParse: this._materialPostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.texture.remove(this.name);\n  }\n\n  public postParse() {\n    // Ignore\n  }\n\n  private _materialPostParse(\n    material: pc.Material,\n    extensionData: BlendModeData,\n  ) {\n    debug(\"Parse Blend mode\", material, extensionData);\n\n    switch (extensionData.blendMode) {\n      case \"ADDITIVE\":\n        material.blendType = pc.BLEND_ADDITIVEALPHA;\n        break;\n      case \"MODULATE\":\n        material.blendType = pc.BLEND_MULTIPLICATIVE;\n        break;\n      case \"ALPHACOMPOSITE\":\n        material.blendType = pc.BLEND_PREMULTIPLIED;\n        break;\n    }\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\ntype ExtensionData = any;\ntype ExtensionDataByName = { [extension: string]: ExtensionData };\ntype ObjectData = { extensions?: ExtensionDataByName };\ntype GltfData = any;\ntype ContainerAssetOptions = any;\n/* eslint-enable @typescript-eslint/no-explicit-any */\n\ntype TextureAsset = Omit<pc.Asset, \"resource\"> & { resource: pc.Texture };\n\n/**\n * Function used by ExtensionRegistry to apply extension data to parsed glTF objects.\n */\nexport type ExtensionPostParseCallback<\n  TObject,\n  TExtData = ExtensionData,\n  TGltfData = GltfData\n> = (\n  /**\n   * The object to be modified.\n   */\n  object: TObject,\n  /**\n   * Extension data that should be applied to \"object\".\n   */\n  extensionData: TExtData,\n  /**\n   * The glTF root.\n   */\n  gltfData: TGltfData,\n) => void;\n\n/**\n * ExtensionParserCallbacks grouped by call order.\n */\nexport type ExtensionParsersByCallOrder<\n  TObject,\n  TExtData = ExtensionData,\n  TGltfData = GltfData\n> = {\n  postParse?: ExtensionPostParseCallback<TObject, TExtData, TGltfData>;\n};\n\n/**\n * ExtensionParsersByCallOrder objects grouped by extension name.\n */\nexport type ExtensionParsersByName<TObject> = {\n  [extension: string]: ExtensionParsersByCallOrder<TObject>;\n};\n\n/**\n * Container for extension parsers for a single glTF object type.\n */\nexport class ExtensionParserCallbackRegistry<TObject> {\n  private _extensions: ExtensionParsersByName<TObject> = {};\n\n  public constructor() {\n    this.add = this.add.bind(this);\n    this.remove = this.remove.bind(this);\n    this.removeAll = this.removeAll.bind(this);\n    this.find = this.find.bind(this);\n    this.index = this.index.bind(this);\n    this.postParse = this.postParse.bind(this);\n  }\n\n  /**\n   * Add a new extension parser to the registry.\n   * @param name The name of the extension.\n   * @param parsers Functions used transform objects that have an extension matching name.\n   * @returns Returns true if the parser was successfully added to the registry, false otherwise.\n   */\n  public add<TExtData, TRootExtData>(\n    name: string,\n    parsers: ExtensionParsersByCallOrder<TObject, TExtData, TRootExtData>,\n  ) {\n    if (this._extensions[name]) {\n      return false;\n    }\n    this._extensions[name] = parsers;\n    return true;\n  }\n\n  /**\n   * Remove an extension parser from the registry.\n   * @param name The name of the extension.\n   */\n  public remove(name: string) {\n    if (!this._extensions[name]) {\n      return;\n    }\n    delete this._extensions[name];\n  }\n\n  /**\n   * Remove all extension parsers from the registry.\n   */\n  public removeAll() {\n    this._extensions = {};\n  }\n\n  /**\n   * Find an extension parser in the registry.\n   * @param name The name of the extension.\n   * @returns The found extension parser or undefined.\n   */\n  public find(name: string) {\n    if (!this._extensions[name]) {\n      return undefined;\n    }\n    return this._extensions[name];\n  }\n\n  /**\n   * Get the index of all extension parsers currently in the registry.\n   * @returns An object of parsers by extension name.\n   */\n  public index() {\n    return this._extensions;\n  }\n\n  /**\n   * Apply all extensions on an object.\n   * @param object The object to be modified.\n   * @param extensionDataByName Object containing extension data that should be applied to \"object\", grouped by extension name.\n   * @param gltfData The glTF root.\n   */\n  public postParse(\n    object: TObject,\n    extensionDataByName: ExtensionDataByName = {},\n    gltfData: GltfData = {},\n  ) {\n    const extensionParsers = this._extensions;\n    Object.keys(extensionDataByName).forEach(extensionId => {\n      const extensionParser = extensionParsers[extensionId];\n      if (extensionParser && extensionParser.postParse) {\n        extensionParser.postParse(\n          object,\n          extensionDataByName[extensionId],\n          gltfData,\n        );\n      }\n    });\n  }\n}\n\n/**\n * Container of extension parsers to be used when parsing glTF files.\n */\nexport class ExtensionRegistry {\n  private _node = new ExtensionParserCallbackRegistry<pc.Entity>();\n  private _scene = new ExtensionParserCallbackRegistry<pc.Entity>();\n  private _camera = new ExtensionParserCallbackRegistry<pc.CameraComponent>();\n  private _texture = new ExtensionParserCallbackRegistry<pc.Texture>();\n  private _material = new ExtensionParserCallbackRegistry<pc.Material>();\n  private _animation = new ExtensionParserCallbackRegistry<pc.AnimTrack>();\n  private _global = new ExtensionParserCallbackRegistry<pc.ContainerResource>();\n\n  public constructor() {\n    this.removeAll = this.removeAll.bind(this);\n  }\n\n  /**\n   * Registry for handling node extension parsers.\n   */\n  public get node() {\n    return this._node;\n  }\n\n  /**\n   * Registry for handling scene extension parsers.\n   */\n  public get scene() {\n    return this._scene;\n  }\n\n  /**\n   * Registry for handling camera extension parsers.\n   */\n  public get camera() {\n    return this._camera;\n  }\n\n  /**\n   * Registry for handling texture extension parsers.\n   */\n  public get texture() {\n    return this._texture;\n  }\n\n  /**\n   * Registry for handling material extension parsers.\n   */\n  public get material() {\n    return this._material;\n  }\n\n  /**\n   * Registry for handling animation extension parsers.\n   */\n  public get animation() {\n    return this._animation;\n  }\n\n  /**\n   * Registry for handling global extension parsers.\n   */\n  public get global() {\n    return this._global;\n  }\n\n  /**\n   * Options object that can be passed to pc.Asset of type \"container\" in order to bind\n   * the glTF parser callbacks to the parsers in this registry,\n   */\n  public get containerAssetOptions(): ContainerAssetOptions {\n    let gltfData: GltfData | undefined;\n\n    function createPostProcessHandler<T>(\n      registry: ExtensionParserCallbackRegistry<T>,\n    ) {\n      return (objectData: ObjectData, object: T) => {\n        if (!objectData.extensions) {\n          return;\n        }\n\n        if (!gltfData) {\n          console.error(\n            \"Gltf data was not loaded before postParse, skipping postParse extensions for\",\n            objectData,\n          );\n          return;\n        }\n\n        registry.postParse(object, objectData.extensions, gltfData);\n      };\n    }\n\n    return {\n      global: {\n        preprocess: (gltf: GltfData) => {\n          gltfData = gltf;\n        },\n        // TODO: Try to refactor this into createPostProcessHandler\n        postprocess: (gltfData: GltfData, containerData: unknown) => {\n          if (!gltfData.extensions) {\n            return;\n          }\n\n          if (!gltfData) {\n            console.error(\n              \"Gltf data was not loaded before postParse, skipping postParse extensions for\",\n              containerData,\n            );\n            return;\n          }\n\n          this.global.postParse(\n            new pc.ContainerResource(containerData),\n            gltfData.extensions,\n            gltfData,\n          );\n        },\n      },\n      node: { postprocess: createPostProcessHandler(this.node) },\n      scene: { postprocess: createPostProcessHandler(this.scene) },\n      camera: { postprocess: createPostProcessHandler(this.camera) },\n      texture: {\n        postprocess: (objectData: ObjectData, object: TextureAsset) => {\n          if (!objectData.extensions) {\n            return;\n          }\n          this.texture.postParse(object.resource, objectData.extensions);\n        },\n      },\n      material: { postprocess: createPostProcessHandler(this.material) },\n      animation: { postprocess: createPostProcessHandler(this.animation) },\n    };\n  }\n\n  /**\n   * Remove all extension parsers.\n   */\n  public removeAll() {\n    this._node.removeAll();\n    this._scene.removeAll();\n    this._camera.removeAll();\n    this._texture.removeAll();\n    this._material.removeAll();\n    this._animation.removeAll();\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"HdrEncoding\");\n\ntype Encoding = \"RGBM\";\n\ntype TextureExtensionData = {\n  encoding: Encoding;\n};\n\nexport class HdrEncodingExtensionParser implements ExtensionParser {\n  public get name() {\n    return \"EPIC_texture_hdr_encoding\";\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.texture.add(this.name, {\n      postParse: this._texturePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.texture.remove(this.name);\n  }\n\n  public postParse() {\n    // Ignore\n  }\n\n  private _texturePostParse(\n    texture: pc.Texture,\n    extensionData: TextureExtensionData,\n  ) {\n    debug(\"Parse HDR encoding\", texture, extensionData);\n\n    if (extensionData.encoding === \"RGBM\") {\n      texture.type = pc.TEXTURETYPE_RGBM;\n    }\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\n\nfunction syncCubemapToCpu(\n  renderTarget: pc.RenderTarget,\n  device: pc.GraphicsDevice,\n) {\n  const tex = renderTarget._colorBuffer;\n\n  if (tex.format !== pc.PIXELFORMAT_R8_G8_B8_A8) {\n    return;\n  }\n\n  const pixels = new Uint8Array(tex.width * tex.height * 4);\n  const gl = device.gl;\n\n  device.setFramebuffer(renderTarget._glFrameBuffer);\n  gl.readPixels(0, 0, tex.width, tex.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n\n  if (!tex._levels) {\n    tex._levels = [];\n  }\n\n  if (!tex._levels[0]) {\n    tex._levels[0] = [];\n  }\n\n  for (let face = 0; face < 6; face += 1) {\n    tex._levels[0][face] = pixels;\n  }\n}\n\n/**\n * Creates a smaller cubemap from a larger cubemap by down-sampling it.\n *\n * @param sourceCubemap Source cubemap, must have a power-of-two size and must be larger than `outputSize`\n * @param outputSize Desired size of the created cubemap\n * @param device Graphics-device\n * @param syncToCpu (Optional) Fills the `_levels`-property of the created cubemap with mip-data\n */\nexport function downSampleCubemap(\n  sourceCubemap: pc.Texture,\n  outputSize: number,\n  device: pc.GraphicsDevice,\n  syncToCpu?: boolean,\n): pc.Texture {\n  const logSourceSize = Math.round(Math.log2(sourceCubemap.width));\n  const logOutputSize = Math.round(Math.log2(outputSize));\n  const steps = logSourceSize - logOutputSize;\n\n  if (steps < 0) {\n    throw new Error(\"Output-size must be less or equal than source-size\");\n  }\n\n  const sourceType = sourceCubemap.type;\n  const sourceFormat = sourceCubemap.format;\n\n  const chunks = pc.shaderChunks;\n  const shader = chunks.createShaderFromCode(\n    device,\n    chunks.fullscreenQuadVS,\n    chunks.outputCubemapPS,\n    \"outputCubemap\",\n  );\n\n  const constantTexSource = device.scope.resolve(\"source\");\n  const constantParams = device.scope.resolve(\"params\");\n  const params = new pc.Vec4();\n\n  let inputCubemap = sourceCubemap;\n  let outputCubemap = sourceCubemap;\n\n  for (let i = 0; i < steps; i += 1) {\n    const outputSize = inputCubemap.width * 0.5;\n\n    outputCubemap = new pc.Texture(device, {\n      cubemap: true,\n      name: \"prefiltered-cube\",\n      type: sourceType as string,\n      format: sourceFormat,\n      width: outputSize,\n      height: outputSize,\n      mipmaps: false,\n    });\n\n    for (let face = 0; face < 6; face += 1) {\n      const renderTarget = new pc.RenderTarget({\n        colorBuffer: outputCubemap,\n        face: face,\n        depth: false,\n      });\n\n      params.x = face;\n\n      // TODO: do we need to decode / encode RGBM when down-sampling,\n      // or is it ok to just let the data be down-sampled regardless?\n      // params.w = isRgbm ? 3 : 0;\n\n      constantTexSource.setValue(sourceCubemap);\n      constantParams.setValue(params.data);\n\n      pc.drawQuadWithShader(device, renderTarget, shader);\n\n      if (syncToCpu) {\n        syncCubemapToCpu(renderTarget, device);\n      }\n    }\n\n    inputCubemap = outputCubemap;\n  }\n\n  return outputCubemap;\n}\n\n/**\n * Creates a new cubemap that uses the passed textures as faces for mip 0.\n * The cubemap will have the same format and type as the first texture.\n * All textures are assumed to have the same format, type and resolution.\n *\n * @param textures 6 textures to use as faces for the cubemap\n * @param device Graphics-device\n * @param mipmaps (Optional) Generate mipmaps for the cubemap\n */\nexport function createCubemapFromTextures(\n  textures: pc.Texture[],\n  device: pc.GraphicsDevice,\n  mipmaps = false,\n): pc.Texture {\n  const { width, height, format, type } = textures[0];\n\n  const cubemap = new pc.Texture(device, {\n    cubemap: true,\n    mipmaps: mipmaps,\n    format: format,\n    type: type,\n    width: width,\n    height: height,\n    fixCubemapSeams: true,\n    addressU: pc.ADDRESS_CLAMP_TO_EDGE,\n    addressV: pc.ADDRESS_CLAMP_TO_EDGE,\n  });\n\n  cubemap._levels = [\n    [\n      textures[0]._levels[0],\n      textures[1]._levels[0],\n      textures[2]._levels[0],\n      textures[3]._levels[0],\n      textures[4]._levels[0],\n      textures[5]._levels[0],\n    ],\n  ];\n\n  cubemap.upload();\n\n  return cubemap;\n}\n\n/**\n * Creates 6 prefiltered cubemaps from a single rgbm-encoded cubemap, with the following sizes:\n * 128x128, 64x64, 32x32, 16x16, 8x8, 4x4\n *\n * @param sourceCubemap Source cubemap, must have a size of atleast 128x128\n * @param device Graphics-device\n * @param options (Optional)\n * @param options.syncToCpu (Optional) Fills the `_levels`-property of the created cubemaps with mip-data\n * @param options.createMipChainInFirstMip (Optional) Modifies the 128x128 cubemap to contain all smaller cubemaps as mips\n */\nexport function prefilterRgbmCubemap(\n  sourceCubemap: pc.Texture,\n  device: pc.GraphicsDevice,\n  options?: {\n    syncToCpu?: boolean;\n    createMipChainInFirstMip?: boolean;\n  },\n): pc.Texture[] {\n  if (sourceCubemap.type !== pc.TEXTURETYPE_RGBM) {\n    throw new Error(\"The source cubemap must use RGBM-encoding\");\n  }\n\n  if (sourceCubemap.width < 128) {\n    throw new Error(\"The source cubemap must have a size of 128 or more\");\n  }\n\n  const syncToCpu = options?.syncToCpu || options?.createMipChainInFirstMip;\n\n  if (sourceCubemap.width > 128) {\n    sourceCubemap = downSampleCubemap(sourceCubemap, 128, device, syncToCpu);\n    sourceCubemap.name = \"prefiltered-cube-128\";\n  }\n\n  const mipSizes = [128, 64, 32, 16, 8, 4];\n  const mipGloss = [0, 512, 128, 32, 8, 2];\n\n  const mipCubemaps = mipSizes.map((mipSize, mip) => {\n    if (mip === 0) {\n      return sourceCubemap;\n    } else {\n      return new pc.Texture(device, {\n        cubemap: true,\n        mipmaps: false,\n        name: `prefiltered-cube-${mipSize}`,\n        type: sourceCubemap.type as string,\n        format: sourceCubemap.format,\n        fixCubemapSeams: true,\n        width: mipSize,\n        height: mipSize,\n        addressU: pc.ADDRESS_CLAMP_TO_EDGE,\n        addressV: pc.ADDRESS_CLAMP_TO_EDGE,\n      });\n    }\n  });\n\n  const samples = 4096;\n  const method = \"phong\";\n\n  const chunks = pc.shaderChunks;\n  const shader = chunks.createShaderFromCode(\n    device,\n    chunks.fullscreenQuadVS,\n    chunks.rgbmPS +\n      chunks.prefilterCubemapPS\n        .replace(/\\$METHOD/g, method)\n        .replace(/\\$NUMSAMPLES/g, samples)\n        .replace(/\\$textureCube/g, \"textureCubeRGBM\"),\n    \"prefilterRgbmCubemap\",\n  );\n\n  const constantTexSource = device.scope.resolve(\"source\");\n  const constantParams = device.scope.resolve(\"params\");\n  const params = new pc.Vec4();\n\n  for (let mip = 1; mip < mipSizes.length; mip += 1) {\n    for (let face = 0; face < 6; face += 1) {\n      const renderTarget = new pc.RenderTarget({\n        colorBuffer: mipCubemaps[mip],\n        face: face,\n        depth: false,\n      });\n\n      params.x = face;\n      params.y = mipGloss[mip];\n      params.z = mipSizes[mip];\n\n      // TODO: params.w is set to 3 in the engine's prefilterCubemap-function, and the shader\n      // treats 1 and 3 different than other values.\n      // It seems to be used to \"fix\" edges in the cubemap, but appears to have the opposite\n      // effect when used on our RGBM-encoded textures.\n      // We need to determine if we really have a need for fixing edges, and if so,\n      // if we can do it without introducing artifacts.\n      params.w = 2;\n\n      constantTexSource.setValue(mipCubemaps[mip - 1]);\n      constantParams.setValue(params.data);\n\n      pc.drawQuadWithShader(device, renderTarget, shader);\n\n      if (syncToCpu) {\n        syncCubemapToCpu(renderTarget, device);\n      }\n    }\n  }\n\n  if (options?.createMipChainInFirstMip) {\n    const cubemap = mipCubemaps[0];\n\n    for (let mip = 1; mip < mipSizes.length; mip += 1) {\n      cubemap._levels[mip] = mipCubemaps[mip]._levels[0];\n    }\n\n    cubemap.upload();\n    cubemap._prefilteredMips = true;\n  }\n\n  return mipCubemaps;\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { HdriBackdrop as HdriBackdropScript } from \"../scripts\";\nimport { createCubemapFromTextures, prefilterRgbmCubemap } from \"../utilities\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"HdriBackdrop\");\n\ntype BackdropData = {\n  mesh: number;\n  cubemap: number[];\n  intensity: number;\n  size: number;\n  angle?: number;\n  projectionCenter: [number, number, number];\n  lightingDistanceFactor: number;\n  useCameraProjection: boolean;\n};\n\ntype NodeExtensionData = {\n  backdrop: number;\n};\n\ntype RootData = {\n  extensions?: {\n    EPIC_hdri_backdrops?: {\n      backdrops: BackdropData[];\n    };\n  };\n};\n\ntype NodeBackdropDefinition = {\n  node: pc.Entity;\n  data: BackdropData;\n};\n\nexport type HdriBackdrop = {\n  node: pc.Entity;\n  script: HdriBackdropScript;\n  cubemap: pc.Texture;\n  skyboxCubemaps: pc.Texture[];\n  skyboxIntensity: number;\n};\n\nexport class HdriBackdropExtensionParser implements ExtensionParser {\n  private _nodeBackdrops: NodeBackdropDefinition[] = [];\n\n  public get name() {\n    return \"EPIC_hdri_backdrops\";\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.node.add(this.name, {\n      postParse: this._nodePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.node.remove(this.name);\n  }\n\n  public getBackdropsForScene(\n    scene: pc.Entity,\n    container: pc.ContainerResource,\n  ): HdriBackdrop[] {\n    const app = pc.Application.getApplication();\n    if (!app) {\n      throw new Error(\"Couldn't find current application\");\n    }\n\n    const device = app.graphicsDevice;\n\n    return this._nodeBackdrops\n      .filter(nodeBackdrop => scene.findOne(node => node === nodeBackdrop.node))\n      .map<HdriBackdrop | null>(({ data, node }) => {\n        const textures = this._findCubemapTextures(data, container);\n        if (!textures) {\n          debug(\"Invalid or missing cubemap textures for node \", node.name);\n          return null;\n        }\n\n        const modelAsset = container.models[data.mesh];\n        if (!modelAsset) {\n          debug(\"Model is missing for node \", node.name);\n          return null;\n        }\n\n        // TODO: Share cubemaps between multiple backdrops that use the same textures\n        const cubemap = createCubemapFromTextures(textures, device, true);\n        if (!cubemap) {\n          debug(\"Cubemap could not be created for node \", node.name);\n          return null;\n        }\n\n        const cubemapAsset = new pc.Asset(\"\", \"cubemap\");\n        cubemapAsset.resource = cubemap;\n\n        const script = node.addComponent(\"script\").create(HdriBackdropScript, {\n          enabled: false, // Since there can be more than one backdrop, we need to enable the correct one later\n          attributes: this._stripUndefinedProperties({\n            ...data,\n            model: modelAsset,\n            cubemap: cubemapAsset,\n          }),\n        });\n\n        // TODO: Use reflection probe to capture the environment instead of setting the skybox\n        const skyboxCubemaps = prefilterRgbmCubemap(cubemap, device, {\n          createMipChainInFirstMip: true,\n        });\n\n        const skyboxIntensity = data.intensity;\n        return {\n          node,\n          script,\n          cubemap,\n          skyboxCubemaps,\n          skyboxIntensity,\n        };\n      })\n      .filter((backdrop): backdrop is HdriBackdrop => backdrop !== null);\n  }\n\n  public postParse(_container: pc.ContainerResource) {\n    // Ignore\n  }\n\n  private _nodePostParse(\n    node: pc.Entity,\n    extensionData: NodeExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse backdrop\", node, extensionData, rootData);\n\n    const backdrop =\n      rootData.extensions?.EPIC_hdri_backdrops?.backdrops?.[\n        extensionData.backdrop\n      ];\n    if (!backdrop) {\n      return;\n    }\n\n    debug(\"Found backdrop\", backdrop);\n\n    const backdropNode = new pc.Entity(node.name + \"_backdrop\");\n    node.addChild(backdropNode);\n\n    this._nodeBackdrops.push({\n      node: backdropNode,\n      data: backdrop,\n    });\n  }\n\n  private _findCubemapTextures(\n    data: BackdropData,\n    container: pc.ContainerResource,\n  ): pc.Texture[] | null {\n    if (data?.cubemap?.length !== 6) {\n      return null;\n    }\n\n    const textures = data.cubemap\n      .map(index => container.textures[index])\n      .map(asset => asset?.resource)\n      .filter(texture => !!texture);\n\n    return textures.length === 6 ? textures : null;\n  }\n\n  private _stripUndefinedProperties<T extends {}>(obj: T): T {\n    const result = { ...obj };\n\n    Object.keys(result).forEach(<K extends keyof T>(key: K) => {\n      if (result[key] === undefined) {\n        delete result[key];\n      }\n    });\n\n    return result;\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { Animation, AnimationState } from \"../Animation\";\nimport { AnimationHotspot } from \"../scripts\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"AnimationHotspot\");\n\ntype HotspotData = {\n  image: number;\n  hoveredImage?: number;\n  toggledImage?: number;\n  toggledHoveredImage?: number;\n  animation?: number;\n};\n\ntype NodeExtensionData = {\n  hotspot: number;\n};\n\ntype RootData = {\n  extensions?: {\n    EPIC_animation_hotspots?: {\n      hotspots: HotspotData[];\n    };\n  };\n};\n\ntype NodeHotspotDataMap = {\n  node: pc.Entity;\n  data: HotspotData;\n};\n\nexport class AnimationHotspotExtensionParser implements ExtensionParser {\n  private _hotspotDatas: NodeHotspotDataMap[] = [];\n  private _hotspots?: AnimationHotspot[];\n\n  public get name() {\n    return \"EPIC_animation_hotspots\";\n  }\n\n  public get hotspotAnimationIndices(): number[] {\n    return this._hotspotDatas\n      .map(({ data }) => data.animation)\n      .filter(\n        (animationIndex, index, animationIndices): animationIndex is number =>\n          animationIndex !== undefined &&\n          animationIndices.indexOf(animationIndex) === index,\n      );\n  }\n\n  public getHotspotsForScene(\n    scene: pc.Entity,\n    animations: Animation[],\n    container: pc.ContainerResource,\n  ): AnimationHotspot[] {\n    const { textures } = container;\n\n    if (!this._hotspots) {\n      this._hotspots = this._initHotspotScripts(animations, textures);\n    }\n\n    return this._hotspots.filter(hotspot =>\n      scene.findOne(node => node === hotspot.entity),\n    );\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.node.add(this.name, {\n      postParse: this._nodePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.node.remove(this.name);\n  }\n\n  public postParse() {\n    // Ignore\n  }\n\n  private _nodePostParse(\n    node: pc.Entity,\n    extensionData: NodeExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse hotspot\", node, extensionData, rootData);\n\n    const hotspot =\n      rootData.extensions?.EPIC_animation_hotspots?.hotspots[\n        extensionData.hotspot\n      ];\n    if (!hotspot) {\n      return;\n    }\n\n    debug(\"Found hotspot\", hotspot);\n\n    this._hotspotDatas.push({\n      node,\n      data: hotspot,\n    });\n  }\n\n  private _initHotspotScripts(animations: Animation[], textures: pc.Asset[]) {\n    return this._hotspotDatas\n      .filter(hotspot => textures[hotspot.data.image])\n      .map(hotspot => {\n        const animation = animations.find(\n          ({ index }) => index === hotspot.data.animation,\n        );\n\n        const script = hotspot.node\n          .addComponent(\"script\")\n          .create(AnimationHotspot, {\n            enabled: false, // This is enabled later for the active scene\n          });\n\n        script.transitionDuration = 200;\n        script.colliderScreenRadius = 18; // TODO: Make this driven by image-size?\n\n        script.image = textures[hotspot.data.image];\n        if (hotspot.data.hoveredImage) {\n          script.hoveredImage = textures[hotspot.data.hoveredImage];\n        }\n        if (hotspot.data.toggledImage) {\n          script.toggledImage = textures[hotspot.data.toggledImage];\n        }\n        if (hotspot.data.toggledHoveredImage) {\n          script.toggledHoveredImage =\n            textures[hotspot.data.toggledHoveredImage];\n        }\n\n        script.onToggle(active => {\n          debug(\"Toggle hotspot\", active);\n\n          if (!animation || !animation.playable) {\n            return;\n          }\n\n          animation.play(\n            active ? AnimationState.Once : AnimationState.OnceReverse,\n            animation.activeStateClipTime,\n          );\n        });\n\n        return script;\n      });\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { OrbitCamera, OrbitCameraMode } from \"../scripts\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"CameraControl\");\n\ntype NodeExtensionData = {\n  mode: \"freeLook\" | \"orbital\";\n  target: number;\n  maxDistance: number;\n  minDistance: number;\n  maxPitch?: number;\n  minPitch?: number;\n  maxYaw?: number;\n  minYaw?: number;\n  rotationSensitivity: number;\n  rotationInertia: number;\n  dollySensitivity: number;\n  dollyDuration: number;\n};\n\ntype OrbitCameraScriptFocusMap = {\n  script: OrbitCamera;\n  node: number;\n};\n\nexport class CameraControlExtensionParser implements ExtensionParser {\n  private _focusNodes: OrbitCameraScriptFocusMap[] = [];\n\n  public get name() {\n    return \"EPIC_camera_controls\";\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.camera.add(this.name, {\n      postParse: this._cameraPostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.camera.remove(this.name);\n  }\n\n  public postParse(container: pc.ContainerResource) {\n    debug(\"Post parse camera control\");\n\n    this._focusNodes.forEach(\n      ({ script, node: nodeIndex }) =>\n        (script.focusEntity = container.nodes[nodeIndex] ?? null),\n    );\n  }\n\n  private _cameraPostParse(\n    camera: pc.CameraComponent,\n    data: NodeExtensionData,\n  ) {\n    debug(\"Parse camera control\", camera, data);\n\n    const missingProperties = this._getMissingProperties(data, [\n      \"mode\",\n      \"maxDistance\",\n      \"minDistance\",\n      \"rotationSensitivity\",\n      \"rotationInertia\",\n      \"dollySensitivity\",\n      \"dollyDuration\",\n    ]);\n\n    if (missingProperties.length > 0) {\n      missingProperties.forEach(key =>\n        debug(\n          `Property '${key}' for camera control '${camera.entity.name}' is missing`,\n        ),\n      );\n      return;\n    }\n\n    const cameraMode = this._parseOrbitCameraMode(data.mode);\n    if (cameraMode === null) {\n      debug(\n        `Camera mode '${data.mode}' for camera control '${camera.entity.name}' is invalid`,\n      );\n      return;\n    }\n\n    const script = (\n      camera.entity.script ?? camera.entity.addComponent(\"script\")\n    ).create(OrbitCamera, {\n      enabled: false, // This is enabled later for the active camera\n    });\n\n    script.mode = cameraMode;\n    script.pitchAngleMax = data.maxPitch ?? script.pitchAngleMax;\n    script.pitchAngleMin = data.minPitch ?? script.pitchAngleMin;\n    script.yawAngleMax = data.maxYaw ?? script.yawAngleMax;\n    script.yawAngleMin = data.minYaw ?? script.yawAngleMin;\n    script.distanceMax = data.maxDistance;\n    script.distanceMin = data.minDistance;\n    script.distanceSensitivity = data.dollySensitivity;\n    script.orbitSensitivity = data.rotationSensitivity;\n    script.inertiaFactor = data.rotationInertia;\n    script.dollyDuration = data.dollyDuration;\n\n    debug(\"Added orbit camera script\", camera, script);\n\n    this._focusNodes.push({\n      script: script,\n      node: data.target,\n    });\n  }\n\n  private _getMissingProperties<T extends {}>(\n    obj: T,\n    properties: (keyof T)[],\n  ): (keyof T)[] {\n    return properties.filter(key => obj[key] === undefined);\n  }\n\n  private _parseOrbitCameraMode(\n    cameraControlMode?: string,\n  ): OrbitCameraMode | null {\n    if (!cameraControlMode || cameraControlMode.length < 2) {\n      return null;\n    }\n\n    const modeName = this._capitalizeFirstLetter(cameraControlMode);\n    return OrbitCameraMode[modeName as keyof typeof OrbitCameraMode] ?? null;\n  }\n\n  private _capitalizeFirstLetter(text: string): string {\n    return text.charAt(0).toUpperCase() + text.slice(1);\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { hasNoUndefinedValues } from \"../../utilities\";\nimport {\n  Variant,\n  VariantNode,\n  VariantNodeProperties,\n  LevelVariantSet,\n  VariantSet,\n} from \"../../variants\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"VariantSet\");\n\ntype SceneExtensionData = {\n  levelVariantSets: number[];\n};\n\ntype RootData = {\n  extensions?: {\n    EPIC_level_variant_sets?: {\n      levelVariantSets: LevelVariantSetData[];\n    };\n  };\n};\n\ntype SceneVariantSetDataMap = {\n  scene: pc.Entity;\n  data: LevelVariantSetData[];\n};\n\ntype LevelVariantSetData = {\n  name: string;\n  variantSets: VariantSetData[];\n};\n\ntype VariantSetData = {\n  name: string;\n  variants: {\n    name: string;\n    active: boolean;\n    thumbnail?: number;\n    nodes: {\n      node: number;\n      properties: VariantNodePropertiesData;\n    }[];\n  }[];\n};\n\ntype VariantMaterialData = {\n  index: number;\n  material: number;\n};\n\ntype VariantNodePropertiesData = {\n  visible?: boolean;\n  materials?: VariantMaterialData[];\n  mesh?: number;\n};\n\nexport class VariantSetExtensionParser implements ExtensionParser {\n  private _variantSets: SceneVariantSetDataMap[] = [];\n\n  public get name() {\n    return \"EPIC_level_variant_sets\";\n  }\n\n  public getVariantSetsForScene(\n    scene: pc.Entity,\n    container: pc.ContainerResource,\n  ): LevelVariantSet[] {\n    const { textures, nodes: nodeEntities } = container;\n\n    return this._variantSets\n      .filter(set => set.scene === scene)\n      .reduce<LevelVariantSetData[]>((sets, set) => [...sets, ...set.data], [])\n      .map<LevelVariantSet>(({ name, variantSets: sets }) => ({\n        name,\n        variantSets: sets.map<VariantSet>(set => ({\n          ...set,\n          variants: set.variants.map<Variant>(\n            ({ name, active, thumbnail, nodes }) =>\n              new Variant(\n                name,\n                thumbnail !== undefined\n                  ? (textures[thumbnail]?.resource as\n                      | pc.Texture\n                      | undefined)?.getSource().src\n                  : undefined,\n                active,\n                nodes.map<VariantNode>(({ node, properties }) => ({\n                  node: nodeEntities[node],\n                  properties: this._parseVariantNodeProperties(\n                    properties,\n                    container,\n                  ),\n                })),\n              ),\n          ),\n        })),\n      }));\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.scene.add(this.name, {\n      postParse: this._scenePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.scene.remove(this.name);\n  }\n\n  public postParse() {\n    // Ignore\n  }\n\n  private _scenePostParse(\n    scene: pc.Entity,\n    extensionData: SceneExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse variant sets\", scene, extensionData);\n\n    const levelVariantSets = extensionData.levelVariantSets.map(\n      set =>\n        rootData.extensions?.EPIC_level_variant_sets?.levelVariantSets[set],\n    );\n\n    if (!hasNoUndefinedValues(levelVariantSets)) {\n      return;\n    }\n\n    debug(\"Found variant sets\", levelVariantSets);\n\n    this._variantSets.push({\n      scene,\n      data: levelVariantSets,\n    });\n  }\n\n  private _parseVariantNodeProperties(\n    { visible, materials, mesh }: VariantNodePropertiesData,\n    container: pc.ContainerResource,\n  ): VariantNodeProperties {\n    return {\n      visible,\n      materialMapping: materials?.reduce((result, data) => {\n        const material = container.materials[data.material];\n        if (material) {\n          return {\n            ...result,\n            [data.index]: material.id,\n          };\n        } else {\n          return result;\n        }\n      }, {}),\n      modelAssetID:\n        mesh !== undefined && mesh !== -1\n          ? container.models[mesh]?.id\n          : mesh === -1\n          ? null\n          : undefined,\n    };\n  }\n}\n","export function hasNoUndefinedValues<T>(\n  items: (T | undefined)[],\n): items is T[] {\n  return !items.some(item => item === undefined);\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { Variant, VariantNode, LevelVariantSet } from \"../../variants\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"KhronosVariantSet\");\n\ntype GlobalExtensionData = {\n  variants: VariantData[];\n};\n\ntype RootData = {\n  extensions?: {\n    KHR_materials_variants?: {\n      variants: VariantData[];\n    };\n  };\n\n  meshes?: MeshData[];\n  nodes?: NodeData[];\n};\n\ntype VariantData = {\n  name: string;\n};\n\ntype NodeData = {\n  mesh?: number;\n};\n\ntype MeshData = {\n  name: string;\n  primitives: PrimitiveData[];\n};\n\ntype PrimitiveData = {\n  extensions?: {\n    KHR_materials_variants?: {\n      mappings: Mapping[];\n    };\n  };\n};\n\ntype Mapping = {\n  material: number;\n  variants: number[];\n};\n\ntype VariantNodesMap = Record<number, VariantNode[]>;\n\nexport class KhronosVariantSetExtensionParser implements ExtensionParser {\n  private _variants: VariantData[] = [];\n  private _rootData: RootData | null = null;\n\n  public get name() {\n    return \"KHR_materials_variants\";\n  }\n\n  public getVariantSets(container: pc.ContainerResource): LevelVariantSet[] {\n    const meshes = this._rootData?.meshes;\n    const nodes = this._rootData?.nodes;\n\n    if (!meshes || !nodes) {\n      return [];\n    }\n\n    const variantNodesMap: VariantNodesMap = {};\n\n    for (let nodeIndex = 0; nodeIndex < nodes.length; nodeIndex += 1) {\n      this._parseNode(\n        nodes[nodeIndex],\n        meshes,\n        container.nodes[nodeIndex],\n        container,\n        variantNodesMap,\n      );\n    }\n\n    return [\n      {\n        name: \"\",\n        variantSets: [\n          {\n            name: \"Variants\",\n            variants: Object.keys(variantNodesMap).map(variantIndex => {\n              const numericVariantIndex = parseInt(variantIndex);\n\n              return new Variant(\n                this._variants[numericVariantIndex].name,\n                undefined,\n                numericVariantIndex === 0,\n                variantNodesMap[numericVariantIndex],\n              );\n            }),\n          },\n        ],\n      },\n    ];\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.global.add(this.name, {\n      postParse: this._globalPostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.global.remove(this.name);\n  }\n\n  public postParse() {\n    // Ignore\n  }\n\n  private _globalPostParse(\n    scene: pc.ContainerResource,\n    extensionData: GlobalExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse variant sets\", scene, extensionData, rootData);\n\n    this._variants = extensionData.variants;\n    this._rootData = rootData;\n  }\n\n  private _parseNode(\n    node: NodeData,\n    meshes: MeshData[],\n    entity: pc.Entity,\n    container: pc.ContainerResource,\n    variantNodesMap: VariantNodesMap,\n  ) {\n    if (node.mesh === undefined) {\n      return;\n    }\n\n    const mesh = meshes[node.mesh];\n\n    for (\n      let primitiveIndex = 0;\n      primitiveIndex < mesh.primitives.length;\n      primitiveIndex += 1\n    ) {\n      this._parsePrimitive(\n        primitiveIndex,\n        mesh,\n        container.models[node.mesh],\n        entity,\n        container,\n        variantNodesMap,\n      );\n    }\n  }\n\n  private _parsePrimitive(\n    primitiveIndex: number,\n    mesh: MeshData,\n    model: pc.Asset,\n    entity: pc.Entity,\n    container: pc.ContainerResource,\n    variantNodesMap: VariantNodesMap,\n  ) {\n    const primitive = mesh.primitives[primitiveIndex];\n    const mappings = primitive.extensions?.KHR_materials_variants?.mappings;\n\n    if (!mappings) {\n      return;\n    }\n\n    for (const mapping of mappings) {\n      this._parseMapping(\n        mapping,\n        primitiveIndex,\n        container.materials[mapping.material],\n        model,\n        entity,\n        variantNodesMap,\n      );\n    }\n  }\n\n  private _parseMapping(\n    mapping: Mapping,\n    primitiveIndex: number,\n    material: pc.Asset,\n    model: pc.Asset,\n    entity: pc.Entity,\n    variantNodesMap: VariantNodesMap,\n  ) {\n    for (const variantIndex of mapping.variants) {\n      variantNodesMap[variantIndex] = [\n        ...(variantNodesMap[variantIndex] ?? []),\n        {\n          node: entity,\n          properties: {\n            visible: true,\n            modelAssetID: model.id,\n            materialMapping: {\n              [primitiveIndex]: material.id,\n            },\n          },\n        },\n      ];\n    }\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { NodeLightmap } from \"../scripts\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"LightMap\");\n\ntype LightmapData = {\n  lightmapAdd: number[];\n  lightmapScale: number[];\n  coordinateScaleBias: number[];\n\n  texture: {\n    index: number;\n    texCoord?: number;\n  };\n};\n\ntype NodeExtensionData = {\n  lightmap: number;\n};\n\ntype RootData = {\n  extensions?: {\n    EPIC_lightmap_textures?: {\n      lightmaps: LightmapData[];\n    };\n  };\n};\n\ntype NodeLightmapData = LightmapData & {\n  node: pc.Entity;\n};\n\nexport class LightMapExtensionParser implements ExtensionParser {\n  private _nodeLightmapDatas: NodeLightmapData[] = [];\n  private _nodeLightmaps: NodeLightmap[] = [];\n\n  public get name() {\n    return \"EPIC_lightmap_textures\";\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.node.add(this.name, {\n      postParse: this._nodePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.node.remove(this.name);\n    NodeLightmap.clearCachedMaterialMappings();\n  }\n\n  public postParse(container: pc.ContainerResource) {\n    debug(\"Post parse lightmap\");\n\n    this._nodeLightmapDatas.forEach(data => {\n      const {\n        node,\n        lightmapScale,\n        lightmapAdd,\n        coordinateScaleBias,\n        texture: { texCoord, index },\n      } = data;\n\n      if (\n        !coordinateScaleBias ||\n        !lightmapAdd ||\n        !lightmapScale ||\n        index === undefined\n      ) {\n        debug(`Node '${node.name}' has invalid data`, data);\n        return;\n      }\n\n      const texture = container.textures[index];\n      if (!texture) {\n        debug(`Node '${node.name}' is using an invalid lightmap texture`);\n        return;\n      }\n\n      node.addComponent(\"script\").create(NodeLightmap, {\n        attributes: {\n          texture,\n          texCoord: texCoord ?? 0,\n          lightmapAdd,\n          lightmapScale,\n          coordinateScaleBias,\n        },\n      });\n\n      // TODO: cleanup of created resources when the scene or model is changed?\n    });\n  }\n\n  private _nodePostParse(\n    node: pc.Entity,\n    extensionData: NodeExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse lightmap\", node, extensionData, rootData);\n\n    const lightmap =\n      rootData.extensions?.EPIC_lightmap_textures?.lightmaps?.[\n        extensionData.lightmap\n      ];\n\n    if (!lightmap) {\n      debug(\n        `Unable to find lightmap with index ${extensionData.lightmap} for node '${node.name}'`,\n      );\n      return;\n    }\n\n    debug(\"Found lightmap\", lightmap);\n\n    this._nodeLightmapDatas.push({\n      node: node,\n      ...lightmap,\n    });\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { SkySphere as SkySphereScript } from \"../scripts\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\"SkySphere\");\n\ntype SkySphereData = {\n  name?: string;\n\n  skySphereMesh: number;\n  skyTexture: number;\n  cloudsTexture: number;\n  starsTexture: number;\n\n  directionalLight?: number;\n\n  sunHeight?: number;\n  sunBrightness?: number;\n  starsBrightness?: number;\n  cloudSpeed?: number;\n  cloudOpacity?: number;\n  horizonFalloff?: number;\n\n  sunRadius?: number;\n  noisePower1?: number;\n  noisePower2?: number;\n\n  colorsDeterminedBySunPosition?: boolean;\n\n  zenithColor?: [number, number, number, number];\n  horizonColor?: [number, number, number, number];\n  cloudColor?: [number, number, number, number];\n  overallColor?: [number, number, number, number];\n\n  zenithColorCurve?: number[][];\n  horizonColorCurve?: number[][];\n  cloudColorCurve?: number[][];\n\n  scale?: [number, number, number];\n};\n\ntype NodeExtensionData = {\n  skySphere: number;\n};\n\ntype RootData = {\n  extensions?: {\n    EPIC_sky_spheres?: {\n      skySpheres: SkySphereData[];\n    };\n  };\n};\n\ntype NodeSkySphereData = SkySphereData & {\n  node: pc.Entity;\n};\n\nexport class SkySphereExtensionParser implements ExtensionParser {\n  private _nodeSkySphereDatas: NodeSkySphereData[] = [];\n\n  public get name() {\n    return \"EPIC_sky_spheres\";\n  }\n\n  public register(registry: ExtensionRegistry) {\n    registry.node.add(this.name, {\n      postParse: this._nodePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.node.remove(this.name);\n  }\n\n  public postParse(container: pc.ContainerResource) {\n    debug(\"Post parse sky sphere\");\n\n    this._nodeSkySphereDatas.forEach(data => {\n      const node = data.node;\n      const skySphereName = `Sky sphere '${data.name ?? node.name}'`;\n\n      const skySphereModel = container.models[data.skySphereMesh];\n      if (!skySphereModel) {\n        debug(`${skySphereName} has an invalid mesh`, skySphereModel);\n        return;\n      }\n\n      const skyTexture = container.textures[data.skyTexture];\n      if (!skyTexture) {\n        debug(`${skySphereName} has an invalid sky texture`, skyTexture);\n        return;\n      }\n\n      const cloudsTexture = container.textures[data.cloudsTexture];\n      if (!cloudsTexture) {\n        debug(`${skySphereName} has an invalid clouds texture`, cloudsTexture);\n        return;\n      }\n\n      const starsTexture = container.textures[data.starsTexture];\n      if (!starsTexture) {\n        debug(`${skySphereName} has an invalid stars texture`, starsTexture);\n        return;\n      }\n\n      let directionalLight: pc.Entity | null = null;\n      if (data.directionalLight !== undefined) {\n        directionalLight = container.nodes[data.directionalLight];\n        if (!directionalLight) {\n          debug(\n            `${skySphereName} has an invalid directional light`,\n            directionalLight,\n          );\n          return;\n        }\n      }\n\n      let zenithColorCurve: pc.CurveSet | undefined;\n      if (data.zenithColorCurve) {\n        if (data.zenithColorCurve.length >= 3) {\n          zenithColorCurve = new pc.CurveSet(data.zenithColorCurve);\n        } else {\n          debug(\n            `${skySphereName} has an invalid zenithColorCurve`,\n            data.zenithColorCurve,\n          );\n          return;\n        }\n      }\n\n      let horizonColorCurve: pc.CurveSet | undefined;\n      if (data.horizonColorCurve) {\n        if (data.horizonColorCurve.length >= 3) {\n          horizonColorCurve = new pc.CurveSet(data.horizonColorCurve);\n        } else {\n          debug(\n            `${skySphereName} has an invalid horizonColorCurve`,\n            data.horizonColorCurve,\n          );\n          return;\n        }\n      }\n\n      let cloudColorCurve: pc.CurveSet | undefined;\n      if (data.cloudColorCurve) {\n        if (data.cloudColorCurve.length >= 3) {\n          cloudColorCurve = new pc.CurveSet(data.cloudColorCurve);\n        } else {\n          debug(\n            `${skySphereName} has an invalid cloudColorCurve`,\n            data.cloudColorCurve,\n          );\n          return;\n        }\n      }\n\n      node.addComponent(\"script\").create(SkySphereScript, {\n        attributes: this._stripUndefinedProperties({\n          ...data,\n          name: undefined,\n          skySphereMesh: undefined,\n          skySphereModel,\n          skyTexture,\n          cloudsTexture,\n          starsTexture,\n          directionalLight,\n          zenithColorCurve,\n          horizonColorCurve,\n          cloudColorCurve,\n        }),\n      });\n    });\n  }\n\n  private _nodePostParse(\n    node: pc.Entity,\n    extensionData: NodeExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse sky sphere\", node, extensionData, rootData);\n\n    const skySphere =\n      rootData.extensions?.EPIC_sky_spheres?.skySpheres?.[\n        extensionData.skySphere\n      ];\n    if (!skySphere) {\n      return;\n    }\n\n    debug(\"Found sky sphere\", skySphere);\n\n    this._nodeSkySphereDatas.push({\n      node,\n      ...skySphere,\n    });\n  }\n\n  private _stripUndefinedProperties<T extends {}>(obj: T): T {\n    const result = { ...obj };\n\n    Object.keys(result).forEach(<K extends keyof T>(key: K) => {\n      if (result[key] === undefined) {\n        delete result[key];\n      }\n    });\n\n    return result;\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { ExtensionParser } from \"./ExtensionParser\";\nimport { ExtensionRegistry } from \"./ExtensionRegistry\";\n\nconst debug = Debug(\" LightPunctual\");\n\ntype SharedLightData = {\n  name?: string;\n  color?: number[];\n  intensity?: number;\n};\n\ntype DirectionalLightData = SharedLightData & {\n  type: \"directional\";\n};\n\ntype PointLightData = SharedLightData & {\n  type: \"point\";\n};\n\ntype SpotLightData = SharedLightData & {\n  type: \"spot\";\n  spot: {\n    innerConeAngle?: number;\n    outerConeAngle?: number;\n  };\n};\n\ntype LightData = DirectionalLightData | PointLightData | SpotLightData;\n\ntype NodeExtensionData = {\n  light: number;\n};\n\ntype RootData = {\n  extensions?: {\n    KHR_lights_punctual?: {\n      lights: LightData[];\n    };\n  };\n};\n\ntype NodeLightDefinition = {\n  node: pc.Entity;\n  data: LightData;\n};\n\nexport class LightPunctualExtensionParser implements ExtensionParser {\n  private _nodeLights: NodeLightDefinition[] = [];\n\n  public get name() {\n    return \"KHR_lights_punctual\" as const;\n  }\n\n  public register(registry: ExtensionRegistry) {\n    console.log(\"Bind light extension handler\");\n    registry.node.add(this.name, {\n      postParse: this._nodePostParse.bind(this),\n    });\n  }\n\n  public unregister(registry: ExtensionRegistry) {\n    registry.scene.remove(this.name);\n  }\n\n  public postParse() {\n    this._nodeLights.forEach(nodeLight => {\n      const { node, data } = nodeLight;\n\n      const component = node\n        .findComponents(\"light\")\n        .find(c => c.entity.name === node.name && c.entity.parent === node); // The parser adds a child-entity that contains the component\n\n      if (component) {\n        // TODO: Correctly convert intensity to match lux (lm/m2) for directional lights,\n        // and candela (lm/sr) for point- and spot-lights.\n\n        // NOTE: For now we'll apply a \"fudge factor\" until we are able to corectly handle intensity\n        const intensityFactor = 1 / 5;\n        const intensity = (data.intensity ?? 1) * intensityFactor;\n\n        component.intensity = intensity;\n      }\n    });\n  }\n\n  private _nodePostParse(\n    node: pc.Entity,\n    extensionData: NodeExtensionData,\n    rootData: RootData,\n  ) {\n    debug(\"Parse light\", node, extensionData, rootData);\n\n    const light =\n      rootData.extensions?.[this.name]?.lights?.[extensionData.light];\n    if (!light) {\n      return;\n    }\n\n    debug(\"Found light\", light);\n\n    this._nodeLights.push({\n      node: node,\n      data: light,\n    });\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport { LevelVariantSet } from \"../variants\";\nimport {\n  ExtensionRegistry,\n  ExtensionParser,\n  BlendModeExtensionParser,\n  VariantSetExtensionParser,\n  KhronosVariantSetExtensionParser,\n  AnimationHotspotExtensionParser,\n  HdriBackdropExtensionParser,\n  LightMapExtensionParser,\n  HdriBackdrop,\n  HdrEncodingExtensionParser,\n  CameraControlExtensionParser,\n  AnimationPlaybackExtensionParser,\n  AnimationPlayback,\n  animationPlaybackDefaults,\n  SkySphereExtensionParser,\n  LightPunctualExtensionParser,\n} from \"./extensions\";\nimport { AnimationState, Animation } from \"./Animation\";\nimport { CameraEntity, convertToCameraEntity } from \"./Camera\";\nimport { AnimationHotspot } from \"./scripts\";\n\nconst debug = Debug(\"PlayCanvasGltfLoader\");\n\nexport type GltfSceneData = {\n  root: pc.Entity;\n  levelVariantSets: LevelVariantSet[];\n  hotspots: AnimationHotspot[];\n  backdrops: HdriBackdrop[];\n  animations: Animation[];\n  cameras: CameraEntity[];\n};\n\nexport type GltfData = {\n  asset: pc.Asset;\n  scenes: GltfSceneData[];\n  defaultScene: number;\n};\n\nexport class PlayCanvasGltfLoader {\n  private _extensionRegistry: ExtensionRegistry;\n\n  public constructor(private _app: pc.Application) {\n    this._extensionRegistry = new ExtensionRegistry();\n  }\n\n  private async _loadAsset(\n    url: string,\n    fileName?: string,\n  ): Promise<pc.Asset | undefined> {\n    debug(\"Load glTF asset\", url, fileName);\n\n    return new Promise<pc.Asset | undefined>((resolve, reject) => {\n      const { assets } = this._app;\n\n      const fileUrl = fileName ? url : pc.path.join(\"../..\", url);\n      const assetName = pc.path.getBasename(fileName || fileUrl);\n\n      let asset = assets.getByUrl(fileUrl);\n      if (!asset) {\n        asset = new pc.Asset(\n          assetName,\n          \"container\",\n          { url: fileUrl, filename: fileName || assetName },\n          null,\n          this._extensionRegistry.containerAssetOptions,\n        );\n        assets.add(asset);\n      }\n\n      if (asset.resource) {\n        resolve(asset);\n        return;\n      }\n\n      asset.once(\"load\", loadedAsset => resolve(loadedAsset));\n      asset.once(\"error\", err => reject(err));\n      assets.load(asset);\n    });\n  }\n\n  private _createAnimations(\n    container: pc.ContainerResource,\n    playbackByAnimationIndex: (AnimationPlayback | undefined)[],\n    hotspotAnimationIndices: number[],\n  ): Animation[] {\n    const {\n      nodes,\n      animationIndicesByNode,\n      animations: animationAssets,\n    } = container;\n\n    return animationIndicesByNode\n      .map<Animation[]>((animationIndices, nodeIndex) => {\n        if (animationIndices.length === 0) {\n          return [];\n        }\n\n        const node = nodes[nodeIndex];\n        const component = node.addComponent(\"anim\") as pc.AnimComponent;\n\n        // Create one layer per animation asset so that the animations can be played simultaneously\n        component.loadStateGraph({\n          layers: animationIndices.map(index => {\n            const speed =\n              playbackByAnimationIndex[index]?.playRate ??\n              animationPlaybackDefaults.playRate;\n            return {\n              name: (animationAssets[index].resource as pc.AnimTrack).name,\n              states: [\n                { name: pc.ANIM_STATE_START },\n                { name: AnimationState.Loop, speed, loop: true },\n                { name: AnimationState.LoopReverse, speed: -speed, loop: true },\n                { name: AnimationState.Once, speed, loop: false },\n                {\n                  name: AnimationState.OnceReverse,\n                  speed: -speed,\n                  loop: false,\n                },\n              ],\n              transitions: [],\n            };\n          }),\n          parameters: {},\n        });\n\n        // Create one Animation instance per layer\n        return animationIndices\n          .map(index => {\n            const track = animationAssets[index].resource as pc.AnimTrack;\n            return {\n              track,\n              index,\n              layer: component.findAnimationLayer(track.name),\n            };\n          })\n          .filter(({ layer }) => !!layer)\n          .map<Animation>(({ track, index, layer: layerOrNull }) => {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            const layer = layerOrNull!;\n\n            // Assign animation tracks to all states of each layer\n            layer.states\n              .slice(1, layer.states.length)\n              .forEach(state => layer.assignAnimation(state, track));\n\n            if (hotspotAnimationIndices.includes(index)) {\n              return new Animation(node, layer, index);\n            }\n\n            const playback = playbackByAnimationIndex[index];\n\n            const defaultState =\n              (playback?.loop ?? animationPlaybackDefaults.loop) === false\n                ? AnimationState.Once\n                : AnimationState.Loop;\n\n            const autoPlay =\n              (playback?.autoPlay ?? animationPlaybackDefaults.autoPlay) ===\n              false\n                ? false\n                : true;\n\n            const startTime =\n              playback?.startTime ?? animationPlaybackDefaults.startTime;\n\n            return new Animation(\n              node,\n              layer,\n              index,\n              defaultState,\n              autoPlay,\n              startTime,\n            );\n          });\n      })\n      .reduce<Animation[]>((acc, anims) => [...acc, ...anims], []);\n  }\n\n  private _clearExtensions() {\n    this._extensionRegistry.removeAll();\n  }\n\n  private _registerExtensions(extensions: ExtensionParser[]) {\n    extensions.forEach(e => e.register(this._extensionRegistry));\n  }\n\n  private _unregisterExtensions(extensions: ExtensionParser[]) {\n    extensions.forEach(e => e.unregister(this._extensionRegistry));\n  }\n\n  private _postParseExtensions(\n    extensions: ExtensionParser[],\n    container: pc.ContainerResource,\n  ) {\n    extensions.forEach(e => e.postParse(container));\n  }\n\n  private _addModelMaterialMappings(container: pc.ContainerResource) {\n    const materials = container.materials;\n\n    // Add missing material mappings to all model assets.\n    // We need them to support restoring default materials for a model via variants.\n    this._app.assets\n      .filter(\n        asset =>\n          asset.type === \"model\" && !!asset.resource && !asset.data?.mapping,\n      )\n      .forEach(model => {\n        model.data = model.data ?? {};\n        model.data.mapping = model.resource.meshInstances.map(\n          (meshInstance: pc.MeshInstance) => ({\n            material: materials.find(\n              material => material.resource === meshInstance.material,\n            )?.id,\n          }),\n        );\n      });\n  }\n\n  public async load(url: string, fileName?: string): Promise<GltfData> {\n    debug(\"Load glTF asset\", url, fileName);\n\n    const variantSetParser = new VariantSetExtensionParser();\n    const khronosVariantSetParser = new KhronosVariantSetExtensionParser();\n    const hotspotParser = new AnimationHotspotExtensionParser();\n    const lightMapParser = new LightMapExtensionParser();\n    const backdropParser = new HdriBackdropExtensionParser();\n    const animationPlaybackParser = new AnimationPlaybackExtensionParser();\n\n    const extensions: ExtensionParser[] = [\n      variantSetParser,\n      khronosVariantSetParser,\n      hotspotParser,\n      lightMapParser,\n      backdropParser,\n      animationPlaybackParser,\n      new CameraControlExtensionParser(),\n      new HdrEncodingExtensionParser(),\n      new SkySphereExtensionParser(),\n      new BlendModeExtensionParser(),\n      new LightPunctualExtensionParser(),\n    ];\n\n    this._clearExtensions();\n    this._registerExtensions(extensions);\n\n    try {\n      const asset = await this._loadAsset(url, fileName);\n      if (!asset) {\n        throw new Error(\"Asset not found\");\n      }\n\n      const container = asset.resource as pc.ContainerResource | undefined;\n      if (!container) {\n        throw new Error(\"Asset is empty\");\n      }\n\n      debug(\"Loaded glTF container\", container);\n\n      const defaultScene = container.scene;\n      if (!defaultScene) {\n        throw new Error(\"Asset has no default scene\");\n      }\n\n      this._postParseExtensions(extensions, container);\n      this._unregisterExtensions(extensions);\n\n      const playbackByAnimationIndex = animationPlaybackParser.getPlaybackByAnimationIndex(\n        container,\n      );\n      const { hotspotAnimationIndices } = hotspotParser;\n      const animations = this._createAnimations(\n        container,\n        playbackByAnimationIndex,\n        hotspotAnimationIndices,\n      );\n      debug(\"Created animations\", animations);\n\n      const cameraEntities = container.cameras.map(component =>\n        convertToCameraEntity(component.entity),\n      );\n      debug(\"Created camera entities\", cameraEntities);\n\n      this._addModelMaterialMappings(container);\n      debug(\"Added model material mappings\");\n\n      return {\n        asset,\n        scenes: container.scenes.map<GltfSceneData>(sceneRoot => {\n          const sceneAnimations = animations.filter(animation =>\n            sceneRoot.findOne(node => node === animation.node),\n          );\n          return {\n            root: sceneRoot,\n            levelVariantSets: [\n              ...variantSetParser.getVariantSetsForScene(sceneRoot, container),\n              ...khronosVariantSetParser.getVariantSets(container),\n            ],\n            hotspots: hotspotParser.getHotspotsForScene(\n              sceneRoot,\n              sceneAnimations,\n              container,\n            ),\n            backdrops: backdropParser.getBackdropsForScene(\n              sceneRoot,\n              container,\n            ),\n            animations: sceneAnimations.filter(\n              animation =>\n                hotspotAnimationIndices.indexOf(animation.index) === -1,\n            ),\n            cameras: cameraEntities.filter(cameraEntity =>\n              sceneRoot.findOne(node => node === cameraEntity),\n            ),\n          };\n        }),\n        defaultScene: container.scenes.indexOf(defaultScene),\n      };\n    } catch (e) {\n      this._unregisterExtensions(extensions);\n      throw e;\n    }\n  }\n\n  public unload(data: GltfData) {\n    debug(\"Unload glTF asset\", data);\n\n    this._app.assets.remove(data.asset);\n    data.asset.unload();\n  }\n}\n","import * as pc from \"@animech-public/playcanvas\";\nimport Debug from \"debug\";\nimport debounce from \"lodash.debounce\";\nimport ResizeObserver from \"resize-observer-polyfill\";\nimport { GltfScene } from \"../types\";\nimport { VariantSetManager, LevelVariantSet } from \"../variants\";\nimport {\n  OrbitCamera,\n  orbitCameraScriptName,\n  HdriBackdrop as HdriBackdropScript,\n  hdriBackdropScriptName,\n  NodeLightmap,\n  nodeLightmapScriptName,\n  animationHotspotScriptName,\n  AnimationHotspot,\n  SkySphere,\n  skySphereScriptName,\n} from \"./scripts\";\nimport {\n  PlayCanvasGltfLoader,\n  GltfData,\n  GltfSceneData,\n} from \"./PlayCanvasGltfLoader\";\nimport { HdriBackdrop } from \"./extensions\";\nimport {\n  CameraEntity,\n  OrbitCameraEntity,\n  isOrbitCameraEntity,\n  convertToCameraEntity,\n} from \"./Camera\";\n\nconst debug = Debug(\"PlayCanvasViewer\");\n\nconst waitForAnimationFrame = () =>\n  new Promise<void>(resolve => {\n    requestAnimationFrame(() => resolve());\n  });\n\nexport type CameraPreviewSize = {\n  width: number;\n  height: number;\n};\n\nexport class PlayCanvasViewer implements TestableViewer {\n  private _app: pc.Application;\n  private _activeCamera?: CameraEntity;\n  private _defaultCamera: OrbitCameraEntity;\n  private _loader: PlayCanvasGltfLoader;\n  private _gltf?: GltfData;\n  private _activeGltfScene?: GltfSceneData;\n  private _variantSetManager?: VariantSetManager;\n  private _hotspots?: AnimationHotspot[];\n  private _backdrops?: HdriBackdrop[];\n  private _cameraPreviews?: string[];\n  private _debouncedCanvasResize = debounce(\n    () => this._resizeCanvas(this._activeCamera),\n    10,\n  );\n  private _canvasResizeObserver = new ResizeObserver(\n    this._debouncedCanvasResize,\n  );\n  private _canvasSizeElem?: HTMLElement;\n  private _initiated = false;\n  private _gltfLoaded = false;\n  private _noAnimations: boolean;\n\n  public constructor(\n    public canvas: HTMLCanvasElement,\n    private _cameraPreviewSize: CameraPreviewSize,\n  ) {\n    this._resizeCanvas = this._resizeCanvas.bind(this);\n\n    const urlParams = new URLSearchParams(window.location.search);\n    this._noAnimations = !!urlParams.get(\"noAnimations\");\n\n    this._app = this._createApp();\n\n    pc.registerScript(OrbitCamera, orbitCameraScriptName);\n    pc.registerScript(AnimationHotspot, animationHotspotScriptName);\n    pc.registerScript(HdriBackdropScript, hdriBackdropScriptName);\n    pc.registerScript(NodeLightmap, nodeLightmapScriptName);\n    pc.registerScript(SkySphere, skySphereScriptName);\n\n    this._defaultCamera = this._createDefaultCamera(this._app);\n    this._activeCamera = this._defaultCamera;\n\n    this._loader = new PlayCanvasGltfLoader(this._app);\n\n    this._canvasSizeElem =\n      this.canvas.parentElement?.parentElement ?? undefined;\n    if (this._canvasSizeElem) {\n      this._canvasResizeObserver.observe(this._canvasSizeElem);\n    }\n\n    // For debugging purposes\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (window as any).getStats = this._getStats.bind(this);\n  }\n\n  public get app() {\n    return this._app;\n  }\n\n  public get initiated() {\n    return !!this._app.graphicsDevice && this._initiated;\n  }\n\n  public get gltfLoaded() {\n    return this._gltfLoaded;\n  }\n\n  public get activeSceneHierarchy(): GltfScene | undefined {\n    const scene = this._activeGltfScene;\n    if (!scene) {\n      return undefined;\n    }\n    return {\n      variantSetManager: this._variantSetManager,\n      cameras: scene.cameras.map((camera, index) => {\n        return {\n          id: index,\n          name: camera.name,\n          type: isOrbitCameraEntity(camera)\n            ? camera.script[orbitCameraScriptName].modeName\n            : \"Static\",\n          previewSource: this._cameraPreviews?.[index] ?? \"\",\n        };\n      }),\n      hasBackdrops: scene.backdrops.length > 0,\n    };\n  }\n\n  private _resizeCanvas(camera?: CameraEntity) {\n    const app = this._app;\n    const sizeElem = this._canvasSizeElem;\n\n    if (!sizeElem) {\n      app.resizeCanvas();\n      return;\n    }\n\n    const { clientWidth, clientHeight } = sizeElem;\n    const cameraComponent = camera?.camera;\n    const aspectRatioMode = cameraComponent?.aspectRatioMode;\n    const aspectRatio = cameraComponent?.aspectRatio;\n\n    if (aspectRatioMode === pc.ASPECT_MANUAL && aspectRatio !== undefined) {\n      const sizeElemAspectRatio = clientWidth / clientHeight;\n      app.resizeCanvas(\n        aspectRatio > sizeElemAspectRatio\n          ? clientWidth\n          : clientHeight * aspectRatio,\n        aspectRatio > sizeElemAspectRatio\n          ? clientWidth / aspectRatio\n          : clientHeight,\n      );\n    } else {\n      app.resizeCanvas(clientWidth, clientHeight);\n    }\n  }\n\n  private _createApp() {\n    const existingApp = pc.Application.getApplication();\n    if (existingApp) {\n      debug(\"Destroying existing app\");\n      existingApp.destroy();\n    }\n\n    debug(\"Creating app for target\", this.canvas);\n    const app = new pc.Application(this.canvas, {\n      assetPrefix: \"viewer/playcanvas/\",\n      mouse: new pc.Mouse(document.body),\n      keyboard: new pc.Keyboard(window),\n      graphicsDeviceOptions: {\n        preserveDrawingBuffer: false,\n        antialias: true,\n        alpha: true,\n        preferWebGl2: true,\n        use3dPhysics: false,\n      },\n    });\n\n    debug(\"Starting app\");\n    app.start();\n\n    return app;\n  }\n\n  private _getStats() {\n    const app = this._app;\n    const stats = app.stats;\n    const bToKb = 1 / 1024;\n    const ib = Math.round(stats.vram.ib * bToKb * 10) / 10;\n    const tex = Math.round(stats.vram.tex * bToKb * 10) / 10;\n    const vb = Math.round(stats.vram.vb * bToKb * 10) / 10;\n    return `VRAM: Triangles ${ib} KB, Textures ${tex} KB, Vertices ${vb} KB`;\n  }\n\n  private _createDefaultCamera(app: pc.Application): OrbitCameraEntity {\n    debug(\"Creating default camera\");\n\n    const camera = convertToCameraEntity(new pc.Entity(\"Default\"));\n\n    const script = camera.script.create(OrbitCamera, {\n      enabled: false, // This is enabled later for the active camera\n    });\n    script.nearClipFactor = 0.002;\n    script.farClipFactor = 100;\n    script.allowPan = true;\n\n    app.root.addChild(camera);\n\n    return camera as OrbitCameraEntity;\n  }\n\n  private async _setSceneHierarchy(gltfScene: GltfSceneData) {\n    debug(\"Set scene hierarchy\", gltfScene);\n\n    if (this._activeGltfScene) {\n      this._app.root.removeChild(this._activeGltfScene.root);\n    }\n\n    this._activeGltfScene = gltfScene;\n    this._app.root.addChild(gltfScene.root);\n\n    // List orbit cameras first\n    gltfScene.cameras.sort((a, b) => {\n      const aIsOrbit = isOrbitCameraEntity(a);\n      const bIsOrbit = isOrbitCameraEntity(b);\n      return aIsOrbit === bIsOrbit ? 0 : aIsOrbit ? -1 : 1;\n    });\n\n    // Add default camera to start of camera list if no other orbit\n    // cameras exist in glTF scene\n    if (!gltfScene.cameras.some(isOrbitCameraEntity)) {\n      gltfScene.cameras.unshift(this._defaultCamera);\n    }\n\n    if (gltfScene.hotspots.length > 0) {\n      this._initHotspots(gltfScene.hotspots);\n    }\n\n    if (gltfScene.levelVariantSets.length > 0) {\n      this._initVariantSets(gltfScene.levelVariantSets);\n    }\n\n    if (gltfScene.backdrops.length > 0) {\n      this._initBackdrops(gltfScene.backdrops);\n    }\n  }\n\n  private async _initCameraPreviews(\n    cameras: CameraEntity[],\n    width: number,\n    height: number,\n  ) {\n    debug(\"Init camera previews\", cameras, width, height);\n\n    // Set canvas size by resizing the canvas wrapper element, which\n    // will trigger this._resizeCanvas(). Hide canvas to prevent flicker\n    // when changing cameras.\n    const sizeElem = this._canvasSizeElem;\n    if (sizeElem) {\n      sizeElem.style.width = `${width}px`;\n      sizeElem.style.height = `${height}px`;\n      sizeElem.style.visibility = \"hidden\";\n    }\n\n    const previews: string[] = [];\n\n    for (const camera of cameras) {\n      const { camera: cameraComponent } = camera;\n      const orbitCamera = isOrbitCameraEntity(camera)\n        ? camera.script[orbitCameraScriptName]\n        : null;\n      const { enabled: prevEnabled } = cameraComponent;\n\n      // Enable the camera and script\n      cameraComponent.enabled = true;\n      if (orbitCamera) {\n        orbitCamera.enabled = true;\n      }\n\n      // Resize canvas to get correct aspect ratio given\n      // the current camera\n      this._resizeCanvas(camera);\n\n      // Wait for frame to render and save screenshot\n      await waitForAnimationFrame();\n      previews.push(this.canvas.toDataURL());\n\n      // Reset camera to previous state\n      if (orbitCamera) {\n        orbitCamera.enabled = prevEnabled;\n      }\n      cameraComponent.enabled = prevEnabled;\n    }\n\n    this._cameraPreviews = previews;\n\n    // Reset canvas size and visibility\n    if (sizeElem) {\n      sizeElem.style.width = \"\";\n      sizeElem.style.height = \"\";\n      sizeElem.style.visibility = \"visible\";\n    }\n  }\n\n  private _destroyCameraPreviews() {\n    debug(\"Destroy camera previews\", this._cameraPreviews);\n    this._cameraPreviews = undefined;\n  }\n\n  private _initHotspots(hotspots: AnimationHotspot[]) {\n    this._destroyHotspots();\n\n    debug(\"Init hotspots\", hotspots);\n\n    this._hotspots = hotspots;\n    this._hotspots.forEach(hotspot => (hotspot.enabled = true));\n  }\n\n  private _destroyHotspots() {\n    if (!this._hotspots) {\n      return;\n    }\n\n    debug(\"Destroy hotspots\", this._hotspots);\n\n    this._hotspots.forEach(hotspot => (hotspot.enabled = false));\n    this._hotspots = undefined;\n  }\n\n  private _initVariantSets(sets: LevelVariantSet[]) {\n    this._destroyVariantSets();\n\n    debug(\"Init variant sets\", sets);\n\n    this._variantSetManager = new VariantSetManager(sets);\n  }\n\n  private _destroyVariantSets() {\n    if (!this._variantSetManager) {\n      return;\n    }\n\n    debug(\"Destroy variant sets\", this._variantSetManager);\n\n    this._variantSetManager = undefined;\n  }\n\n  private _initBackdrops(backdrops: HdriBackdrop[]) {\n    debug(\"Init backdrops\", backdrops);\n\n    this._destroyBackdrops();\n\n    const app = this._app;\n    const originalSkyboxAsset = app.assets.get(app._skyboxLast ?? 0);\n    const originalSkyboxIntensity = app.scene.skyboxIntensity;\n\n    const onBackdropEnabled = (backdrop: HdriBackdrop) => {\n      // TODO: Add support for using reflection probes instead of skyboxes\n      app.scene.setSkybox([null, ...backdrop.skyboxCubemaps]);\n      app.scene.skyboxIntensity = backdrop.skyboxIntensity;\n    };\n\n    const onBackdropDisabled = (_backdrop: HdriBackdrop) => {\n      app.setSkybox(originalSkyboxAsset);\n      app.scene.skyboxIntensity = originalSkyboxIntensity;\n    };\n\n    backdrops.forEach(backdrop => {\n      backdrop.script.on(\"enable\", () => onBackdropEnabled(backdrop));\n      backdrop.script.on(\"disable\", () => onBackdropDisabled(backdrop));\n      backdrop.script.enabled = true;\n    });\n\n    this._backdrops = backdrops;\n  }\n\n  private _destroyBackdrops() {\n    debug(\"Destroy backdrops\", this._backdrops);\n\n    if (this._backdrops) {\n      this._backdrops.forEach(backdrop => {\n        // Destroy manually created resources\n        backdrop.cubemap.destroy();\n        backdrop.skyboxCubemaps.forEach(cubemap => cubemap.destroy());\n      });\n\n      this._backdrops = undefined;\n    }\n  }\n\n  private _focusOrbitCamera(orbitCamera: OrbitCamera) {\n    const focusEntity = orbitCamera.focusEntity ?? this._app.root;\n    debug(\"Focus camera on entity\", focusEntity);\n    orbitCamera.reset(0, 0, 0);\n    orbitCamera.focus(focusEntity, {\n      frameModels: true,\n    });\n  }\n\n  public destroy() {\n    this.destroyGltf();\n    if (this._canvasSizeElem) {\n      this._canvasResizeObserver.unobserve(this._canvasSizeElem);\n    }\n    this._app.destroy();\n  }\n\n  public async configure() {\n    debug(\"Configuring app\");\n\n    const app = this._app;\n\n    await new Promise<void>((resolve, reject) => {\n      const url = pc.path.join(app.assets.prefix, \"config.json\");\n\n      app.configure(url, error => {\n        if (error) {\n          reject(error);\n          return;\n        }\n        app.preload(() => {\n          // Override fill mode from config\n          app.setCanvasFillMode(pc.FILLMODE_NONE);\n\n          resolve();\n        });\n      });\n    });\n\n    const scene = this._app.scenes.list()[0];\n    if (scene) {\n      const sceneUrl = scene.url;\n      debug(\"Loading scene\", sceneUrl);\n\n      await new Promise<void>((resolve, reject) => {\n        this._app.scenes.loadScene(sceneUrl, error => {\n          if (error) {\n            reject(error);\n            return;\n          }\n          resolve();\n        });\n      });\n    }\n\n    this._initiated = true;\n  }\n\n  public destroyGltf() {\n    debug(\"Destroy glTF\", this._gltf);\n\n    this._gltfLoaded = false;\n\n    if (this._activeGltfScene) {\n      this._app.root.removeChild(this._activeGltfScene.root);\n      this._activeGltfScene = undefined;\n      this._destroyVariantSets();\n      this._destroyBackdrops();\n      this._destroyCameraPreviews();\n      this._destroyHotspots();\n    }\n\n    if (this._gltf) {\n      this._loader.unload(this._gltf);\n      this._gltf = undefined;\n    }\n  }\n\n  /**\n   * Initialize animations. Auto played animations will start playing\n   * and non-auto played animations will be set to their start frame,\n   * if defined.\n   *\n   * This has to be run after the scene has loaded and rendered for the\n   * animations to play.\n   */\n  public initAnimations() {\n    debug(\"Init animations\", this._activeGltfScene?.animations);\n\n    const gltfScene = this._activeGltfScene;\n    if (!gltfScene || this._noAnimations) {\n      return;\n    }\n\n    // Ensure first frame has rendered\n    requestAnimationFrame(() =>\n      gltfScene.animations.forEach(animation => animation.init()),\n    );\n  }\n\n  public async initCameraPreviews() {\n    const cameras = this._activeGltfScene?.cameras ?? [];\n\n    // Cameras are only shown in UI if there are more than one\n    if (cameras.length > 1) {\n      const { width, height } = this._cameraPreviewSize;\n      await this._initCameraPreviews(cameras, width * 2, height * 2);\n    }\n  }\n\n  public setActiveAnimations(animationIds: number[]) {\n    debug(\"Set active animations\", animationIds);\n\n    if (!this._activeGltfScene) {\n      return;\n    }\n\n    this._activeGltfScene.animations.forEach((animation, animationIndex) => {\n      const active = animationIds.includes(animationIndex);\n      if (active && animation.playable && animation.defaultState) {\n        animation.play(animation.defaultState);\n      } else {\n        animation.pause();\n      }\n    });\n  }\n\n  public setActiveCamera(cameraId: number) {\n    debug(\"Set active camera\", cameraId);\n\n    if (!this._activeGltfScene) {\n      return;\n    }\n\n    this._activeGltfScene.cameras.forEach((camera, cameraIndex) => {\n      const enabled = cameraIndex === cameraId;\n      camera.camera.enabled = enabled;\n      if (isOrbitCameraEntity(camera)) {\n        camera.script[orbitCameraScriptName].enabled = enabled;\n      }\n    });\n\n    this._activeCamera = this._activeGltfScene.cameras.find(\n      camera => camera.camera.enabled,\n    );\n\n    // Focus the camera, but only if it's the default (orbit-)camera\n    if (this._activeCamera === this._defaultCamera) {\n      this._focusOrbitCamera(this._defaultCamera.script[orbitCameraScriptName]);\n    }\n\n    // Resize since new camera aspect ratio might affect canvas size\n    this._resizeCanvas(this._activeCamera);\n  }\n\n  public resetCamera(yaw?: number, pitch?: number, distance?: number) {\n    if (\n      this._app.root &&\n      this._activeCamera &&\n      isOrbitCameraEntity(this._activeCamera)\n    ) {\n      this._activeCamera.script[orbitCameraScriptName].reset(\n        yaw,\n        pitch,\n        distance,\n      );\n    }\n  }\n\n  public async loadGltf(url: string, fileName?: string) {\n    this.destroyGltf();\n\n    debug(\"Load glTF\", url, fileName);\n\n    try {\n      this._gltf = await this._loader.load(url, fileName);\n      debug(\"Loaded glTF\", this._gltf);\n      await this._setSceneHierarchy(this._gltf.scenes[this._gltf.defaultScene]);\n      this._gltfLoaded = true;\n    } catch (e) {\n      this._gltfLoaded = true;\n      throw e;\n    }\n  }\n}\n","import React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport { observer } from \"mobx-react-lite\";\nimport Debug from \"debug\";\nimport {\n  Backdrop,\n  CircularProgress,\n  makeStyles,\n  useTheme,\n  Card,\n} from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport { PlayCanvasViewer } from \"../playcanvas\";\nimport { useStores } from \"../stores\";\nimport {\n  useAsyncWithLoadingAndErrorHandling,\n  usePreventableCameraInteractions,\n  useGltfDrop,\n} from \"../hooks\";\nimport { MessageBox } from \"../components\";\n\nconst debug = Debug(\"Viewer\");\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    // Extra height and width adjusts for rounding issue when\n    // centering canvas vertically and horizontally\n    height: \"calc(100% + 4px)\",\n    width: \"calc(100% + 4px)\",\n    outline: 0,\n  },\n  canvasWrapper: {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translateY(-50%) translateX(-50%)\",\n  },\n  canvas: {\n    outline: 0,\n  },\n  backdrop: {\n    position: \"absolute\",\n    zIndex: 3,\n    color: theme.palette.common.white,\n    backgroundColor: \"rgba(0, 0, 0, 0.9)\",\n    transition:\n      theme.transitions.create([\"opacity\", \"background-color\"], {\n        duration: theme.transitions.duration.shortest,\n      }) + \" !important\",\n  },\n  backdropTransparent: {\n    backgroundColor: \"rgba(0, 0, 0, 0.2)\",\n  },\n  backdropBorder: {\n    border: `3px solid ${theme.palette.primary.main}`,\n  },\n  messageBox: {\n    maxWidth: 320,\n  },\n}));\n\nexport type ViewerProps = {\n  isLoading?: boolean;\n  isError?: boolean;\n  isEmpty?: boolean;\n};\n\nexport const Viewer: React.FC<ViewerProps> = observer(\n  ({\n    isError = false,\n    isEmpty = false,\n    isLoading: globalIsLoading = false,\n  }) => {\n    const classes = useStyles();\n    const theme = useTheme();\n    const { gltfStore, settingsStore } = useStores();\n    const { gltf, setGltf, setSceneHierarchy, camera } = gltfStore;\n    const { enableDragAndDrop, showUI } = settingsStore;\n\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const [viewer, setViewer] = useState<PlayCanvasViewer>();\n\n    const onDropGltf = useCallback(setGltf, [setGltf]);\n    const [\n      isDragActive,\n      hasDropError,\n      setHasDropError,\n      getRootProps,\n    ] = useGltfDrop(onDropGltf, enableDragAndDrop);\n\n    const [\n      localIsLoading,\n      hasLoadError,\n      runAsync,\n    ] = useAsyncWithLoadingAndErrorHandling();\n\n    const isLoading = globalIsLoading || localIsLoading;\n    const hasError = hasLoadError || hasDropError || isError;\n    const showBackdrop =\n      showUI && (isLoading || isDragActive || hasError || isEmpty);\n\n    const [setPreventInteraction] = usePreventableCameraInteractions(\n      showBackdrop,\n    );\n\n    // PlayCanvasViewer: Instantiate and configure\n    useEffect(() => {\n      if (!canvasRef.current) {\n        return;\n      }\n\n      debug(\"Create viewer\");\n      const viewer = new PlayCanvasViewer(canvasRef.current, {\n        width: theme.cameraPreviewWidth,\n        height: theme.cameraPreviewHeight,\n      });\n\n      runAsync(async () => {\n        debug(\"Configure viewer start\");\n        await viewer.configure();\n        setViewer(viewer);\n        window.viewer = viewer;\n        debug(\"Configure viewer end\");\n      });\n\n      return () => {\n        debug(\"Destroy viewer\");\n        window.viewer = undefined;\n        viewer.destroy();\n      };\n    }, [runAsync, theme.cameraPreviewHeight, theme.cameraPreviewWidth]);\n\n    // PlayCanvasViewer: Load glTF\n    // GltfStore: Update scene hierarchy list\n    useEffect(() => {\n      if (!viewer?.initiated || !gltf) {\n        return;\n      }\n\n      runAsync(async () => {\n        debug(\"Load glTF start\", gltf.filePath);\n        setSceneHierarchy();\n        await viewer.loadGltf(gltf.filePath, gltf.blobFileName);\n        viewer.initAnimations();\n        viewer.setActiveCamera(0);\n        await viewer.initCameraPreviews();\n        debug(\"Load glTF end\", gltf.filePath);\n\n        if (viewer.activeSceneHierarchy) {\n          debug(\"Set scene hierachy\", viewer.activeSceneHierarchy);\n          setSceneHierarchy(viewer.activeSceneHierarchy);\n        }\n      });\n\n      return () => {\n        debug(\"Destroy glTF\");\n        viewer.destroyGltf();\n\n        debug(\"Unset scene hierachy\");\n        setSceneHierarchy();\n      };\n    }, [runAsync, viewer, gltf, setSceneHierarchy]);\n\n    // PlayCanvasViewer: Set active camera\n    useEffect(() => {\n      if (!viewer?.initiated || !camera) {\n        return;\n      }\n      debug(\"Set active camera\", camera);\n      viewer.setActiveCamera(camera.id);\n    }, [viewer, camera]);\n\n    // Reset error state\n    useEffect(() => {\n      debug(\"Reset drop error state\");\n      setHasDropError(false);\n    }, [gltf, setHasDropError, viewer]);\n\n    // Prevent camera interactions\n    useEffect(() => {\n      debug(\"Prevent camera interaction\", showBackdrop);\n      setPreventInteraction(showBackdrop);\n    }, [showBackdrop, setPreventInteraction]);\n\n    return (\n      <div className={classes.root} {...getRootProps()}>\n        <div className={classes.canvasWrapper}>\n          <canvas className={classes.canvas} ref={canvasRef} />\n        </div>\n        <Backdrop\n          className={clsx(classes.backdrop, {\n            [classes.backdropTransparent]: !isLoading,\n            [classes.backdropBorder]: isDragActive,\n          })}\n          open={showBackdrop}\n        >\n          {isLoading ? (\n            <CircularProgress />\n          ) : hasError ? (\n            <Card className={classes.messageBox}>\n              <MessageBox\n                icon=\"error\"\n                overline=\"Oops!\"\n                title=\"Unexpected issue\"\n              >\n                We tried our best but something went wrong when loading{\" \"}\n                {isError ? \"assets\" : \"the asset\"}. Check console for more\n                details.\n              </MessageBox>\n            </Card>\n          ) : isEmpty || isDragActive ? (\n            <Card className={classes.messageBox}>\n              <MessageBox icon=\"dragdrop\" title=\"Drop glTF file here\">\n                Drop a .gltf or .glb file with accompanying assets to view them.\n              </MessageBox>\n            </Card>\n          ) : null}\n        </Backdrop>\n      </div>\n    );\n  },\n);\n","import { useCallback, useState, useEffect } from \"react\";\nimport { PreventableEvent } from \"../playcanvas\";\n\nexport const usePreventableCameraInteractions = (\n  initialPrevent = false,\n): [(prevent: boolean) => void] => {\n  const [preventInteraction, setPreventInteraction] = useState(initialPrevent);\n\n  const handler = useCallback((e: Event) => {\n    (e as PreventableEvent<Event>).prevent = true;\n  }, []);\n\n  useEffect(() => {\n    function attachHandlers() {\n      document.body.addEventListener(\"keydown\", handler);\n      document.body.addEventListener(\"wheel\", handler);\n      document.body.addEventListener(\"mousedown\", handler);\n    }\n\n    function detachHandlers() {\n      document.body.removeEventListener(\"keydown\", handler);\n      document.body.removeEventListener(\"wheel\", handler);\n      document.body.removeEventListener(\"mousedown\", handler);\n    }\n\n    if (preventInteraction) {\n      attachHandlers();\n    } else {\n      detachHandlers();\n    }\n\n    return detachHandlers;\n  }, [handler, preventInteraction]);\n\n  return [setPreventInteraction];\n};\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { useTheme } from \"@material-ui/core\";\nimport { observer } from \"mobx-react-lite\";\nimport {\n  GltfContent,\n  SidebarContainer,\n  NavList,\n  NavListItem,\n  MessageBox,\n  Appear,\n} from \"../components\";\nimport { useStores } from \"../stores\";\nimport { LevelVariantSetWithIndices } from \"../variants\";\nimport { LevelVariantSet } from \"../components/LevelVariantSet\";\n\nconst useStyles = makeStyles(theme => ({\n  content: {\n    padding: theme.spacing(2, 3),\n  },\n}));\n\ntype View = \"gltf-list\" | \"gltf-content\" | \"variant-set\" | \"none\";\n\nexport type GltfProps = {\n  isError?: boolean;\n};\n\nexport const Gltf: React.FC<GltfProps> = observer(({ isError }) => {\n  const classes = useStyles();\n  const theme = useTheme();\n  const { gltfStore } = useStores();\n  const {\n    gltfs,\n    gltf: selectedGltf,\n    levelVariantSetId: selectedLevelVariantSetId,\n    variantSetManager,\n    sceneHierarchy,\n    showLevelVariantSet,\n    setGltf,\n  } = gltfStore;\n  const [view, setView] = useState<View>(\"gltf-list\");\n  const previousViewRef = useRef<View | undefined>();\n  const [levelVariantSets, setLevelVariantSets] = useState<\n    LevelVariantSetWithIndices[]\n  >([]);\n\n  const levelVariantSet =\n    selectedLevelVariantSetId !== undefined\n      ? levelVariantSets[selectedLevelVariantSetId]\n      : undefined;\n\n  let appearDirection: \"left\" | \"right\" = \"left\";\n\n  useEffect(() => {\n    if (variantSetManager) {\n      setLevelVariantSets(variantSetManager.levelVariantSets);\n    }\n\n    return () => {\n      setLevelVariantSets([]);\n    };\n  }, [variantSetManager]);\n\n  useEffect(() => {\n    previousViewRef.current = view;\n  });\n\n  useEffect(() => {\n    setView(\n      selectedGltf\n        ? levelVariantSet\n          ? \"variant-set\"\n          : \"gltf-content\"\n        : gltfs.length === 0\n        ? \"none\"\n        : \"gltf-list\",\n    );\n  }, [selectedGltf, levelVariantSet, gltfs]);\n\n  if (isError) {\n    return <SidebarContainer></SidebarContainer>;\n  }\n\n  switch (view) {\n    case \"none\":\n      return (\n        <SidebarContainer>\n          <div className={classes.content}>\n            <Appear duration={theme.transitions.duration.standard}>\n              <MessageBox icon=\"empty\" overline=\"Empty\" title=\"No options\">\n                This scene does not contain any configurable objects.\n              </MessageBox>\n            </Appear>\n          </div>\n        </SidebarContainer>\n      );\n    case \"gltf-list\":\n      appearDirection =\n        previousViewRef.current === \"gltf-content\" ? \"right\" : \"left\";\n      return (\n        <SidebarContainer\n          title=\"Select scene\"\n          appearDirection={appearDirection}\n        >\n          <div className={classes.content} data-testid=\"gltf-list\">\n            <NavList>\n              {gltfs.map((gltf, index) => (\n                <NavListItem\n                  key={gltf.filePath}\n                  onClick={() => {\n                    setGltf(gltf);\n                    setView(\"gltf-content\");\n                  }}\n                  selected={\n                    selectedGltf && gltf.filePath === selectedGltf.filePath\n                  }\n                  appear={\n                    <Appear\n                      direction={appearDirection}\n                      delay={\n                        appearDirection === \"left\"\n                          ? index * theme.listAnimationDelay\n                          : (gltfs.length - 1 - index) *\n                            theme.listAnimationDelay\n                      }\n                    />\n                  }\n                >\n                  {gltf.name}\n                </NavListItem>\n              ))}\n            </NavList>\n          </div>\n        </SidebarContainer>\n      );\n    case \"gltf-content\":\n      appearDirection =\n        previousViewRef.current === \"variant-set\" ? \"right\" : \"left\";\n      if (!selectedGltf) {\n        return null;\n      }\n      return (\n        <SidebarContainer\n          title={selectedGltf?.name}\n          appearDirection={appearDirection}\n          onNavigateBack={\n            gltfs.length > 1 ? () => setView(\"gltf-list\") : undefined\n          }\n        >\n          {sceneHierarchy ? (\n            <GltfContent\n              gltf={selectedGltf}\n              appearDirection={appearDirection}\n              variantSetManager={variantSetManager}\n              onLevelVariantSetSelect={showLevelVariantSet}\n            />\n          ) : null}\n        </SidebarContainer>\n      );\n    case \"variant-set\":\n      if (selectedLevelVariantSetId === undefined || !variantSetManager) {\n        return null;\n      }\n      return (\n        <SidebarContainer\n          title={levelVariantSet?.name}\n          onNavigateBack={() => showLevelVariantSet(undefined)}\n        >\n          <LevelVariantSet\n            variantSets={levelVariantSet?.variantSets ?? []}\n            manager={variantSetManager}\n          />\n        </SidebarContainer>\n      );\n  }\n});\n","import React from \"react\";\nimport { observer } from \"mobx-react-lite\";\nimport { RadioGroup, useTheme } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { useStores } from \"../stores\";\nimport { Camera, Appear } from \"../components\";\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    zIndex: 2,\n    position: \"absolute\",\n    marginBottom: -theme.spacing(1.5), // Compensates for Camera margin\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n    display: \"flex\",\n    flexDirection: \"row\",\n  },\n  label: {\n    margin: theme.spacing(2, 2, 0.5, 2),\n  },\n}));\n\nexport const Cameras: React.FC = observer(() => {\n  const { gltfStore } = useStores();\n  const theme = useTheme();\n  const { cameras, camera, setCamera } = gltfStore;\n  const classes = useStyles();\n\n  if (cameras.length < 2) {\n    return null;\n  }\n\n  return (\n    <RadioGroup\n      className={classes.root}\n      aria-label=\"camera\"\n      data-testid=\"camera-select\"\n      name=\"camera-select\"\n      value={camera !== undefined ? camera.id.toString() : \"\"}\n      onChange={e => {\n        setCamera(cameras.find(c => c.id === parseInt(e.target.value, 10)));\n      }}\n    >\n      {cameras.map((camera, index) => (\n        <Camera\n          key={camera.id}\n          value={camera.id.toString()}\n          image={camera.previewSource}\n          type={camera.type}\n          appear={\n            <Appear delay={index * theme.listAnimationDelay} direction=\"up\" />\n          }\n        />\n      ))}\n    </RadioGroup>\n  );\n});\n","import React, { useState, useEffect } from \"react\";\nimport clsx from \"clsx\";\nimport {\n  Hidden,\n  makeStyles,\n  Typography,\n  useTheme,\n  useMediaQuery,\n} from \"@material-ui/core\";\nimport { observer } from \"mobx-react-lite\";\nimport { Sidebar, FpsMonitor, SidebarToggle } from \"../components\";\nimport { useStores } from \"../stores\";\nimport { Viewer } from \"./Viewer\";\nimport { Gltf } from \"./Gltf\";\nimport { Cameras } from \"./Cameras\";\n\nconst useStyles = makeStyles(theme => ({\n  \"@global\": {\n    html: {\n      height: \"100%\",\n    },\n    body: {\n      height: \"100%\",\n      margin: \"0\",\n      overflow: \"hidden\",\n    },\n    \"#root\": {\n      height: \"100%\",\n    },\n  },\n  root: {\n    height: \"100%\",\n  },\n  topbar: {\n    position: \"relative\",\n    boxSizing: \"border-box\",\n    display: \"flex\",\n    alignItems: \"center\",\n    height: theme.topbarHeight,\n    paddingLeft: theme.spacing(2),\n    paddingRight: theme.spacing(1),\n    color: theme.palette.text.secondary,\n    backgroundColor: theme.palette.background.paper,\n    zIndex: 1,\n  },\n  topbarLogo: {\n    flex: \"0 0 40px\",\n    maxWidth: 40,\n    height: 24,\n    overflow: \"visible\",\n  },\n  topbarLogoImage: {\n    height: \"100%\",\n    objectFit: \"contain\",\n    objectPosition: \"left 50%\",\n  },\n  topbarTitle: {\n    flex: \"1 1 auto\",\n    textAlign: \"center\",\n  },\n  topbarToggle: {\n    display: \"flex\",\n    flex: \"0 0 40px\",\n    justifyContent: \"flex-end\",\n  },\n  main: {\n    display: \"flex\",\n    height: `calc(100% - ${theme.topbarHeight}px)`,\n  },\n  mainFullheight: {\n    height: \"100%\",\n  },\n  viewport: {\n    position: \"relative\",\n    flexGrow: 1,\n    height: \"100%\",\n    backgroundColor: theme.palette.common.black,\n    overflow: \"hidden\",\n  },\n  viewportWithVisibleSidebar: {\n    transition: theme.transitions.create(\"margin\", {\n      easing: theme.transitions.easing.easeOut,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n  },\n  viewportWithHiddenSidebar: {\n    marginRight: -1 * theme.sidebarWidth,\n    transition: theme.transitions.create(\"margin\", {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.leavingScreen,\n    }),\n  },\n}));\n\nexport type RootProps = {\n  isLoading: boolean;\n  isError: boolean;\n};\n\nexport const Root: React.FC<RootProps> = observer(({ isLoading, isError }) => {\n  const classes = useStyles();\n  const theme = useTheme();\n  const isSmallScreen = useMediaQuery(theme.breakpoints.down(\"xs\"));\n  const { gltfStore, settingsStore } = useStores();\n  const { gltf, gltfs } = gltfStore;\n  const {\n    showTopbar,\n    showSidebar,\n    showCameras,\n    topbarTitle,\n    topbarLogoUrl,\n    showFpsMeter,\n  } = settingsStore;\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const isEmpty = gltfs.length === 0 && !gltf;\n\n  useEffect(() => setIsSidebarOpen(!isEmpty && !isSmallScreen), [\n    isEmpty,\n    isSmallScreen,\n  ]);\n\n  return (\n    <div className={classes.root}>\n      {showTopbar && (\n        <header className={classes.topbar}>\n          <div className={classes.topbarLogo}>\n            {topbarLogoUrl && (\n              <img\n                className={classes.topbarLogoImage}\n                src={topbarLogoUrl}\n                alt=\"Logo\"\n              />\n            )}\n          </div>\n          <Typography className={classes.topbarTitle} variant=\"body2\">\n            {topbarTitle !== undefined && (\n              <>\n                {topbarTitle}\n                {gltf && topbarTitle && \" - \"}\n                {gltf && gltf.name}\n              </>\n            )}\n          </Typography>\n          <div className={classes.topbarToggle}>\n            {showSidebar && (\n              <SidebarToggle\n                open={isSidebarOpen}\n                toggleOpen={setIsSidebarOpen}\n              />\n            )}\n          </div>\n        </header>\n      )}\n      <main\n        className={clsx(classes.main, {\n          [classes.mainFullheight]: !showTopbar,\n        })}\n      >\n        <div\n          className={clsx(classes.viewport, {\n            [classes.viewportWithHiddenSidebar]: showSidebar && !isSidebarOpen,\n            [classes.viewportWithVisibleSidebar]: showSidebar && isSidebarOpen,\n          })}\n        >\n          <Viewer isLoading={isLoading} isError={isError} isEmpty={isEmpty} />\n          {showCameras && <Cameras />}\n          {showFpsMeter && (\n            <Hidden xsDown>\n              <FpsMonitor />\n            </Hidden>\n          )}\n        </div>\n        {showSidebar && (\n          <Sidebar open={isSidebarOpen}>\n            <Gltf isError={isError} />\n          </Sidebar>\n        )}\n      </main>\n    </div>\n  );\n});\n","import React, { useEffect, useState } from \"react\";\nimport { ThemeProvider, CssBaseline } from \"@material-ui/core\";\nimport { observer } from \"mobx-react-lite\";\nimport { createTheme } from \"../theme\";\nimport { useStores } from \"../stores\";\nimport { useAsyncWithLoadingAndErrorHandling } from \"../hooks\";\nimport { fetchConfig } from \"../fetchConfig\";\nimport { waitFor } from \"../utilities\";\nimport { Root } from \"./Root\";\n\nconst defaultTheme = createTheme();\n\nexport const Bootstrapper: React.FC = observer(() => {\n  const { gltfStore, settingsStore } = useStores();\n  const { setGltfs } = gltfStore;\n  const { initFromConfig } = settingsStore;\n  const [isLoading, isError, runAsync] = useAsyncWithLoadingAndErrorHandling();\n  const [theme, setTheme] = useState(defaultTheme);\n\n  useEffect(() => {\n    const minLoadingTime = waitFor(1500);\n\n    runAsync(async () => {\n      const config = await fetchConfig();\n      setTheme(createTheme(config.theme));\n      await minLoadingTime;\n      initFromConfig(config);\n      setGltfs(config.assets);\n    });\n  }, [setGltfs, runAsync, initFromConfig]);\n\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <Root isLoading={isLoading} isError={isError} />\n    </ThemeProvider>\n  );\n});\n","export function waitFor(duration: number) {\n  return new Promise<void>(resolve => {\n    setTimeout(() => resolve(), duration);\n  });\n}\n","/* istanbul ignore file */\nimport React from \"react\";\nimport { render } from \"react-dom\";\nimport { createDecoderModule } from \"draco3d\";\nimport { Bootstrapper } from \"./containers\";\nimport { RootStoreProvider } from \"./stores\";\n\n// Used by PlayCanvas glTF parser\nwindow.DracoDecoderModule = createDecoderModule();\n\nrender(\n  <RootStoreProvider>\n    <Bootstrapper />\n  </RootStoreProvider>,\n  document.getElementById(\"root\"),\n);\n"],"sourceRoot":""}